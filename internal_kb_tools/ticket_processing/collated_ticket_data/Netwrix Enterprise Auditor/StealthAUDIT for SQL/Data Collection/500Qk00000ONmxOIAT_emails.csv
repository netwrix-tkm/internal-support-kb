"Id","ParentId","CreatedDate","LastModifiedDate","TextBody","Subject","FromAddress","FromName","ToAddress","CcAddress","BccAddress","HasAttachment","MessageDate","IsExternallyVisible"
"02sQk00000O4g2vIAB","500Qk00000ONmxOIAT","2025-04-23T21:08:39.000Z","2025-04-23T21:08:39.000Z","Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com
ref:!00D70091pB.!500Qk0ONmxO:ref","main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","techsupport@netwrix.com","Netwrix Support","jim.callison@regions.com","kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com","joshua.sexton@netwrix.com","false","2025-04-23T21:08:37.000Z","true"
"02sQk00000O4hDVIAZ","500Qk00000ONmxOIAT","2025-04-23T21:21:04.000Z","2025-04-23T22:20:21.000Z","ref:_00D7091pB._500Q000ONmxO:ref

Thanks Josh.  Scheduled for tomorrow 10am.

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

Running instances show all threads stuck in “committing data”.

We also upgraded test and it seems fine.

Thanks
Jim




Internal Use
From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

[External Content] Please use caution.
Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z<https://urldefense.com/v3/__https:/nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXP7cPRPQw$>

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXPzV6Vg3Q$>

ref:!00D70091pB.!500Qk0ONmxO:ref","RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","jim.callison@regions.com","Jim Callison","techsupport@netwrix.com","sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com","","false","2025-04-23T21:20:50.000Z","true"
"02sQk00000O4unRIAR","500Qk00000ONmxOIAT","2025-04-23T22:01:34.000Z","2025-04-23T22:20:21.000Z","ref:_00D7091pB._500Q000ONmxO:ref

Debug log attached to ticket.
Jim




Internal Use
From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Thanks Josh.  Scheduled for tomorrow 10am.

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

Running instances show all threads stuck in “committing data”.

We also upgraded test and it seems fine.

Thanks
Jim


From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

[External Content] Please use caution.
Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z<https://urldefense.com/v3/__https:/nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXP7cPRPQw$>

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXPzV6Vg3Q$>

ref:!00D70091pB.!500Qk0ONmxO:ref","RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","jim.callison@regions.com","Jim Callison","techsupport@netwrix.com","sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com","","false","2025-04-23T22:01:22.000Z","true"
"02sQk00000O74kFIAR","500Qk00000ONmxOIAT","2025-04-24T18:26:08.000Z","2025-04-24T18:26:08.000Z","Hello Jim,

Thank you for meeting with me today. In our session we confirmed the connection profile that the SQL permissions scan job is using has appropriate access to the SQL instances. We also used the Connection Wizzard within the SQL job's query filters to confirm the NEA console could connect to the SQL instances. While there are some that throw ""Access Denied"" messages, the job quickly moves on to the next server. I don't believe that is causing the problem. Using SQL Management Studio, we were able to identify the query that is running while the job seems to hang.

The job doesn't truly lock-up; it seems like it does slowly move onto subsequent servers, but it takes 5+ hours per server. The job's stats table shows that before the upgrade, it use to take 6-7 hours to complete the entire job, including scanning all of your SQL servers. We thought the Test environment was complete without issue, but we found that NEA's SQL server's traction log was out of space in that environment. When you cleared space for the log, the SQL Permission job seemed to hang, just like the Prod environment.

We adjusted the host list assignment for the job to target a single SQL server and found it still hung at the final Committing step of the scan. You have already uploaded to the ticket the SQL query that seems to be causing the stall and the debug logs from when just one server was targeted. Thank you for that.

I'm going to raise this issue internally and see if I can more about what that script is doing or what might be going wrong. I appreciate your patience with this. There is a good chance this will be escalated, so I will let you know if I need any additional artifacts. I'll be in touch with next steps as soon as I have them.

Thank you. 

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/23/2025 6:01 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref




Debug log attached to ticket.

Jim

 

 

 
Internal Use


From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Thanks Josh.  Scheduled for tomorrow 10am.

 

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

 

Running instances show all threads stuck in “committing data”.

 

We also upgraded test and it seems fine.

 

Thanks
Jim

 

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com;  sina.pourmokhtari@netwrix.com
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 



	
		
			
			[External Content] Please use caution.
			
		
	



Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

ref:!00D70091pB.!500Qk0ONmxO:ref","RE: Netwrix Support Ticket #442987 -  - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","techsupport@netwrix.com","Netwrix Support","jim.callison@regions.com","kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com","joshua.sexton@netwrix.com","false","2025-04-24T18:26:06.000Z","true"
"02sQk00000O7HWDIA3","500Qk00000ONmxOIAT","2025-04-24T19:59:26.000Z","2025-04-24T20:18:44.000Z","ref:_00D7091pB._500Q000ONmxO:ref

It seems like the query is using terribly inefficient nested views.  It joins many tables to views, unions, and the views have many internal table joins.

If you have any real amount of data this will not run well.  What would have changed related to this for the .137 upgrade?

As the issue started immediately after that, it seems the data would not have changed, but the logic of how it is handled might?


Another thought.  As this data technically should be wiped and re-loaded every time….. we don’t care about history.

However there are tables (object and permissions tables) that still contiain much old data.

Can we truncate these and try again?

Please give me a list of tables that woudl be wise to truncate prior to this load and we will add that to the start of the process.

Probably this slow query will run faster if we do that?

Jim



[cid:image001.png@01DBB529.19B37700]

[cid:image002.png@01DBB529.19B37700]

[cid:image003.png@01DBB529.19B37700]



Internal Use
From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, April 24, 2025 1:26 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]


Hello Jim,

Thank you for meeting with me today. In our session we confirmed the connection profile that the SQL permissions scan job is using has appropriate access to the SQL instances. We also used the Connection Wizzard within the SQL job's query filters to confirm the NEA console could connect to the SQL instances. While there are some that throw ""Access Denied"" messages, the job quickly moves on to the next server. I don't believe that is causing the problem. Using SQL Management Studio, we were able to identify the query that is running while the job seems to hang.

The job doesn't truly lock-up; it seems like it does slowly move onto subsequent servers, but it takes 5+ hours per server. The job's stats table shows that before the upgrade, it use to take 6-7 hours to complete the entire job, including scanning all of your SQL servers. We thought the Test environment was complete without issue, but we found that NEA's SQL server's traction log was out of space in that environment. When you cleared space for the log, the SQL Permission job seemed to hang, just like the Prod environment.

We adjusted the host list assignment for the job to target a single SQL server and found it still hung at the final Committing step of the scan. You have already uploaded to the ticket the SQL query that seems to be causing the stall and the debug logs from when just one server was targeted. Thank you for that.

I'm going to raise this issue internally and see if I can more about what that script is doing or what might be going wrong. I appreciate your patience with this. There is a good chance this will be escalated, so I will let you know if I need any additional artifacts. I'll be in touch with next steps as soon as I have them.

Thank you.

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!-gflWOTWUk4qHyJyRwCkZmWogLCMahjO0LRwu7VJ9B4mWSlpDGdQxixzLbNyUsEwmgpiEmgCnHjMHR-65A_Il8wmLg$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/23/2025 6:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref


Debug log attached to ticket.
Jim




Internal Use
From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Thanks Josh.  Scheduled for tomorrow 10am.

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

Running instances show all threads stuck in “committing data”.

We also upgraded test and it seems fine.

Thanks
Jim


From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

[External Content] Please use caution.
Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z<https://urldefense.com/v3/__https:/nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXP7cPRPQw$>

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXPzV6Vg3Q$>

ref:!00D70091pB.!500Qk0ONmxO:ref","RE: Netwrix Support Ticket #442987 -  - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","jim.callison@regions.com","Jim Callison","techsupport@netwrix.com","sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com","","true","2025-04-24T19:59:10.000Z","true"
"02sQk00000O7U0QIAV","500Qk00000ONmxOIAT","2025-04-24T21:51:00.000Z","2025-04-25T12:25:25.000Z","ref:_00D7091pB._500Q000ONmxO:ref

Looks like there is no WHERE clause on this call.   Meaning for EVERY server, you are running against the entire database.  It SHOULD only be running for the server data it just gathered.

Probably this is your issue.

Do we need to roll back?  Or can you fix this query.  It runs in seconds when running for the server it is trying to commit.

Jim




Internal Use
From: Jim Callison
Sent: Thursday, April 24, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com; SQL111 <SQL111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

It seems like the query is using terribly inefficient nested views.  It joins many tables to views, unions, and the views have many internal table joins.

If you have any real amount of data this will not run well.  What would have changed related to this for the .137 upgrade?

As the issue started immediately after that, it seems the data would not have changed, but the logic of how it is handled might?


Another thought.  As this data technically should be wiped and re-loaded every time….. we don’t care about history.

However there are tables (object and permissions tables) that still contiain much old data.

Can we truncate these and try again?

Please give me a list of tables that woudl be wise to truncate prior to this load and we will add that to the start of the process.

Probably this slow query will run faster if we do that?

Jim



[cid:image001.png@01DBB534.CFEA5790]

[cid:image002.png@01DBB534.CFEA5790]

[cid:image003.png@01DBB534.CFEA5790]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, April 24, 2025 1:26 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]


Hello Jim,

Thank you for meeting with me today. In our session we confirmed the connection profile that the SQL permissions scan job is using has appropriate access to the SQL instances. We also used the Connection Wizzard within the SQL job's query filters to confirm the NEA console could connect to the SQL instances. While there are some that throw ""Access Denied"" messages, the job quickly moves on to the next server. I don't believe that is causing the problem. Using SQL Management Studio, we were able to identify the query that is running while the job seems to hang.

The job doesn't truly lock-up; it seems like it does slowly move onto subsequent servers, but it takes 5+ hours per server. The job's stats table shows that before the upgrade, it use to take 6-7 hours to complete the entire job, including scanning all of your SQL servers. We thought the Test environment was complete without issue, but we found that NEA's SQL server's traction log was out of space in that environment. When you cleared space for the log, the SQL Permission job seemed to hang, just like the Prod environment.

We adjusted the host list assignment for the job to target a single SQL server and found it still hung at the final Committing step of the scan. You have already uploaded to the ticket the SQL query that seems to be causing the stall and the debug logs from when just one server was targeted. Thank you for that.

I'm going to raise this issue internally and see if I can more about what that script is doing or what might be going wrong. I appreciate your patience with this. There is a good chance this will be escalated, so I will let you know if I need any additional artifacts. I'll be in touch with next steps as soon as I have them.

Thank you.

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!-gflWOTWUk4qHyJyRwCkZmWogLCMahjO0LRwu7VJ9B4mWSlpDGdQxixzLbNyUsEwmgpiEmgCnHjMHR-65A_Il8wmLg$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/23/2025 6:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

Debug log attached to ticket.
Jim




Internal Use
From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Thanks Josh.  Scheduled for tomorrow 10am.

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

Running instances show all threads stuck in “committing data”.

We also upgraded test and it seems fine.

Thanks
Jim


From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

[External Content] Please use caution.
Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z<https://urldefense.com/v3/__https:/nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXP7cPRPQw$>

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXPzV6Vg3Q$>

ref:!00D70091pB.!500Qk0ONmxO:ref","RE: Netwrix Support Ticket #442987 -  - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","jim.callison@regions.com","Jim Callison","techsupport@netwrix.com","sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com","","true","2025-04-24T21:50:39.000Z","true"
"02sQk00000O8wnOIAR","500Qk00000ONmxOIAT","2025-04-25T13:03:38.000Z","2025-04-25T13:03:38.000Z","Hello Jim,

I've been discussing your issue with a T2 engineer and reviewing the logs. In the most recent log you provided, the one where it was only targeting the single SQL server, did it complete on its own, or did you abort the scan? I ask because the logs look like it only sits at that committing step for about 3 minutes then continues on and completes the scan. 

I agree with your findings that the SQL query will be very slow in large SQL environments, especially when there are many, many SQL servers. I'm working to escalate this issue so Dev can examine the query closely, but it would help if I had logs that showed it sitting at that commit step for a long time. Are you able to run the job again, preferably targeting just one server, and let it run for a long time? Then please attach that log along with an export/screenshot of the Job Stats and Task Stats for that run.

Once we have that, there is a couple ways to clear out the SQL permissions data to start a scan fresh. In fact, I believe you already had a job configured to do this, but we didn't examine it closely. Here is a KB on setting up a custom job to drop that data: How to Drop Data Collected from SQL Servers Using the Databases Module
The second half of the KB shows how to drop data for specific servers and/or dropping just the permissions data. I can help with this over a remote session, if you'd like.

Either way, your analysis of the SQL query seems valid. I'm still trying to determine if the query was changed at all between versions. I'm not aware of any SQL changes in the change log.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/24/2025 5:50 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref



Looks like there is no WHERE clause on this call.   Meaning for EVERY server, you are running against the entire database.  It SHOULD only be running for the server data it just gathered.

 

Probably this is your issue.

 

Do we need to roll back?  Or can you fix this query.  It runs in seconds when running for the server it is trying to commit.

 

Jim

 

 

 
Internal Use


From: Jim Callison
Sent: Thursday, April 24, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com; SQL111 <SQL111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

It seems like the query is using terribly inefficient nested views.  It joins many tables to views, unions, and the views have many internal table joins.

 

If you have any real amount of data this will not run well.  What would have changed related to this for the .137 upgrade?

 

As the issue started immediately after that, it seems the data would not have changed, but the logic of how it is handled might?

 

 

Another thought.  As this data technically should be wiped and re-loaded every time….. we don’t care about history.

 

However there are tables (object and permissions tables) that still contiain much old data.

 

Can we truncate these and try again?

 

Please give me a list of tables that woudl be wise to truncate prior to this load and we will add that to the start of the process.

 

Probably this slow query will run faster if we do that?

 

Jim

 

 

 



 



 



 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, April 24, 2025 1:26 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com;  sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

Thank you for meeting with me today. In our session we confirmed the connection profile that the SQL permissions scan job is using has appropriate access to the SQL instances. We also used the Connection Wizzard within the SQL job's query filters to confirm the NEA console could connect to the SQL instances. While there are some that throw ""Access Denied"" messages, the job quickly moves on to the next server. I don't believe that is causing the problem. Using SQL Management Studio, we were able to identify the query that is running while the job seems to hang.

The job doesn't truly lock-up; it seems like it does slowly move onto subsequent servers, but it takes 5+ hours per server. The job's stats table shows that before the upgrade, it use to take 6-7 hours to complete the entire job, including scanning all of your SQL servers. We thought the Test environment was complete without issue, but we found that NEA's SQL server's traction log was out of space in that environment. When you cleared space for the log, the SQL Permission job seemed to hang, just like the Prod environment.

We adjusted the host list assignment for the job to target a single SQL server and found it still hung at the final Committing step of the scan. You have already uploaded to the ticket the SQL query that seems to be causing the stall and the debug logs from when just one server was targeted. Thank you for that.

I'm going to raise this issue internally and see if I can more about what that script is doing or what might be going wrong. I appreciate your patience with this. There is a good chance this will be escalated, so I will let you know if I need any additional artifacts. I'll be in touch with next steps as soon as I have them.

Thank you. 

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/23/2025 6:01 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com;  sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


Debug log attached to ticket.

Jim

 

 


 

Internal Use


From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com;  sina.pourmokhtari@netwrix.com
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Thanks Josh.  Scheduled for tomorrow 10am.

 

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

 

Running instances show all threads stuck in “committing data”.

 

We also upgraded test and it seems fine.

 

Thanks
Jim

 

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 



	
		
			
			[External Content] Please use caution.
			
		
	



Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

ref:!00D70091pB.!500Qk0ONmxO:ref","RE: Netwrix Support Ticket #442987 -  - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","techsupport@netwrix.com","Netwrix Support","jim.callison@regions.com","kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com","joshua.sexton@netwrix.com","true","2025-04-25T13:03:37.000Z","true"
"02sQk00000O9Cs9IAF","500Qk00000ONmxOIAT","2025-04-25T14:26:57.000Z","2025-04-25T15:28:17.000Z","ref:_00D7091pB._500Q000ONmxO:ref

I am currently running a batch of 26 servers – all “stuck” in the “Committing data” stage for 20 minutes so far.
I suspect that each will take between 40 minutes and 5 hours each.
There is one thread of the slow query running at the moment (I expected maybe multiple)

You can see the current log as below where it is during this stuck commit stage.

The single serve run last night completed (I guess) in 43 minutes – log uploaded.

I am also uploading the log of the current running “stuck” process as well as the one form last night.

Even if any will commit at 43 minutes, that is 3x longer than normal, but I suspect it will run for days and not complete.

Unless you have a better idea, we need to roll back our production system this afternoon as we rely on it for capturing sox audit data.
I do have a database backup for production and folders etc from prior to the upgrade.

We also need to upgrade test, which I don’t have a db backup for but I suppose we can start with new DB on that one as we can load the servers form a dynamic host list and also we have the previous folders from before migration as well as we can apply prod jobs over there.

Thanks
Jim

[cid:image007.png@01DBB5C4.239757A0]

[cid:image002.png@01DBB5C2.8E2CDFB0]

Current log
[cid:image006.png@01DBB5C2.CF323AA0]





Internal Use
From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 8:04 AM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

I've been discussing your issue with a T2 engineer and reviewing the logs. In the most recent log you provided, the one where it was only targeting the single SQL server, did it complete on its own, or did you abort the scan? I ask because the logs look like it only sits at that committing step for about 3 minutes then continues on and completes the scan.

I agree with your findings that the SQL query will be very slow in large SQL environments, especially when there are many, many SQL servers. I'm working to escalate this issue so Dev can examine the query closely, but it would help if I had logs that showed it sitting at that commit step for a long time. Are you able to run the job again, preferably targeting just one server, and let it run for a long time? Then please attach that log along with an export/screenshot of the Job Stats and Task Stats for that run.

Once we have that, there is a couple ways to clear out the SQL permissions data to start a scan fresh. In fact, I believe you already had a job configured to do this, but we didn't examine it closely. Here is a KB on setting up a custom job to drop that data: How to Drop Data Collected from SQL Servers Using the Databases Module<https://urldefense.com/v3/__https:/helpcenter.netwrix.com/bundle/z-kb-articles-salesforce/page/kA0Qk0000001lGDKAY.html__;!!DgLF0YGH!_aop0YYcdeAqjFp4fI9qmWjgdGLOfCE0ziyeypIGOrldHab5BWlTJjvC4PodygFP9kUl2Z4sAYWI-NHFv8Lb7j2yGw$>
The second half of the KB shows how to drop data for specific servers and/or dropping just the permissions data. I can help with this over a remote session, if you'd like.

Either way, your analysis of the SQL query seems valid. I'm still trying to determine if the query was changed at all between versions. I'm not aware of any SQL changes in the change log.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!_aop0YYcdeAqjFp4fI9qmWjgdGLOfCE0ziyeypIGOrldHab5BWlTJjvC4PodygFP9kUl2Z4sAYWI-NHFv8Lvnr3Z8w$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/24/2025 5:50 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref


Looks like there is no WHERE clause on this call.   Meaning for EVERY server, you are running against the entire database.  It SHOULD only be running for the server data it just gathered.

Probably this is your issue.

Do we need to roll back?  Or can you fix this query.  It runs in seconds when running for the server it is trying to commit.

Jim




Internal Use
From: Jim Callison
Sent: Thursday, April 24, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; SQL111 <SQL111@regions.com<mailto:SQL111@regions.com>>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

It seems like the query is using terribly inefficient nested views.  It joins many tables to views, unions, and the views have many internal table joins.

If you have any real amount of data this will not run well.  What would have changed related to this for the .137 upgrade?

As the issue started immediately after that, it seems the data would not have changed, but the logic of how it is handled might?


Another thought.  As this data technically should be wiped and re-loaded every time….. we don’t care about history.

However there are tables (object and permissions tables) that still contiain much old data.

Can we truncate these and try again?

Please give me a list of tables that woudl be wise to truncate prior to this load and we will add that to the start of the process.

Probably this slow query will run faster if we do that?

Jim



[cid:image003.png@01DBB5C2.8E2CDFB0]

[cid:image004.png@01DBB5C2.8E2CDFB0]

[cid:image005.png@01DBB5C2.8E2CDFB0]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, April 24, 2025 1:26 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]


Hello Jim,

Thank you for meeting with me today. In our session we confirmed the connection profile that the SQL permissions scan job is using has appropriate access to the SQL instances. We also used the Connection Wizzard within the SQL job's query filters to confirm the NEA console could connect to the SQL instances. While there are some that throw ""Access Denied"" messages, the job quickly moves on to the next server. I don't believe that is causing the problem. Using SQL Management Studio, we were able to identify the query that is running while the job seems to hang.

The job doesn't truly lock-up; it seems like it does slowly move onto subsequent servers, but it takes 5+ hours per server. The job's stats table shows that before the upgrade, it use to take 6-7 hours to complete the entire job, including scanning all of your SQL servers. We thought the Test environment was complete without issue, but we found that NEA's SQL server's traction log was out of space in that environment. When you cleared space for the log, the SQL Permission job seemed to hang, just like the Prod environment.

We adjusted the host list assignment for the job to target a single SQL server and found it still hung at the final Committing step of the scan. You have already uploaded to the ticket the SQL query that seems to be causing the stall and the debug logs from when just one server was targeted. Thank you for that.

I'm going to raise this issue internally and see if I can more about what that script is doing or what might be going wrong. I appreciate your patience with this. There is a good chance this will be escalated, so I will let you know if I need any additional artifacts. I'll be in touch with next steps as soon as I have them.

Thank you.

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!-gflWOTWUk4qHyJyRwCkZmWogLCMahjO0LRwu7VJ9B4mWSlpDGdQxixzLbNyUsEwmgpiEmgCnHjMHR-65A_Il8wmLg$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/23/2025 6:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

Debug log attached to ticket.
Jim




Internal Use
From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Thanks Josh.  Scheduled for tomorrow 10am.

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

Running instances show all threads stuck in “committing data”.

We also upgraded test and it seems fine.

Thanks
Jim


From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

[External Content] Please use caution.
Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z<https://urldefense.com/v3/__https:/nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXP7cPRPQw$>

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXPzV6Vg3Q$>

ref:!00D70091pB.!500Qk0ONmxO:ref","RE: Netwrix Support Ticket #442987 -  - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","jim.callison@regions.com","Jim Callison","techsupport@netwrix.com","sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com","","true","2025-04-25T14:26:40.000Z","true"
"02sQk00000O9DWTIA3","500Qk00000ONmxOIAT","2025-04-25T14:30:41.000Z","2025-04-25T15:07:31.000Z","ref:_00D7091pB._500Q000ONmxO:ref

@Netwrix Support<mailto:techsupport@netwrix.com>  can we escalate to highest level – as we can not be missing this data too long ? issue should be treated at production outage level.



Internal Use
From: Jim Callison <Jim.Callison@regions.com>
Sent: Friday, April 25, 2025 9:27 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com; SQL111 <SQL111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

I am currently running a batch of 26 servers – all “stuck” in the “Committing data” stage for 20 minutes so far.
I suspect that each will take between 40 minutes and 5 hours each.
There is one thread of the slow query running at the moment (I expected maybe multiple)

You can see the current log as below where it is during this stuck commit stage.

The single serve run last night completed (I guess) in 43 minutes – log uploaded.

I am also uploading the log of the current running “stuck” process as well as the one form last night.

Even if any will commit at 43 minutes, that is 3x longer than normal, but I suspect it will run for days and not complete.

Unless you have a better idea, we need to roll back our production system this afternoon as we rely on it for capturing sox audit data.
I do have a database backup for production and folders etc from prior to the upgrade.

We also need to upgrade test, which I don’t have a db backup for but I suppose we can start with new DB on that one as we can load the servers form a dynamic host list and also we have the previous folders from before migration as well as we can apply prod jobs over there.

Thanks
Jim

[cid:image001.png@01DBB5C4.A53C1FC0]

[cid:image002.png@01DBB5C4.A53C1FC0]

Current log
[cid:image006.png@01DBB5C4.A53C1FC0]





Internal Use
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Friday, April 25, 2025 8:04 AM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

I've been discussing your issue with a T2 engineer and reviewing the logs. In the most recent log you provided, the one where it was only targeting the single SQL server, did it complete on its own, or did you abort the scan? I ask because the logs look like it only sits at that committing step for about 3 minutes then continues on and completes the scan.

I agree with your findings that the SQL query will be very slow in large SQL environments, especially when there are many, many SQL servers. I'm working to escalate this issue so Dev can examine the query closely, but it would help if I had logs that showed it sitting at that commit step for a long time. Are you able to run the job again, preferably targeting just one server, and let it run for a long time? Then please attach that log along with an export/screenshot of the Job Stats and Task Stats for that run.

Once we have that, there is a couple ways to clear out the SQL permissions data to start a scan fresh. In fact, I believe you already had a job configured to do this, but we didn't examine it closely. Here is a KB on setting up a custom job to drop that data: How to Drop Data Collected from SQL Servers Using the Databases Module<https://urldefense.com/v3/__https:/helpcenter.netwrix.com/bundle/z-kb-articles-salesforce/page/kA0Qk0000001lGDKAY.html__;!!DgLF0YGH!_aop0YYcdeAqjFp4fI9qmWjgdGLOfCE0ziyeypIGOrldHab5BWlTJjvC4PodygFP9kUl2Z4sAYWI-NHFv8Lb7j2yGw$>
The second half of the KB shows how to drop data for specific servers and/or dropping just the permissions data. I can help with this over a remote session, if you'd like.

Either way, your analysis of the SQL query seems valid. I'm still trying to determine if the query was changed at all between versions. I'm not aware of any SQL changes in the change log.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!_aop0YYcdeAqjFp4fI9qmWjgdGLOfCE0ziyeypIGOrldHab5BWlTJjvC4PodygFP9kUl2Z4sAYWI-NHFv8Lvnr3Z8w$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/24/2025 5:50 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

Looks like there is no WHERE clause on this call.   Meaning for EVERY server, you are running against the entire database.  It SHOULD only be running for the server data it just gathered.

Probably this is your issue.

Do we need to roll back?  Or can you fix this query.  It runs in seconds when running for the server it is trying to commit.

Jim




Internal Use
From: Jim Callison
Sent: Thursday, April 24, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; SQL111 <SQL111@regions.com<mailto:SQL111@regions.com>>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

It seems like the query is using terribly inefficient nested views.  It joins many tables to views, unions, and the views have many internal table joins.

If you have any real amount of data this will not run well.  What would have changed related to this for the .137 upgrade?

As the issue started immediately after that, it seems the data would not have changed, but the logic of how it is handled might?


Another thought.  As this data technically should be wiped and re-loaded every time….. we don’t care about history.

However there are tables (object and permissions tables) that still contiain much old data.

Can we truncate these and try again?

Please give me a list of tables that woudl be wise to truncate prior to this load and we will add that to the start of the process.

Probably this slow query will run faster if we do that?

Jim



[cid:image007.png@01DBB5C4.A53C1FC0]

[cid:image008.png@01DBB5C4.A53C1FC0]

[cid:image009.png@01DBB5C4.A53C1FC0]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, April 24, 2025 1:26 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]


Hello Jim,

Thank you for meeting with me today. In our session we confirmed the connection profile that the SQL permissions scan job is using has appropriate access to the SQL instances. We also used the Connection Wizzard within the SQL job's query filters to confirm the NEA console could connect to the SQL instances. While there are some that throw ""Access Denied"" messages, the job quickly moves on to the next server. I don't believe that is causing the problem. Using SQL Management Studio, we were able to identify the query that is running while the job seems to hang.

The job doesn't truly lock-up; it seems like it does slowly move onto subsequent servers, but it takes 5+ hours per server. The job's stats table shows that before the upgrade, it use to take 6-7 hours to complete the entire job, including scanning all of your SQL servers. We thought the Test environment was complete without issue, but we found that NEA's SQL server's traction log was out of space in that environment. When you cleared space for the log, the SQL Permission job seemed to hang, just like the Prod environment.

We adjusted the host list assignment for the job to target a single SQL server and found it still hung at the final Committing step of the scan. You have already uploaded to the ticket the SQL query that seems to be causing the stall and the debug logs from when just one server was targeted. Thank you for that.

I'm going to raise this issue internally and see if I can more about what that script is doing or what might be going wrong. I appreciate your patience with this. There is a good chance this will be escalated, so I will let you know if I need any additional artifacts. I'll be in touch with next steps as soon as I have them.

Thank you.

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!-gflWOTWUk4qHyJyRwCkZmWogLCMahjO0LRwu7VJ9B4mWSlpDGdQxixzLbNyUsEwmgpiEmgCnHjMHR-65A_Il8wmLg$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/23/2025 6:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

Debug log attached to ticket.
Jim




Internal Use
From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Thanks Josh.  Scheduled for tomorrow 10am.

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

Running instances show all threads stuck in “committing data”.

We also upgraded test and it seems fine.

Thanks
Jim


From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

[External Content] Please use caution.
Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z<https://urldefense.com/v3/__https:/nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXP7cPRPQw$>

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXPzV6Vg3Q$>

ref:!00D70091pB.!500Qk0ONmxO:ref","RE: Netwrix Support Ticket #442987 -  - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","manoj.gadhia@regions.com","Manoj Gadhia","jim.callison@regions.com; techsupport@netwrix.com","sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com","","true","2025-04-25T14:30:18.000Z","true"
"02sQk00000O9IeHIAV","500Qk00000ONmxOIAT","2025-04-25T15:28:13.000Z","2025-04-25T15:28:13.000Z","Hello Jim,

Thank you for the additional logs. I will review those as soon as I am able. I have confirmed that the offending query is exactly the same in version 11.6.0.89, but I don't have ready access to an older version. I don't believe I will be able provide any solution by this afternoon, so I understand if you want to roll back.

The best, and easiest, way to roll back would require you to also have a backup of the server. You said you have a backup of the folders, but do you have a backup of the whole server?

Stop the services, restore the database to the backups, then roll the NEA server back to a snapshot. Assuming the backups were all taken from the same version of NEA, there shouldn't be any difficulties with that process.

Please feel free to use this link to schedule a remote session. I've included the T2 Engineer that has been helping me with this.

https://nwxcorp.my.salesforce-sites.com/cts?Id=m6EcG4ueUApCZsGv3ew3wu9Fl8ROYXXq7GvasfXsycM-Z&MeetingID=ybt2YqXueXkSEWcAvKLmdypANpjUq8xTU72ZMjzU1GU-Z

Thank you,


Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Manoj Gadhia [manoj.gadhia@regions.com]
Sent: 4/25/2025 10:30 AM
To: jim.callison@regions.com; techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref



@Netwrix Support  can we escalate to highest level – as we can not be missing this data too long ? issue should be treated at production outage level.

 

 
Internal Use


From: Jim Callison <Jim.Callison@regions.com>
Sent: Friday, April 25, 2025 9:27 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com; SQL111 <SQL111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

I am currently running a batch of 26 servers – all “stuck” in the “Committing data” stage for 20 minutes so far.  

I suspect that each will take between 40 minutes and 5 hours each.

There is one thread of the slow query running at the moment (I expected maybe multiple)

 

You can see the current log as below where it is during this stuck commit stage.

 

The single serve run last night completed (I guess) in 43 minutes – log uploaded.

 

I am also uploading the log of the current running “stuck” process as well as the one form last night.

 

Even if any will commit at 43 minutes, that is 3x longer than normal, but I suspect it will run for days and not complete.

 

Unless you have a better idea, we need to roll back our production system this afternoon as we rely on it for capturing sox audit data.

I do have a database backup for production and folders etc from prior to the upgrade.

 

We also need to upgrade test, which I don’t have a db backup for but I suppose we can start with new DB on that one as we can load the servers form a dynamic host list and also we have the previous folders from before migration as well as we can apply prod jobs over there.

 

Thanks

Jim

 



 



 

Current log



 

 

 


 

Internal Use


From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 8:04 AM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com;  sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

I've been discussing your issue with a T2 engineer and reviewing the logs. In the most recent log you provided, the one where it was only targeting the single SQL server, did it complete on its own, or did you abort the scan? I ask because the logs look like it only sits at that committing step for about 3 minutes then continues on and completes the scan. 

I agree with your findings that the SQL query will be very slow in large SQL environments, especially when there are many, many SQL servers. I'm working to escalate this issue so Dev can examine the query closely, but it would help if I had logs that showed it sitting at that commit step for a long time. Are you able to run the job again, preferably targeting just one server, and let it run for a long time? Then please attach that log along with an export/screenshot of the Job Stats and Task Stats for that run.

Once we have that, there is a couple ways to clear out the SQL permissions data to start a scan fresh. In fact, I believe you already had a job configured to do this, but we didn't examine it closely. Here is a KB on setting up a custom job to drop that data: How to Drop Data Collected from SQL Servers Using the Databases Module
The second half of the KB shows how to drop data for specific servers and/or dropping just the permissions data. I can help with this over a remote session, if you'd like.

Either way, your analysis of the SQL query seems valid. I'm still trying to determine if the query was changed at all between versions. I'm not aware of any SQL changes in the change log.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/24/2025 5:50 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com;  sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


Looks like there is no WHERE clause on this call.   Meaning for EVERY server, you are running against the entire database.  It SHOULD only be running for the server data it just gathered.

 

Probably this is your issue.

 

Do we need to roll back?  Or can you fix this query.  It runs in seconds when running for the server it is trying to commit.

 

Jim

 

 


 

Internal Use


From: Jim Callison
Sent: Thursday, April 24, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com;  sina.pourmokhtari@netwrix.com; SQL111 <SQL111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

It seems like the query is using terribly inefficient nested views.  It joins many tables to views, unions, and the views have many internal table joins.

 

If you have any real amount of data this will not run well.  What would have changed related to this for the .137 upgrade?

 

As the issue started immediately after that, it seems the data would not have changed, but the logic of how it is handled might?

 

 

Another thought.  As this data technically should be wiped and re-loaded every time….. we don’t care about history.

 

However there are tables (object and permissions tables) that still contiain much old data.

 

Can we truncate these and try again?

 

Please give me a list of tables that woudl be wise to truncate prior to this load and we will add that to the start of the process.

 

Probably this slow query will run faster if we do that?

 

Jim

 

 

 



 



 



 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, April 24, 2025 1:26 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

Thank you for meeting with me today. In our session we confirmed the connection profile that the SQL permissions scan job is using has appropriate access to the SQL instances. We also used the Connection Wizzard within the SQL job's query filters to confirm the NEA console could connect to the SQL instances. While there are some that throw ""Access Denied"" messages, the job quickly moves on to the next server. I don't believe that is causing the problem. Using SQL Management Studio, we were able to identify the query that is running while the job seems to hang.

The job doesn't truly lock-up; it seems like it does slowly move onto subsequent servers, but it takes 5+ hours per server. The job's stats table shows that before the upgrade, it use to take 6-7 hours to complete the entire job, including scanning all of your SQL servers. We thought the Test environment was complete without issue, but we found that NEA's SQL server's traction log was out of space in that environment. When you cleared space for the log, the SQL Permission job seemed to hang, just like the Prod environment.

We adjusted the host list assignment for the job to target a single SQL server and found it still hung at the final Committing step of the scan. You have already uploaded to the ticket the SQL query that seems to be causing the stall and the debug logs from when just one server was targeted. Thank you for that.

I'm going to raise this issue internally and see if I can more about what that script is doing or what might be going wrong. I appreciate your patience with this. There is a good chance this will be escalated, so I will let you know if I need any additional artifacts. I'll be in touch with next steps as soon as I have them.

Thank you. 

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/23/2025 6:01 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


Debug log attached to ticket.

Jim

 

 


 

Internal Use


From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Thanks Josh.  Scheduled for tomorrow 10am.

 

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

 

Running instances show all threads stuck in “committing data”.

 

We also upgraded test and it seems fine.

 

Thanks
Jim

 

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 



	
		
			
			[External Content] Please use caution.
			
		
	



Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

ref:!00D70091pB.!500Qk0ONmxO:ref","RE: Netwrix Support Ticket #442987 -  - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","techsupport@netwrix.com","Netwrix Support","manoj.gadhia@regions.com; jim.callison@regions.com","kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com","joshua.sexton@netwrix.com","true","2025-04-25T15:28:12.000Z","true"
"02sQk00000O9NMDIA3","500Qk00000ONmxOIAT","2025-04-25T15:48:38.000Z","2025-04-25T15:57:31.000Z","ref:_00D7091pB._500Q000ONmxO:ref

We don’t have a spapshot available.  We have the db backup and the job folder from the prior version.

Thanks
Jim



Internal Use
From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 10:28 AM
To: Manoj Gadhia <Manoj.Gadhia@Regions.com>; Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

Thank you for the additional logs. I will review those as soon as I am able. I have confirmed that the offending query is exactly the same in version 11.6.0.89, but I don't have ready access to an older version. I don't believe I will be able provide any solution by this afternoon, so I understand if you want to roll back.

The best, and easiest, way to roll back would require you to also have a backup of the server. You said you have a backup of the folders, but do you have a backup of the whole server?

Stop the services, restore the database to the backups, then roll the NEA server back to a snapshot. Assuming the backups were all taken from the same version of NEA, there shouldn't be any difficulties with that process.

Please feel free to use this link to schedule a remote session. I've included the T2 Engineer that has been helping me with this.

https://nwxcorp.my.salesforce-sites.com/cts?Id=m6EcG4ueUApCZsGv3ew3wu9Fl8ROYXXq7GvasfXsycM-Z&MeetingID=ybt2YqXueXkSEWcAvKLmdypANpjUq8xTU72ZMjzU1GU-Z<https://urldefense.com/v3/__https:/nwxcorp.my.salesforce-sites.com/cts?Id=m6EcG4ueUApCZsGv3ew3wu9Fl8ROYXXq7GvasfXsycM-Z&MeetingID=ybt2YqXueXkSEWcAvKLmdypANpjUq8xTU72ZMjzU1GU-Z__;!!DgLF0YGH!57h6O2CKk0nWgtG8ebuBcn4ZuClqMaQRzB4I0BUKf1_T8agzx0VFM2NLdwKan9N3sh2xu35FZiYbXzUcBoklhWIiNQ$>

Thank you,


Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!57h6O2CKk0nWgtG8ebuBcn4ZuClqMaQRzB4I0BUKf1_T8agzx0VFM2NLdwKan9N3sh2xu35FZiYbXzUcBol5LMJWTA$>


--------------- Original Message ---------------
From: Manoj Gadhia [manoj.gadhia@regions.com]
Sent: 4/25/2025 10:30 AM
To: jim.callison@regions.com<mailto:jim.callison@regions.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref


@Netwrix Support<mailto:techsupport@netwrix.com>  can we escalate to highest level – as we can not be missing this data too long ? issue should be treated at production outage level.



Internal Use
From: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Sent: Friday, April 25, 2025 9:27 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; SQL111 <SQL111@regions.com<mailto:SQL111@regions.com>>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

I am currently running a batch of 26 servers – all “stuck” in the “Committing data” stage for 20 minutes so far.
I suspect that each will take between 40 minutes and 5 hours each.
There is one thread of the slow query running at the moment (I expected maybe multiple)

You can see the current log as below where it is during this stuck commit stage.

The single serve run last night completed (I guess) in 43 minutes – log uploaded.

I am also uploading the log of the current running “stuck” process as well as the one form last night.

Even if any will commit at 43 minutes, that is 3x longer than normal, but I suspect it will run for days and not complete.

Unless you have a better idea, we need to roll back our production system this afternoon as we rely on it for capturing sox audit data.
I do have a database backup for production and folders etc from prior to the upgrade.

We also need to upgrade test, which I don’t have a db backup for but I suppose we can start with new DB on that one as we can load the servers form a dynamic host list and also we have the previous folders from before migration as well as we can apply prod jobs over there.

Thanks
Jim

[cid:image001.png@01DBB5CF.8A43D2C0]

[cid:image002.png@01DBB5CF.8A43D2C0]

Current log
[cid:image003.png@01DBB5CF.8A43D2C0]





Internal Use
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Friday, April 25, 2025 8:04 AM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

I've been discussing your issue with a T2 engineer and reviewing the logs. In the most recent log you provided, the one where it was only targeting the single SQL server, did it complete on its own, or did you abort the scan? I ask because the logs look like it only sits at that committing step for about 3 minutes then continues on and completes the scan.

I agree with your findings that the SQL query will be very slow in large SQL environments, especially when there are many, many SQL servers. I'm working to escalate this issue so Dev can examine the query closely, but it would help if I had logs that showed it sitting at that commit step for a long time. Are you able to run the job again, preferably targeting just one server, and let it run for a long time? Then please attach that log along with an export/screenshot of the Job Stats and Task Stats for that run.

Once we have that, there is a couple ways to clear out the SQL permissions data to start a scan fresh. In fact, I believe you already had a job configured to do this, but we didn't examine it closely. Here is a KB on setting up a custom job to drop that data: How to Drop Data Collected from SQL Servers Using the Databases Module<https://urldefense.com/v3/__https:/helpcenter.netwrix.com/bundle/z-kb-articles-salesforce/page/kA0Qk0000001lGDKAY.html__;!!DgLF0YGH!_aop0YYcdeAqjFp4fI9qmWjgdGLOfCE0ziyeypIGOrldHab5BWlTJjvC4PodygFP9kUl2Z4sAYWI-NHFv8Lb7j2yGw$>
The second half of the KB shows how to drop data for specific servers and/or dropping just the permissions data. I can help with this over a remote session, if you'd like.

Either way, your analysis of the SQL query seems valid. I'm still trying to determine if the query was changed at all between versions. I'm not aware of any SQL changes in the change log.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!_aop0YYcdeAqjFp4fI9qmWjgdGLOfCE0ziyeypIGOrldHab5BWlTJjvC4PodygFP9kUl2Z4sAYWI-NHFv8Lvnr3Z8w$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/24/2025 5:50 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

Looks like there is no WHERE clause on this call.   Meaning for EVERY server, you are running against the entire database.  It SHOULD only be running for the server data it just gathered.

Probably this is your issue.

Do we need to roll back?  Or can you fix this query.  It runs in seconds when running for the server it is trying to commit.

Jim




Internal Use
From: Jim Callison
Sent: Thursday, April 24, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; SQL111 <SQL111@regions.com<mailto:SQL111@regions.com>>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

It seems like the query is using terribly inefficient nested views.  It joins many tables to views, unions, and the views have many internal table joins.

If you have any real amount of data this will not run well.  What would have changed related to this for the .137 upgrade?

As the issue started immediately after that, it seems the data would not have changed, but the logic of how it is handled might?


Another thought.  As this data technically should be wiped and re-loaded every time….. we don’t care about history.

However there are tables (object and permissions tables) that still contiain much old data.

Can we truncate these and try again?

Please give me a list of tables that woudl be wise to truncate prior to this load and we will add that to the start of the process.

Probably this slow query will run faster if we do that?

Jim



[cid:image004.png@01DBB5CF.8A43D2C0]

[cid:image005.png@01DBB5CF.8A43D2C0]

[cid:image006.png@01DBB5CF.8A43D2C0]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, April 24, 2025 1:26 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]


Hello Jim,

Thank you for meeting with me today. In our session we confirmed the connection profile that the SQL permissions scan job is using has appropriate access to the SQL instances. We also used the Connection Wizzard within the SQL job's query filters to confirm the NEA console could connect to the SQL instances. While there are some that throw ""Access Denied"" messages, the job quickly moves on to the next server. I don't believe that is causing the problem. Using SQL Management Studio, we were able to identify the query that is running while the job seems to hang.

The job doesn't truly lock-up; it seems like it does slowly move onto subsequent servers, but it takes 5+ hours per server. The job's stats table shows that before the upgrade, it use to take 6-7 hours to complete the entire job, including scanning all of your SQL servers. We thought the Test environment was complete without issue, but we found that NEA's SQL server's traction log was out of space in that environment. When you cleared space for the log, the SQL Permission job seemed to hang, just like the Prod environment.

We adjusted the host list assignment for the job to target a single SQL server and found it still hung at the final Committing step of the scan. You have already uploaded to the ticket the SQL query that seems to be causing the stall and the debug logs from when just one server was targeted. Thank you for that.

I'm going to raise this issue internally and see if I can more about what that script is doing or what might be going wrong. I appreciate your patience with this. There is a good chance this will be escalated, so I will let you know if I need any additional artifacts. I'll be in touch with next steps as soon as I have them.

Thank you.

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!-gflWOTWUk4qHyJyRwCkZmWogLCMahjO0LRwu7VJ9B4mWSlpDGdQxixzLbNyUsEwmgpiEmgCnHjMHR-65A_Il8wmLg$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/23/2025 6:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

Debug log attached to ticket.
Jim




Internal Use
From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Thanks Josh.  Scheduled for tomorrow 10am.

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

Running instances show all threads stuck in “committing data”.

We also upgraded test and it seems fine.

Thanks
Jim


From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

[External Content] Please use caution.
Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z<https://urldefense.com/v3/__https:/nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXP7cPRPQw$>

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXPzV6Vg3Q$>

ref:!00D70091pB.!500Qk0ONmxO:ref","RE: Netwrix Support Ticket #442987 -  - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","jim.callison@regions.com","Jim Callison","techsupport@netwrix.com; manoj.gadhia@regions.com","sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com","","true","2025-04-25T15:48:19.000Z","true"
"02sQk00000O9lEwIAJ","500Qk00000ONmxOIAT","2025-04-25T18:27:39.000Z","2025-04-25T19:26:00.000Z","ref:_00D7091pB._500Q000ONmxO:ref

Is there anyone that can join me this afternoon for a rollback?  Assuming rollback and upgrade are similar.  Uninstall current version, restore database, install older version.  Replace any jobs needed if necessary.

Jim



Internal Use
From: Jim Callison
Sent: Friday, April 25, 2025 10:48 AM
To: Netwrix Support <techsupport@netwrix.com>; Manoj Gadhia <Manoj.Gadhia@Regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

We don’t have a spapshot available.  We have the db backup and the job folder from the prior version.

Thanks
Jim

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Friday, April 25, 2025 10:28 AM
To: Manoj Gadhia <Manoj.Gadhia@Regions.com<mailto:Manoj.Gadhia@Regions.com>>; Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

Thank you for the additional logs. I will review those as soon as I am able. I have confirmed that the offending query is exactly the same in version 11.6.0.89, but I don't have ready access to an older version. I don't believe I will be able provide any solution by this afternoon, so I understand if you want to roll back.

The best, and easiest, way to roll back would require you to also have a backup of the server. You said you have a backup of the folders, but do you have a backup of the whole server?

Stop the services, restore the database to the backups, then roll the NEA server back to a snapshot. Assuming the backups were all taken from the same version of NEA, there shouldn't be any difficulties with that process.

Please feel free to use this link to schedule a remote session. I've included the T2 Engineer that has been helping me with this.

https://nwxcorp.my.salesforce-sites.com/cts?Id=m6EcG4ueUApCZsGv3ew3wu9Fl8ROYXXq7GvasfXsycM-Z&MeetingID=ybt2YqXueXkSEWcAvKLmdypANpjUq8xTU72ZMjzU1GU-Z<https://urldefense.com/v3/__https:/nwxcorp.my.salesforce-sites.com/cts?Id=m6EcG4ueUApCZsGv3ew3wu9Fl8ROYXXq7GvasfXsycM-Z&MeetingID=ybt2YqXueXkSEWcAvKLmdypANpjUq8xTU72ZMjzU1GU-Z__;!!DgLF0YGH!57h6O2CKk0nWgtG8ebuBcn4ZuClqMaQRzB4I0BUKf1_T8agzx0VFM2NLdwKan9N3sh2xu35FZiYbXzUcBoklhWIiNQ$>

Thank you,


Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!57h6O2CKk0nWgtG8ebuBcn4ZuClqMaQRzB4I0BUKf1_T8agzx0VFM2NLdwKan9N3sh2xu35FZiYbXzUcBol5LMJWTA$>


--------------- Original Message ---------------
From: Manoj Gadhia [manoj.gadhia@regions.com]
Sent: 4/25/2025 10:30 AM
To: jim.callison@regions.com<mailto:jim.callison@regions.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

@Netwrix Support<mailto:techsupport@netwrix.com>  can we escalate to highest level – as we can not be missing this data too long ? issue should be treated at production outage level.



Internal Use
From: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Sent: Friday, April 25, 2025 9:27 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; SQL111 <SQL111@regions.com<mailto:SQL111@regions.com>>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

I am currently running a batch of 26 servers – all “stuck” in the “Committing data” stage for 20 minutes so far.
I suspect that each will take between 40 minutes and 5 hours each.
There is one thread of the slow query running at the moment (I expected maybe multiple)

You can see the current log as below where it is during this stuck commit stage.

The single serve run last night completed (I guess) in 43 minutes – log uploaded.

I am also uploading the log of the current running “stuck” process as well as the one form last night.

Even if any will commit at 43 minutes, that is 3x longer than normal, but I suspect it will run for days and not complete.

Unless you have a better idea, we need to roll back our production system this afternoon as we rely on it for capturing sox audit data.
I do have a database backup for production and folders etc from prior to the upgrade.

We also need to upgrade test, which I don’t have a db backup for but I suppose we can start with new DB on that one as we can load the servers form a dynamic host list and also we have the previous folders from before migration as well as we can apply prod jobs over there.

Thanks
Jim

[cid:image001.png@01DBB5E5.C3D647A0]

[cid:image002.png@01DBB5E5.C3D647A0]

Current log
[cid:image003.png@01DBB5E5.C3D647A0]





Internal Use
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Friday, April 25, 2025 8:04 AM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

I've been discussing your issue with a T2 engineer and reviewing the logs. In the most recent log you provided, the one where it was only targeting the single SQL server, did it complete on its own, or did you abort the scan? I ask because the logs look like it only sits at that committing step for about 3 minutes then continues on and completes the scan.

I agree with your findings that the SQL query will be very slow in large SQL environments, especially when there are many, many SQL servers. I'm working to escalate this issue so Dev can examine the query closely, but it would help if I had logs that showed it sitting at that commit step for a long time. Are you able to run the job again, preferably targeting just one server, and let it run for a long time? Then please attach that log along with an export/screenshot of the Job Stats and Task Stats for that run.

Once we have that, there is a couple ways to clear out the SQL permissions data to start a scan fresh. In fact, I believe you already had a job configured to do this, but we didn't examine it closely. Here is a KB on setting up a custom job to drop that data: How to Drop Data Collected from SQL Servers Using the Databases Module<https://urldefense.com/v3/__https:/helpcenter.netwrix.com/bundle/z-kb-articles-salesforce/page/kA0Qk0000001lGDKAY.html__;!!DgLF0YGH!_aop0YYcdeAqjFp4fI9qmWjgdGLOfCE0ziyeypIGOrldHab5BWlTJjvC4PodygFP9kUl2Z4sAYWI-NHFv8Lb7j2yGw$>
The second half of the KB shows how to drop data for specific servers and/or dropping just the permissions data. I can help with this over a remote session, if you'd like.

Either way, your analysis of the SQL query seems valid. I'm still trying to determine if the query was changed at all between versions. I'm not aware of any SQL changes in the change log.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!_aop0YYcdeAqjFp4fI9qmWjgdGLOfCE0ziyeypIGOrldHab5BWlTJjvC4PodygFP9kUl2Z4sAYWI-NHFv8Lvnr3Z8w$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/24/2025 5:50 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

Looks like there is no WHERE clause on this call.   Meaning for EVERY server, you are running against the entire database.  It SHOULD only be running for the server data it just gathered.

Probably this is your issue.

Do we need to roll back?  Or can you fix this query.  It runs in seconds when running for the server it is trying to commit.

Jim




Internal Use
From: Jim Callison
Sent: Thursday, April 24, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; SQL111 <SQL111@regions.com<mailto:SQL111@regions.com>>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

It seems like the query is using terribly inefficient nested views.  It joins many tables to views, unions, and the views have many internal table joins.

If you have any real amount of data this will not run well.  What would have changed related to this for the .137 upgrade?

As the issue started immediately after that, it seems the data would not have changed, but the logic of how it is handled might?


Another thought.  As this data technically should be wiped and re-loaded every time….. we don’t care about history.

However there are tables (object and permissions tables) that still contiain much old data.

Can we truncate these and try again?

Please give me a list of tables that woudl be wise to truncate prior to this load and we will add that to the start of the process.

Probably this slow query will run faster if we do that?

Jim



[cid:image004.png@01DBB5E5.C3D647A0]

[cid:image005.png@01DBB5E5.C3D647A0]

[cid:image006.png@01DBB5E5.C3D647A0]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, April 24, 2025 1:26 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]


Hello Jim,

Thank you for meeting with me today. In our session we confirmed the connection profile that the SQL permissions scan job is using has appropriate access to the SQL instances. We also used the Connection Wizzard within the SQL job's query filters to confirm the NEA console could connect to the SQL instances. While there are some that throw ""Access Denied"" messages, the job quickly moves on to the next server. I don't believe that is causing the problem. Using SQL Management Studio, we were able to identify the query that is running while the job seems to hang.

The job doesn't truly lock-up; it seems like it does slowly move onto subsequent servers, but it takes 5+ hours per server. The job's stats table shows that before the upgrade, it use to take 6-7 hours to complete the entire job, including scanning all of your SQL servers. We thought the Test environment was complete without issue, but we found that NEA's SQL server's traction log was out of space in that environment. When you cleared space for the log, the SQL Permission job seemed to hang, just like the Prod environment.

We adjusted the host list assignment for the job to target a single SQL server and found it still hung at the final Committing step of the scan. You have already uploaded to the ticket the SQL query that seems to be causing the stall and the debug logs from when just one server was targeted. Thank you for that.

I'm going to raise this issue internally and see if I can more about what that script is doing or what might be going wrong. I appreciate your patience with this. There is a good chance this will be escalated, so I will let you know if I need any additional artifacts. I'll be in touch with next steps as soon as I have them.

Thank you.

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!-gflWOTWUk4qHyJyRwCkZmWogLCMahjO0LRwu7VJ9B4mWSlpDGdQxixzLbNyUsEwmgpiEmgCnHjMHR-65A_Il8wmLg$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/23/2025 6:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

Debug log attached to ticket.
Jim




Internal Use
From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Thanks Josh.  Scheduled for tomorrow 10am.

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

Running instances show all threads stuck in “committing data”.

We also upgraded test and it seems fine.

Thanks
Jim


From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

[External Content] Please use caution.
Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z<https://urldefense.com/v3/__https:/nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXP7cPRPQw$>

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXPzV6Vg3Q$>

ref:!00D70091pB.!500Qk0ONmxO:ref","RE: Netwrix Support Ticket #442987 -  - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","jim.callison@regions.com","Jim Callison","techsupport@netwrix.com; manoj.gadhia@regions.com","sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com","","true","2025-04-25T18:27:21.000Z","true"
"02sQk00000OA2xCIAT","500Qk00000ONmxOIAT","2025-04-25T19:31:44.000Z","2025-04-25T19:31:44.000Z","Hello Jim,

That should be the process. Unfortunately, I don't have a copy of that old installer. Do you happen to still have it?

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/25/2025 2:27 PM
To: techsupport@netwrix.com; manoj.gadhia@regions.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref



Is there anyone that can join me this afternoon for a rollback?  Assuming rollback and upgrade are similar.  Uninstall current version, restore database, install older version.  Replace any jobs needed if necessary.

 

Jim

 

 
Internal Use


From: Jim Callison
Sent: Friday, April 25, 2025 10:48 AM
To: Netwrix Support <techsupport@netwrix.com>; Manoj Gadhia <Manoj.Gadhia@Regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

We don’t have a spapshot available.  We have the db backup and the job folder from the prior version.

 

Thanks

Jim

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 10:28 AM
To: Manoj Gadhia <Manoj.Gadhia@Regions.com>; Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com;  sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

Thank you for the additional logs. I will review those as soon as I am able. I have confirmed that the offending query is exactly the same in version 11.6.0.89, but I don't have ready access to an older version. I don't believe I will be able provide any solution by this afternoon, so I understand if you want to roll back.

The best, and easiest, way to roll back would require you to also have a backup of the server. You said you have a backup of the folders, but do you have a backup of the whole server?

Stop the services, restore the database to the backups, then roll the NEA server back to a snapshot. Assuming the backups were all taken from the same version of NEA, there shouldn't be any difficulties with that process.

Please feel free to use this link to schedule a remote session. I've included the T2 Engineer that has been helping me with this.

https://nwxcorp.my.salesforce-sites.com/cts?Id=m6EcG4ueUApCZsGv3ew3wu9Fl8ROYXXq7GvasfXsycM-Z&MeetingID=ybt2YqXueXkSEWcAvKLmdypANpjUq8xTU72ZMjzU1GU-Z

Thank you,


Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Manoj Gadhia [manoj.gadhia@regions.com]
Sent: 4/25/2025 10:30 AM
To: jim.callison@regions.com; techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com;  sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


@Netwrix Support  can we escalate to highest level – as we can not be missing this data too long ? issue should be treated at production outage level.

 


 

Internal Use


From: Jim Callison <Jim.Callison@regions.com>
Sent: Friday, April 25, 2025 9:27 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com;  sina.pourmokhtari@netwrix.com; SQL111 <SQL111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

I am currently running a batch of 26 servers – all “stuck” in the “Committing data” stage for 20 minutes so far.  

I suspect that each will take between 40 minutes and 5 hours each.

There is one thread of the slow query running at the moment (I expected maybe multiple)

 

You can see the current log as below where it is during this stuck commit stage.

 

The single serve run last night completed (I guess) in 43 minutes – log uploaded.

 

I am also uploading the log of the current running “stuck” process as well as the one form last night.

 

Even if any will commit at 43 minutes, that is 3x longer than normal, but I suspect it will run for days and not complete.

 

Unless you have a better idea, we need to roll back our production system this afternoon as we rely on it for capturing sox audit data.

I do have a database backup for production and folders etc from prior to the upgrade.

 

We also need to upgrade test, which I don’t have a db backup for but I suppose we can start with new DB on that one as we can load the servers form a dynamic host list and also we have the previous folders from before migration as well as we can apply prod jobs over there.

 

Thanks

Jim

 



 



 

Current log



 

 

 


 

Internal Use


From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 8:04 AM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

I've been discussing your issue with a T2 engineer and reviewing the logs. In the most recent log you provided, the one where it was only targeting the single SQL server, did it complete on its own, or did you abort the scan? I ask because the logs look like it only sits at that committing step for about 3 minutes then continues on and completes the scan. 

I agree with your findings that the SQL query will be very slow in large SQL environments, especially when there are many, many SQL servers. I'm working to escalate this issue so Dev can examine the query closely, but it would help if I had logs that showed it sitting at that commit step for a long time. Are you able to run the job again, preferably targeting just one server, and let it run for a long time? Then please attach that log along with an export/screenshot of the Job Stats and Task Stats for that run.

Once we have that, there is a couple ways to clear out the SQL permissions data to start a scan fresh. In fact, I believe you already had a job configured to do this, but we didn't examine it closely. Here is a KB on setting up a custom job to drop that data: How to Drop Data Collected from SQL Servers Using the Databases Module
The second half of the KB shows how to drop data for specific servers and/or dropping just the permissions data. I can help with this over a remote session, if you'd like.

Either way, your analysis of the SQL query seems valid. I'm still trying to determine if the query was changed at all between versions. I'm not aware of any SQL changes in the change log.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/24/2025 5:50 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


Looks like there is no WHERE clause on this call.   Meaning for EVERY server, you are running against the entire database.  It SHOULD only be running for the server data it just gathered.

 

Probably this is your issue.

 

Do we need to roll back?  Or can you fix this query.  It runs in seconds when running for the server it is trying to commit.

 

Jim

 

 


 

Internal Use


From: Jim Callison
Sent: Thursday, April 24, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com; SQL111 <SQL111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

It seems like the query is using terribly inefficient nested views.  It joins many tables to views, unions, and the views have many internal table joins.

 

If you have any real amount of data this will not run well.  What would have changed related to this for the .137 upgrade?

 

As the issue started immediately after that, it seems the data would not have changed, but the logic of how it is handled might?

 

 

Another thought.  As this data technically should be wiped and re-loaded every time….. we don’t care about history.

 

However there are tables (object and permissions tables) that still contiain much old data.

 

Can we truncate these and try again?

 

Please give me a list of tables that woudl be wise to truncate prior to this load and we will add that to the start of the process.

 

Probably this slow query will run faster if we do that?

 

Jim

 

 

 



 



 



 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, April 24, 2025 1:26 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

Thank you for meeting with me today. In our session we confirmed the connection profile that the SQL permissions scan job is using has appropriate access to the SQL instances. We also used the Connection Wizzard within the SQL job's query filters to confirm the NEA console could connect to the SQL instances. While there are some that throw ""Access Denied"" messages, the job quickly moves on to the next server. I don't believe that is causing the problem. Using SQL Management Studio, we were able to identify the query that is running while the job seems to hang.

The job doesn't truly lock-up; it seems like it does slowly move onto subsequent servers, but it takes 5+ hours per server. The job's stats table shows that before the upgrade, it use to take 6-7 hours to complete the entire job, including scanning all of your SQL servers. We thought the Test environment was complete without issue, but we found that NEA's SQL server's traction log was out of space in that environment. When you cleared space for the log, the SQL Permission job seemed to hang, just like the Prod environment.

We adjusted the host list assignment for the job to target a single SQL server and found it still hung at the final Committing step of the scan. You have already uploaded to the ticket the SQL query that seems to be causing the stall and the debug logs from when just one server was targeted. Thank you for that.

I'm going to raise this issue internally and see if I can more about what that script is doing or what might be going wrong. I appreciate your patience with this. There is a good chance this will be escalated, so I will let you know if I need any additional artifacts. I'll be in touch with next steps as soon as I have them.

Thank you. 

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/23/2025 6:01 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


Debug log attached to ticket.

Jim

 

 


 

Internal Use


From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Thanks Josh.  Scheduled for tomorrow 10am.

 

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

 

Running instances show all threads stuck in “committing data”.

 

We also upgraded test and it seems fine.

 

Thanks
Jim

 

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 



	
		
			
			[External Content] Please use caution.
			
		
	



Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

ref:!00D70091pB.!500Qk0ONmxO:ref","RE: Netwrix Support Ticket #442987 -  - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","techsupport@netwrix.com","Netwrix Support","jim.callison@regions.com","kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com","joshua.sexton@netwrix.com","true","2025-04-25T19:31:43.000Z","true"
"02sQk00000OA8UkIAL","500Qk00000ONmxOIAT","2025-04-25T19:42:24.000Z","2025-04-25T19:42:24.000Z","Hello Jim,

I'm available at the top of the hour, 4:00PM Eastern. 

Here is a link for the meeting:

https://netwrix.zoom.us/j/87645531786?pwd=TkZdJbbWff3E0l8dAmVcZanbnCVj0B.1

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/25/2025 3:31 PM
To: jim.callison@regions.com
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

That should be the process. Unfortunately, I don't have a copy of that old installer. Do you happen to still have it?



Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/25/2025 2:27 PM
To: techsupport@netwrix.com; manoj.gadhia@regions.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref



Is there anyone that can join me this afternoon for a rollback?  Assuming rollback and upgrade are similar.  Uninstall current version, restore database, install older version.  Replace any jobs needed if necessary.

 

Jim

 

 
Internal Use


From: Jim Callison
Sent: Friday, April 25, 2025 10:48 AM
To: Netwrix Support <techsupport@netwrix.com>; Manoj Gadhia <Manoj.Gadhia@Regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

We don’t have a spapshot available.  We have the db backup and the job folder from the prior version.

 

Thanks

Jim

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 10:28 AM
To: Manoj Gadhia <Manoj.Gadhia@Regions.com>; Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com;  sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

Thank you for the additional logs. I will review those as soon as I am able. I have confirmed that the offending query is exactly the same in version 11.6.0.89, but I don't have ready access to an older version. I don't believe I will be able provide any solution by this afternoon, so I understand if you want to roll back.

The best, and easiest, way to roll back would require you to also have a backup of the server. You said you have a backup of the folders, but do you have a backup of the whole server?

Stop the services, restore the database to the backups, then roll the NEA server back to a snapshot. Assuming the backups were all taken from the same version of NEA, there shouldn't be any difficulties with that process.

Please feel free to use this link to schedule a remote session. I've included the T2 Engineer that has been helping me with this.

https://nwxcorp.my.salesforce-sites.com/cts?Id=m6EcG4ueUApCZsGv3ew3wu9Fl8ROYXXq7GvasfXsycM-Z&MeetingID=ybt2YqXueXkSEWcAvKLmdypANpjUq8xTU72ZMjzU1GU-Z

Thank you,


Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Manoj Gadhia [manoj.gadhia@regions.com]
Sent: 4/25/2025 10:30 AM
To: jim.callison@regions.com; techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com;  sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


@Netwrix Support  can we escalate to highest level – as we can not be missing this data too long ? issue should be treated at production outage level.

 


 

Internal Use


From: Jim Callison <Jim.Callison@regions.com>
Sent: Friday, April 25, 2025 9:27 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com;  sina.pourmokhtari@netwrix.com; SQL111 <SQL111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

I am currently running a batch of 26 servers – all “stuck” in the “Committing data” stage for 20 minutes so far.  

I suspect that each will take between 40 minutes and 5 hours each.

There is one thread of the slow query running at the moment (I expected maybe multiple)

 

You can see the current log as below where it is during this stuck commit stage.

 

The single serve run last night completed (I guess) in 43 minutes – log uploaded.

 

I am also uploading the log of the current running “stuck” process as well as the one form last night.

 

Even if any will commit at 43 minutes, that is 3x longer than normal, but I suspect it will run for days and not complete.

 

Unless you have a better idea, we need to roll back our production system this afternoon as we rely on it for capturing sox audit data.

I do have a database backup for production and folders etc from prior to the upgrade.

 

We also need to upgrade test, which I don’t have a db backup for but I suppose we can start with new DB on that one as we can load the servers form a dynamic host list and also we have the previous folders from before migration as well as we can apply prod jobs over there.

 

Thanks

Jim

 



 



 

Current log



 

 

 


 

Internal Use


From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 8:04 AM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

I've been discussing your issue with a T2 engineer and reviewing the logs. In the most recent log you provided, the one where it was only targeting the single SQL server, did it complete on its own, or did you abort the scan? I ask because the logs look like it only sits at that committing step for about 3 minutes then continues on and completes the scan. 

I agree with your findings that the SQL query will be very slow in large SQL environments, especially when there are many, many SQL servers. I'm working to escalate this issue so Dev can examine the query closely, but it would help if I had logs that showed it sitting at that commit step for a long time. Are you able to run the job again, preferably targeting just one server, and let it run for a long time? Then please attach that log along with an export/screenshot of the Job Stats and Task Stats for that run.

Once we have that, there is a couple ways to clear out the SQL permissions data to start a scan fresh. In fact, I believe you already had a job configured to do this, but we didn't examine it closely. Here is a KB on setting up a custom job to drop that data: How to Drop Data Collected from SQL Servers Using the Databases Module
The second half of the KB shows how to drop data for specific servers and/or dropping just the permissions data. I can help with this over a remote session, if you'd like.

Either way, your analysis of the SQL query seems valid. I'm still trying to determine if the query was changed at all between versions. I'm not aware of any SQL changes in the change log.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/24/2025 5:50 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


Looks like there is no WHERE clause on this call.   Meaning for EVERY server, you are running against the entire database.  It SHOULD only be running for the server data it just gathered.

 

Probably this is your issue.

 

Do we need to roll back?  Or can you fix this query.  It runs in seconds when running for the server it is trying to commit.

 

Jim

 

 


 

Internal Use


From: Jim Callison
Sent: Thursday, April 24, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com; SQL111 <SQL111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

It seems like the query is using terribly inefficient nested views.  It joins many tables to views, unions, and the views have many internal table joins.

 

If you have any real amount of data this will not run well.  What would have changed related to this for the .137 upgrade?

 

As the issue started immediately after that, it seems the data would not have changed, but the logic of how it is handled might?

 

 

Another thought.  As this data technically should be wiped and re-loaded every time….. we don’t care about history.

 

However there are tables (object and permissions tables) that still contiain much old data.

 

Can we truncate these and try again?

 

Please give me a list of tables that woudl be wise to truncate prior to this load and we will add that to the start of the process.

 

Probably this slow query will run faster if we do that?

 

Jim

 

 

 



 



 



 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, April 24, 2025 1:26 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

Thank you for meeting with me today. In our session we confirmed the connection profile that the SQL permissions scan job is using has appropriate access to the SQL instances. We also used the Connection Wizzard within the SQL job's query filters to confirm the NEA console could connect to the SQL instances. While there are some that throw ""Access Denied"" messages, the job quickly moves on to the next server. I don't believe that is causing the problem. Using SQL Management Studio, we were able to identify the query that is running while the job seems to hang.

The job doesn't truly lock-up; it seems like it does slowly move onto subsequent servers, but it takes 5+ hours per server. The job's stats table shows that before the upgrade, it use to take 6-7 hours to complete the entire job, including scanning all of your SQL servers. We thought the Test environment was complete without issue, but we found that NEA's SQL server's traction log was out of space in that environment. When you cleared space for the log, the SQL Permission job seemed to hang, just like the Prod environment.

We adjusted the host list assignment for the job to target a single SQL server and found it still hung at the final Committing step of the scan. You have already uploaded to the ticket the SQL query that seems to be causing the stall and the debug logs from when just one server was targeted. Thank you for that.

I'm going to raise this issue internally and see if I can more about what that script is doing or what might be going wrong. I appreciate your patience with this. There is a good chance this will be escalated, so I will let you know if I need any additional artifacts. I'll be in touch with next steps as soon as I have them.

Thank you. 

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/23/2025 6:01 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


Debug log attached to ticket.

Jim

 

 


 

Internal Use


From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Thanks Josh.  Scheduled for tomorrow 10am.

 

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

 

Running instances show all threads stuck in “committing data”.

 

We also upgraded test and it seems fine.

 

Thanks
Jim

 

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 



	
		
			
			[External Content] Please use caution.
			
		
	



Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

ref:!00D70091pB.!500Qk0ONmxO:ref","RE: Netwrix Support Ticket #442987 -  - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","techsupport@netwrix.com","Netwrix Support","jim.callison@regions.com","kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com","joshua.sexton@netwrix.com","true","2025-04-25T19:42:23.000Z","true"
"02sQk00000OA7wzIAD","500Qk00000ONmxOIAT","2025-04-25T20:01:22.000Z","2025-04-25T20:24:10.000Z","ref:_00D7091pB._500Q000ONmxO:ref

Joining - thansk



Internal Use
From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 2:42 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

I'm available at the top of the hour, 4:00PM Eastern.

Here is a link for the meeting:

https://netwrix.zoom.us/j/87645531786?pwd=TkZdJbbWff3E0l8dAmVcZanbnCVj0B.1<https://urldefense.com/v3/__https:/netwrix.zoom.us/j/87645531786?pwd=TkZdJbbWff3E0l8dAmVcZanbnCVj0B.1__;!!DgLF0YGH!6FqjT7B-109oivJ2MWHAGRY4_yaRpyvCSbGshNIERJ67zN0Pzgd14TnlUdFardADxOfhSsN13q3C6Crm11ZifQztqQ$>

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!6FqjT7B-109oivJ2MWHAGRY4_yaRpyvCSbGshNIERJ67zN0Pzgd14TnlUdFardADxOfhSsN13q3C6Crm11ZxxBrJjQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/25/2025 3:31 PM
To: jim.callison@regions.com<mailto:jim.callison@regions.com>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

That should be the process. Unfortunately, I don't have a copy of that old installer. Do you happen to still have it?



Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!6FqjT7B-109oivJ2MWHAGRY4_yaRpyvCSbGshNIERJ67zN0Pzgd14TnlUdFardADxOfhSsN13q3C6Crm11ZxxBrJjQ$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/25/2025 2:27 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; manoj.gadhia@regions.com<mailto:manoj.gadhia@regions.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref


Is there anyone that can join me this afternoon for a rollback?  Assuming rollback and upgrade are similar.  Uninstall current version, restore database, install older version.  Replace any jobs needed if necessary.

Jim



Internal Use
From: Jim Callison
Sent: Friday, April 25, 2025 10:48 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Manoj Gadhia <Manoj.Gadhia@Regions.com<mailto:Manoj.Gadhia@Regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

We don’t have a spapshot available.  We have the db backup and the job folder from the prior version.

Thanks
Jim

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Friday, April 25, 2025 10:28 AM
To: Manoj Gadhia <Manoj.Gadhia@Regions.com<mailto:Manoj.Gadhia@Regions.com>>; Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

Thank you for the additional logs. I will review those as soon as I am able. I have confirmed that the offending query is exactly the same in version 11.6.0.89, but I don't have ready access to an older version. I don't believe I will be able provide any solution by this afternoon, so I understand if you want to roll back.

The best, and easiest, way to roll back would require you to also have a backup of the server. You said you have a backup of the folders, but do you have a backup of the whole server?

Stop the services, restore the database to the backups, then roll the NEA server back to a snapshot. Assuming the backups were all taken from the same version of NEA, there shouldn't be any difficulties with that process.

Please feel free to use this link to schedule a remote session. I've included the T2 Engineer that has been helping me with this.

https://nwxcorp.my.salesforce-sites.com/cts?Id=m6EcG4ueUApCZsGv3ew3wu9Fl8ROYXXq7GvasfXsycM-Z&MeetingID=ybt2YqXueXkSEWcAvKLmdypANpjUq8xTU72ZMjzU1GU-Z<https://urldefense.com/v3/__https:/nwxcorp.my.salesforce-sites.com/cts?Id=m6EcG4ueUApCZsGv3ew3wu9Fl8ROYXXq7GvasfXsycM-Z&MeetingID=ybt2YqXueXkSEWcAvKLmdypANpjUq8xTU72ZMjzU1GU-Z__;!!DgLF0YGH!57h6O2CKk0nWgtG8ebuBcn4ZuClqMaQRzB4I0BUKf1_T8agzx0VFM2NLdwKan9N3sh2xu35FZiYbXzUcBoklhWIiNQ$>

Thank you,


Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!57h6O2CKk0nWgtG8ebuBcn4ZuClqMaQRzB4I0BUKf1_T8agzx0VFM2NLdwKan9N3sh2xu35FZiYbXzUcBol5LMJWTA$>


--------------- Original Message ---------------
From: Manoj Gadhia [manoj.gadhia@regions.com]
Sent: 4/25/2025 10:30 AM
To: jim.callison@regions.com<mailto:jim.callison@regions.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

@Netwrix Support<mailto:techsupport@netwrix.com>  can we escalate to highest level – as we can not be missing this data too long ? issue should be treated at production outage level.



Internal Use
From: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Sent: Friday, April 25, 2025 9:27 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; SQL111 <SQL111@regions.com<mailto:SQL111@regions.com>>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

I am currently running a batch of 26 servers – all “stuck” in the “Committing data” stage for 20 minutes so far.
I suspect that each will take between 40 minutes and 5 hours each.
There is one thread of the slow query running at the moment (I expected maybe multiple)

You can see the current log as below where it is during this stuck commit stage.

The single serve run last night completed (I guess) in 43 minutes – log uploaded.

I am also uploading the log of the current running “stuck” process as well as the one form last night.

Even if any will commit at 43 minutes, that is 3x longer than normal, but I suspect it will run for days and not complete.

Unless you have a better idea, we need to roll back our production system this afternoon as we rely on it for capturing sox audit data.
I do have a database backup for production and folders etc from prior to the upgrade.

We also need to upgrade test, which I don’t have a db backup for but I suppose we can start with new DB on that one as we can load the servers form a dynamic host list and also we have the previous folders from before migration as well as we can apply prod jobs over there.

Thanks
Jim

[cid:image001.png@01DBB5F2.D6900F40]

[cid:image002.png@01DBB5F2.D6900F40]

Current log
[cid:image003.png@01DBB5F2.D6900F40]





Internal Use
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Friday, April 25, 2025 8:04 AM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

I've been discussing your issue with a T2 engineer and reviewing the logs. In the most recent log you provided, the one where it was only targeting the single SQL server, did it complete on its own, or did you abort the scan? I ask because the logs look like it only sits at that committing step for about 3 minutes then continues on and completes the scan.

I agree with your findings that the SQL query will be very slow in large SQL environments, especially when there are many, many SQL servers. I'm working to escalate this issue so Dev can examine the query closely, but it would help if I had logs that showed it sitting at that commit step for a long time. Are you able to run the job again, preferably targeting just one server, and let it run for a long time? Then please attach that log along with an export/screenshot of the Job Stats and Task Stats for that run.

Once we have that, there is a couple ways to clear out the SQL permissions data to start a scan fresh. In fact, I believe you already had a job configured to do this, but we didn't examine it closely. Here is a KB on setting up a custom job to drop that data: How to Drop Data Collected from SQL Servers Using the Databases Module<https://urldefense.com/v3/__https:/helpcenter.netwrix.com/bundle/z-kb-articles-salesforce/page/kA0Qk0000001lGDKAY.html__;!!DgLF0YGH!_aop0YYcdeAqjFp4fI9qmWjgdGLOfCE0ziyeypIGOrldHab5BWlTJjvC4PodygFP9kUl2Z4sAYWI-NHFv8Lb7j2yGw$>
The second half of the KB shows how to drop data for specific servers and/or dropping just the permissions data. I can help with this over a remote session, if you'd like.

Either way, your analysis of the SQL query seems valid. I'm still trying to determine if the query was changed at all between versions. I'm not aware of any SQL changes in the change log.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!_aop0YYcdeAqjFp4fI9qmWjgdGLOfCE0ziyeypIGOrldHab5BWlTJjvC4PodygFP9kUl2Z4sAYWI-NHFv8Lvnr3Z8w$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/24/2025 5:50 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

Looks like there is no WHERE clause on this call.   Meaning for EVERY server, you are running against the entire database.  It SHOULD only be running for the server data it just gathered.

Probably this is your issue.

Do we need to roll back?  Or can you fix this query.  It runs in seconds when running for the server it is trying to commit.

Jim




Internal Use
From: Jim Callison
Sent: Thursday, April 24, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; SQL111 <SQL111@regions.com<mailto:SQL111@regions.com>>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

It seems like the query is using terribly inefficient nested views.  It joins many tables to views, unions, and the views have many internal table joins.

If you have any real amount of data this will not run well.  What would have changed related to this for the .137 upgrade?

As the issue started immediately after that, it seems the data would not have changed, but the logic of how it is handled might?


Another thought.  As this data technically should be wiped and re-loaded every time….. we don’t care about history.

However there are tables (object and permissions tables) that still contiain much old data.

Can we truncate these and try again?

Please give me a list of tables that woudl be wise to truncate prior to this load and we will add that to the start of the process.

Probably this slow query will run faster if we do that?

Jim



[cid:image004.png@01DBB5F2.D6900F40]

[cid:image005.png@01DBB5F2.D6900F40]

[cid:image006.png@01DBB5F2.D6900F40]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, April 24, 2025 1:26 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]


Hello Jim,

Thank you for meeting with me today. In our session we confirmed the connection profile that the SQL permissions scan job is using has appropriate access to the SQL instances. We also used the Connection Wizzard within the SQL job's query filters to confirm the NEA console could connect to the SQL instances. While there are some that throw ""Access Denied"" messages, the job quickly moves on to the next server. I don't believe that is causing the problem. Using SQL Management Studio, we were able to identify the query that is running while the job seems to hang.

The job doesn't truly lock-up; it seems like it does slowly move onto subsequent servers, but it takes 5+ hours per server. The job's stats table shows that before the upgrade, it use to take 6-7 hours to complete the entire job, including scanning all of your SQL servers. We thought the Test environment was complete without issue, but we found that NEA's SQL server's traction log was out of space in that environment. When you cleared space for the log, the SQL Permission job seemed to hang, just like the Prod environment.

We adjusted the host list assignment for the job to target a single SQL server and found it still hung at the final Committing step of the scan. You have already uploaded to the ticket the SQL query that seems to be causing the stall and the debug logs from when just one server was targeted. Thank you for that.

I'm going to raise this issue internally and see if I can more about what that script is doing or what might be going wrong. I appreciate your patience with this. There is a good chance this will be escalated, so I will let you know if I need any additional artifacts. I'll be in touch with next steps as soon as I have them.

Thank you.

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!-gflWOTWUk4qHyJyRwCkZmWogLCMahjO0LRwu7VJ9B4mWSlpDGdQxixzLbNyUsEwmgpiEmgCnHjMHR-65A_Il8wmLg$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/23/2025 6:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

Debug log attached to ticket.
Jim




Internal Use
From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Thanks Josh.  Scheduled for tomorrow 10am.

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

Running instances show all threads stuck in “committing data”.

We also upgraded test and it seems fine.

Thanks
Jim


From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

[External Content] Please use caution.
Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z<https://urldefense.com/v3/__https:/nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXP7cPRPQw$>

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXPzV6Vg3Q$>

ref:!00D70091pB.!500Qk0ONmxO:ref



[https://nwxcorp.my.salesforce.com/servlet/servlet.ImageServer?oid=00D7000000091pB&esid=018Qk00000LbLKk&from=ext]
 [https://nwxcorp.my.salesforce.com/servlet/servlet.ImageServer?oid=00D7000000091pB&esid=018Qk00000LbSvh&from=ext]","RE: Netwrix Support Ticket #442987 -  - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","jim.callison@regions.com","Jim Callison","techsupport@netwrix.com","sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com","","true","2025-04-25T20:00:57.000Z","true"
"02sQk00000OAQ53IAH","500Qk00000ONmxOIAT","2025-04-25T21:12:39.000Z","2025-04-25T21:12:39.000Z","Hello Jim,

Thank you for meeting with Nick and me. In our meeting we upgraded your test and prod deployments of Netwrix Enterprise Auditor to version 11.6.0.141. This version includes a fix for the SQL Permissions Scan the did seem to resolve the issue you were having in production. Interestingly, the test environment is still hanging at the same place, but NEA now identifies it with the message ""slow thread"".

Like we discussed, please let a SQL Permissions scan run over the weekend including all of the servers. Please let me know on Monday how it looks.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/25/2025 4:00 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref



Joining - thansk

 

 
Internal Use


From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 2:42 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

I'm available at the top of the hour, 4:00PM Eastern. 

Here is a link for the meeting:

https://netwrix.zoom.us/j/87645531786?pwd=TkZdJbbWff3E0l8dAmVcZanbnCVj0B.1

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/25/2025 3:31 PM
To: jim.callison@regions.com
Cc: kyle.vogley@netwrix.com;  sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

That should be the process. Unfortunately, I don't have a copy of that old installer. Do you happen to still have it?



Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/25/2025 2:27 PM
To: techsupport@netwrix.com;  manoj.gadhia@regions.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

 


Is there anyone that can join me this afternoon for a rollback?  Assuming rollback and upgrade are similar.  Uninstall current version, restore database, install older version.  Replace any jobs needed if necessary.

 

Jim

 


 

Internal Use


From: Jim Callison
Sent: Friday, April 25, 2025 10:48 AM
To: Netwrix Support <techsupport@netwrix.com>; Manoj Gadhia <Manoj.Gadhia@Regions.com>
Cc: kyle.vogley@netwrix.com;  sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

We don’t have a spapshot available.  We have the db backup and the job folder from the prior version.

 

Thanks

Jim

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 10:28 AM
To: Manoj Gadhia <Manoj.Gadhia@Regions.com>; Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

Thank you for the additional logs. I will review those as soon as I am able. I have confirmed that the offending query is exactly the same in version 11.6.0.89, but I don't have ready access to an older version. I don't believe I will be able provide any solution by this afternoon, so I understand if you want to roll back.

The best, and easiest, way to roll back would require you to also have a backup of the server. You said you have a backup of the folders, but do you have a backup of the whole server?

Stop the services, restore the database to the backups, then roll the NEA server back to a snapshot. Assuming the backups were all taken from the same version of NEA, there shouldn't be any difficulties with that process.

Please feel free to use this link to schedule a remote session. I've included the T2 Engineer that has been helping me with this.

https://nwxcorp.my.salesforce-sites.com/cts?Id=m6EcG4ueUApCZsGv3ew3wu9Fl8ROYXXq7GvasfXsycM-Z&MeetingID=ybt2YqXueXkSEWcAvKLmdypANpjUq8xTU72ZMjzU1GU-Z

Thank you,


Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Manoj Gadhia [manoj.gadhia@regions.com]
Sent: 4/25/2025 10:30 AM
To: jim.callison@regions.com; techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


@Netwrix Support  can we escalate to highest level – as we can not be missing this data too long ? issue should be treated at production outage level.

 


 

Internal Use


From: Jim Callison <Jim.Callison@regions.com>
Sent: Friday, April 25, 2025 9:27 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com; SQL111 <SQL111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

I am currently running a batch of 26 servers – all “stuck” in the “Committing data” stage for 20 minutes so far.  

I suspect that each will take between 40 minutes and 5 hours each.

There is one thread of the slow query running at the moment (I expected maybe multiple)

 

You can see the current log as below where it is during this stuck commit stage.

 

The single serve run last night completed (I guess) in 43 minutes – log uploaded.

 

I am also uploading the log of the current running “stuck” process as well as the one form last night.

 

Even if any will commit at 43 minutes, that is 3x longer than normal, but I suspect it will run for days and not complete.

 

Unless you have a better idea, we need to roll back our production system this afternoon as we rely on it for capturing sox audit data.

I do have a database backup for production and folders etc from prior to the upgrade.

 

We also need to upgrade test, which I don’t have a db backup for but I suppose we can start with new DB on that one as we can load the servers form a dynamic host list and also we have the previous folders from before migration as well as we can apply prod jobs over there.

 

Thanks

Jim

 



 



 

Current log



 

 

 


 

Internal Use


From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 8:04 AM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

I've been discussing your issue with a T2 engineer and reviewing the logs. In the most recent log you provided, the one where it was only targeting the single SQL server, did it complete on its own, or did you abort the scan? I ask because the logs look like it only sits at that committing step for about 3 minutes then continues on and completes the scan. 

I agree with your findings that the SQL query will be very slow in large SQL environments, especially when there are many, many SQL servers. I'm working to escalate this issue so Dev can examine the query closely, but it would help if I had logs that showed it sitting at that commit step for a long time. Are you able to run the job again, preferably targeting just one server, and let it run for a long time? Then please attach that log along with an export/screenshot of the Job Stats and Task Stats for that run.

Once we have that, there is a couple ways to clear out the SQL permissions data to start a scan fresh. In fact, I believe you already had a job configured to do this, but we didn't examine it closely. Here is a KB on setting up a custom job to drop that data: How to Drop Data Collected from SQL Servers Using the Databases Module
The second half of the KB shows how to drop data for specific servers and/or dropping just the permissions data. I can help with this over a remote session, if you'd like.

Either way, your analysis of the SQL query seems valid. I'm still trying to determine if the query was changed at all between versions. I'm not aware of any SQL changes in the change log.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/24/2025 5:50 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


Looks like there is no WHERE clause on this call.   Meaning for EVERY server, you are running against the entire database.  It SHOULD only be running for the server data it just gathered.

 

Probably this is your issue.

 

Do we need to roll back?  Or can you fix this query.  It runs in seconds when running for the server it is trying to commit.

 

Jim

 

 


 

Internal Use


From: Jim Callison
Sent: Thursday, April 24, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com; SQL111 <SQL111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

It seems like the query is using terribly inefficient nested views.  It joins many tables to views, unions, and the views have many internal table joins.

 

If you have any real amount of data this will not run well.  What would have changed related to this for the .137 upgrade?

 

As the issue started immediately after that, it seems the data would not have changed, but the logic of how it is handled might?

 

 

Another thought.  As this data technically should be wiped and re-loaded every time….. we don’t care about history.

 

However there are tables (object and permissions tables) that still contiain much old data.

 

Can we truncate these and try again?

 

Please give me a list of tables that woudl be wise to truncate prior to this load and we will add that to the start of the process.

 

Probably this slow query will run faster if we do that?

 

Jim

 

 

 



 



 



 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, April 24, 2025 1:26 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

Thank you for meeting with me today. In our session we confirmed the connection profile that the SQL permissions scan job is using has appropriate access to the SQL instances. We also used the Connection Wizzard within the SQL job's query filters to confirm the NEA console could connect to the SQL instances. While there are some that throw ""Access Denied"" messages, the job quickly moves on to the next server. I don't believe that is causing the problem. Using SQL Management Studio, we were able to identify the query that is running while the job seems to hang.

The job doesn't truly lock-up; it seems like it does slowly move onto subsequent servers, but it takes 5+ hours per server. The job's stats table shows that before the upgrade, it use to take 6-7 hours to complete the entire job, including scanning all of your SQL servers. We thought the Test environment was complete without issue, but we found that NEA's SQL server's traction log was out of space in that environment. When you cleared space for the log, the SQL Permission job seemed to hang, just like the Prod environment.

We adjusted the host list assignment for the job to target a single SQL server and found it still hung at the final Committing step of the scan. You have already uploaded to the ticket the SQL query that seems to be causing the stall and the debug logs from when just one server was targeted. Thank you for that.

I'm going to raise this issue internally and see if I can more about what that script is doing or what might be going wrong. I appreciate your patience with this. There is a good chance this will be escalated, so I will let you know if I need any additional artifacts. I'll be in touch with next steps as soon as I have them.

Thank you. 

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/23/2025 6:01 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


Debug log attached to ticket.

Jim

 

 


 

Internal Use


From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Thanks Josh.  Scheduled for tomorrow 10am.

 

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

 

Running instances show all threads stuck in “committing data”.

 

We also upgraded test and it seems fine.

 

Thanks
Jim

 

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 



	
		
			
			[External Content] Please use caution.
			
		
	



Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

ref:!00D70091pB.!500Qk0ONmxO:ref","RE: Netwrix Support Ticket #442987 -  - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","techsupport@netwrix.com","Netwrix Support","jim.callison@regions.com","kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com","joshua.sexton@netwrix.com","true","2025-04-25T21:12:38.000Z","true"
"02sQk00000OAQg9IAH","500Qk00000ONmxOIAT","2025-04-25T21:15:52.000Z","2025-04-25T21:17:32.000Z","ref:_00D7091pB._500Q000ONmxO:ref

Hey Josh.
Thanks for working with us.  Prod seems to be running well so we will let it run over the weekend and check in Monday.

Thanks!

Jim





Internal Use
From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 4:13 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

Thank you for meeting with Nick and me. In our meeting we upgraded your test and prod deployments of Netwrix Enterprise Auditor to version 11.6.0.141. This version includes a fix for the SQL Permissions Scan the did seem to resolve the issue you were having in production. Interestingly, the test environment is still hanging at the same place, but NEA now identifies it with the message ""slow thread"".

Like we discussed, please let a SQL Permissions scan run over the weekend including all of the servers. Please let me know on Monday how it looks.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!4xE_Mu34_Ejl__-2o4ULmWhYhptw7opk62jHiMAQ7qNxxNTOcWJfieJYfSFIq8hgxa-IRiPWjwP0x5-PdfwSp_mPgw$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/25/2025 4:00 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref


Joining - thansk



Internal Use
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Friday, April 25, 2025 2:42 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

I'm available at the top of the hour, 4:00PM Eastern.

Here is a link for the meeting:

https://netwrix.zoom.us/j/87645531786?pwd=TkZdJbbWff3E0l8dAmVcZanbnCVj0B.1<https://urldefense.com/v3/__https:/netwrix.zoom.us/j/87645531786?pwd=TkZdJbbWff3E0l8dAmVcZanbnCVj0B.1__;!!DgLF0YGH!6FqjT7B-109oivJ2MWHAGRY4_yaRpyvCSbGshNIERJ67zN0Pzgd14TnlUdFardADxOfhSsN13q3C6Crm11ZifQztqQ$>

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!6FqjT7B-109oivJ2MWHAGRY4_yaRpyvCSbGshNIERJ67zN0Pzgd14TnlUdFardADxOfhSsN13q3C6Crm11ZxxBrJjQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/25/2025 3:31 PM
To: jim.callison@regions.com<mailto:jim.callison@regions.com>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

That should be the process. Unfortunately, I don't have a copy of that old installer. Do you happen to still have it?



Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!6FqjT7B-109oivJ2MWHAGRY4_yaRpyvCSbGshNIERJ67zN0Pzgd14TnlUdFardADxOfhSsN13q3C6Crm11ZxxBrJjQ$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/25/2025 2:27 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; manoj.gadhia@regions.com<mailto:manoj.gadhia@regions.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref


Is there anyone that can join me this afternoon for a rollback?  Assuming rollback and upgrade are similar.  Uninstall current version, restore database, install older version.  Replace any jobs needed if necessary.

Jim



Internal Use
From: Jim Callison
Sent: Friday, April 25, 2025 10:48 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Manoj Gadhia <Manoj.Gadhia@Regions.com<mailto:Manoj.Gadhia@Regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

We don’t have a spapshot available.  We have the db backup and the job folder from the prior version.

Thanks
Jim

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Friday, April 25, 2025 10:28 AM
To: Manoj Gadhia <Manoj.Gadhia@Regions.com<mailto:Manoj.Gadhia@Regions.com>>; Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

Thank you for the additional logs. I will review those as soon as I am able. I have confirmed that the offending query is exactly the same in version 11.6.0.89, but I don't have ready access to an older version. I don't believe I will be able provide any solution by this afternoon, so I understand if you want to roll back.

The best, and easiest, way to roll back would require you to also have a backup of the server. You said you have a backup of the folders, but do you have a backup of the whole server?

Stop the services, restore the database to the backups, then roll the NEA server back to a snapshot. Assuming the backups were all taken from the same version of NEA, there shouldn't be any difficulties with that process.

Please feel free to use this link to schedule a remote session. I've included the T2 Engineer that has been helping me with this.

https://nwxcorp.my.salesforce-sites.com/cts?Id=m6EcG4ueUApCZsGv3ew3wu9Fl8ROYXXq7GvasfXsycM-Z&MeetingID=ybt2YqXueXkSEWcAvKLmdypANpjUq8xTU72ZMjzU1GU-Z<https://urldefense.com/v3/__https:/nwxcorp.my.salesforce-sites.com/cts?Id=m6EcG4ueUApCZsGv3ew3wu9Fl8ROYXXq7GvasfXsycM-Z&MeetingID=ybt2YqXueXkSEWcAvKLmdypANpjUq8xTU72ZMjzU1GU-Z__;!!DgLF0YGH!57h6O2CKk0nWgtG8ebuBcn4ZuClqMaQRzB4I0BUKf1_T8agzx0VFM2NLdwKan9N3sh2xu35FZiYbXzUcBoklhWIiNQ$>

Thank you,


Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!57h6O2CKk0nWgtG8ebuBcn4ZuClqMaQRzB4I0BUKf1_T8agzx0VFM2NLdwKan9N3sh2xu35FZiYbXzUcBol5LMJWTA$>


--------------- Original Message ---------------
From: Manoj Gadhia [manoj.gadhia@regions.com]
Sent: 4/25/2025 10:30 AM
To: jim.callison@regions.com<mailto:jim.callison@regions.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

@Netwrix Support<mailto:techsupport@netwrix.com>  can we escalate to highest level – as we can not be missing this data too long ? issue should be treated at production outage level.



Internal Use
From: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Sent: Friday, April 25, 2025 9:27 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; SQL111 <SQL111@regions.com<mailto:SQL111@regions.com>>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

I am currently running a batch of 26 servers – all “stuck” in the “Committing data” stage for 20 minutes so far.
I suspect that each will take between 40 minutes and 5 hours each.
There is one thread of the slow query running at the moment (I expected maybe multiple)

You can see the current log as below where it is during this stuck commit stage.

The single serve run last night completed (I guess) in 43 minutes – log uploaded.

I am also uploading the log of the current running “stuck” process as well as the one form last night.

Even if any will commit at 43 minutes, that is 3x longer than normal, but I suspect it will run for days and not complete.

Unless you have a better idea, we need to roll back our production system this afternoon as we rely on it for capturing sox audit data.
I do have a database backup for production and folders etc from prior to the upgrade.

We also need to upgrade test, which I don’t have a db backup for but I suppose we can start with new DB on that one as we can load the servers form a dynamic host list and also we have the previous folders from before migration as well as we can apply prod jobs over there.

Thanks
Jim

[cid:image001.png@01DBB5FD.41244150]

[cid:image002.png@01DBB5FD.41244150]

Current log
[cid:image003.png@01DBB5FD.41244150]





Internal Use
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Friday, April 25, 2025 8:04 AM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

I've been discussing your issue with a T2 engineer and reviewing the logs. In the most recent log you provided, the one where it was only targeting the single SQL server, did it complete on its own, or did you abort the scan? I ask because the logs look like it only sits at that committing step for about 3 minutes then continues on and completes the scan.

I agree with your findings that the SQL query will be very slow in large SQL environments, especially when there are many, many SQL servers. I'm working to escalate this issue so Dev can examine the query closely, but it would help if I had logs that showed it sitting at that commit step for a long time. Are you able to run the job again, preferably targeting just one server, and let it run for a long time? Then please attach that log along with an export/screenshot of the Job Stats and Task Stats for that run.

Once we have that, there is a couple ways to clear out the SQL permissions data to start a scan fresh. In fact, I believe you already had a job configured to do this, but we didn't examine it closely. Here is a KB on setting up a custom job to drop that data: How to Drop Data Collected from SQL Servers Using the Databases Module<https://urldefense.com/v3/__https:/helpcenter.netwrix.com/bundle/z-kb-articles-salesforce/page/kA0Qk0000001lGDKAY.html__;!!DgLF0YGH!_aop0YYcdeAqjFp4fI9qmWjgdGLOfCE0ziyeypIGOrldHab5BWlTJjvC4PodygFP9kUl2Z4sAYWI-NHFv8Lb7j2yGw$>
The second half of the KB shows how to drop data for specific servers and/or dropping just the permissions data. I can help with this over a remote session, if you'd like.

Either way, your analysis of the SQL query seems valid. I'm still trying to determine if the query was changed at all between versions. I'm not aware of any SQL changes in the change log.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!_aop0YYcdeAqjFp4fI9qmWjgdGLOfCE0ziyeypIGOrldHab5BWlTJjvC4PodygFP9kUl2Z4sAYWI-NHFv8Lvnr3Z8w$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/24/2025 5:50 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

Looks like there is no WHERE clause on this call.   Meaning for EVERY server, you are running against the entire database.  It SHOULD only be running for the server data it just gathered.

Probably this is your issue.

Do we need to roll back?  Or can you fix this query.  It runs in seconds when running for the server it is trying to commit.

Jim




Internal Use
From: Jim Callison
Sent: Thursday, April 24, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; SQL111 <SQL111@regions.com<mailto:SQL111@regions.com>>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

It seems like the query is using terribly inefficient nested views.  It joins many tables to views, unions, and the views have many internal table joins.

If you have any real amount of data this will not run well.  What would have changed related to this for the .137 upgrade?

As the issue started immediately after that, it seems the data would not have changed, but the logic of how it is handled might?


Another thought.  As this data technically should be wiped and re-loaded every time….. we don’t care about history.

However there are tables (object and permissions tables) that still contiain much old data.

Can we truncate these and try again?

Please give me a list of tables that woudl be wise to truncate prior to this load and we will add that to the start of the process.

Probably this slow query will run faster if we do that?

Jim



[cid:image004.png@01DBB5FD.41244150]

[cid:image005.png@01DBB5FD.41244150]

[cid:image006.png@01DBB5FD.41244150]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, April 24, 2025 1:26 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]


Hello Jim,

Thank you for meeting with me today. In our session we confirmed the connection profile that the SQL permissions scan job is using has appropriate access to the SQL instances. We also used the Connection Wizzard within the SQL job's query filters to confirm the NEA console could connect to the SQL instances. While there are some that throw ""Access Denied"" messages, the job quickly moves on to the next server. I don't believe that is causing the problem. Using SQL Management Studio, we were able to identify the query that is running while the job seems to hang.

The job doesn't truly lock-up; it seems like it does slowly move onto subsequent servers, but it takes 5+ hours per server. The job's stats table shows that before the upgrade, it use to take 6-7 hours to complete the entire job, including scanning all of your SQL servers. We thought the Test environment was complete without issue, but we found that NEA's SQL server's traction log was out of space in that environment. When you cleared space for the log, the SQL Permission job seemed to hang, just like the Prod environment.

We adjusted the host list assignment for the job to target a single SQL server and found it still hung at the final Committing step of the scan. You have already uploaded to the ticket the SQL query that seems to be causing the stall and the debug logs from when just one server was targeted. Thank you for that.

I'm going to raise this issue internally and see if I can more about what that script is doing or what might be going wrong. I appreciate your patience with this. There is a good chance this will be escalated, so I will let you know if I need any additional artifacts. I'll be in touch with next steps as soon as I have them.

Thank you.

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!-gflWOTWUk4qHyJyRwCkZmWogLCMahjO0LRwu7VJ9B4mWSlpDGdQxixzLbNyUsEwmgpiEmgCnHjMHR-65A_Il8wmLg$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/23/2025 6:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

Debug log attached to ticket.
Jim




Internal Use
From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Thanks Josh.  Scheduled for tomorrow 10am.

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

Running instances show all threads stuck in “committing data”.

We also upgraded test and it seems fine.

Thanks
Jim


From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

[External Content] Please use caution.
Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z<https://urldefense.com/v3/__https:/nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXP7cPRPQw$>

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXPzV6Vg3Q$>

ref:!00D70091pB.!500Qk0ONmxO:ref





[https://nwxcorp.my.salesforce.com/servlet/servlet.ImageServer?oid=00D7000000091pB&esid=018Qk00000Lbjjd&from=ext]","RE: Netwrix Support Ticket #442987 -  - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","jim.callison@regions.com","Jim Callison","techsupport@netwrix.com","sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com","","true","2025-04-25T21:15:31.000Z","true"
"02sQk00000OElfgIAD","500Qk00000ONmxOIAT","2025-04-28T18:13:38.000Z","2025-04-28T18:13:38.000Z","Hello Jim,

I'm just following up. How'd the SQL permission scan go over the weekend?

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/25/2025 5:15 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref



Hey Josh.

Thanks for working with us.  Prod seems to be running well so we will let it run over the weekend and check in Monday.


Thanks!

 

Jim

 

 

 

 
Internal Use


From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 4:13 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

Thank you for meeting with Nick and me. In our meeting we upgraded your test and prod deployments of Netwrix Enterprise Auditor to version 11.6.0.141. This version includes a fix for the SQL Permissions Scan the did seem to resolve the issue you were having in production. Interestingly, the test environment is still hanging at the same place, but NEA now identifies it with the message ""slow thread"".

Like we discussed, please let a SQL Permissions scan run over the weekend including all of the servers. Please let me know on Monday how it looks.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/25/2025 4:00 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

 


Joining - thansk

 


 

Internal Use


From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 2:42 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com;  sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

I'm available at the top of the hour, 4:00PM Eastern. 

Here is a link for the meeting:

https://netwrix.zoom.us/j/87645531786?pwd=TkZdJbbWff3E0l8dAmVcZanbnCVj0B.1

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/25/2025 3:31 PM
To: jim.callison@regions.com
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

That should be the process. Unfortunately, I don't have a copy of that old installer. Do you happen to still have it?



Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/25/2025 2:27 PM
To: techsupport@netwrix.com; manoj.gadhia@regions.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

 


Is there anyone that can join me this afternoon for a rollback?  Assuming rollback and upgrade are similar.  Uninstall current version, restore database, install older version.  Replace any jobs needed if necessary.

 

Jim

 


 

Internal Use


From: Jim Callison
Sent: Friday, April 25, 2025 10:48 AM
To: Netwrix Support <techsupport@netwrix.com>; Manoj Gadhia <Manoj.Gadhia@Regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

We don’t have a spapshot available.  We have the db backup and the job folder from the prior version.

 

Thanks

Jim

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 10:28 AM
To: Manoj Gadhia <Manoj.Gadhia@Regions.com>; Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

Thank you for the additional logs. I will review those as soon as I am able. I have confirmed that the offending query is exactly the same in version 11.6.0.89, but I don't have ready access to an older version. I don't believe I will be able provide any solution by this afternoon, so I understand if you want to roll back.

The best, and easiest, way to roll back would require you to also have a backup of the server. You said you have a backup of the folders, but do you have a backup of the whole server?

Stop the services, restore the database to the backups, then roll the NEA server back to a snapshot. Assuming the backups were all taken from the same version of NEA, there shouldn't be any difficulties with that process.

Please feel free to use this link to schedule a remote session. I've included the T2 Engineer that has been helping me with this.

https://nwxcorp.my.salesforce-sites.com/cts?Id=m6EcG4ueUApCZsGv3ew3wu9Fl8ROYXXq7GvasfXsycM-Z&MeetingID=ybt2YqXueXkSEWcAvKLmdypANpjUq8xTU72ZMjzU1GU-Z

Thank you,


Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Manoj Gadhia [manoj.gadhia@regions.com]
Sent: 4/25/2025 10:30 AM
To: jim.callison@regions.com; techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


@Netwrix Support  can we escalate to highest level – as we can not be missing this data too long ? issue should be treated at production outage level.

 


 

Internal Use


From: Jim Callison <Jim.Callison@regions.com>
Sent: Friday, April 25, 2025 9:27 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com; SQL111 <SQL111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

I am currently running a batch of 26 servers – all “stuck” in the “Committing data” stage for 20 minutes so far.  

I suspect that each will take between 40 minutes and 5 hours each.

There is one thread of the slow query running at the moment (I expected maybe multiple)

 

You can see the current log as below where it is during this stuck commit stage.

 

The single serve run last night completed (I guess) in 43 minutes – log uploaded.

 

I am also uploading the log of the current running “stuck” process as well as the one form last night.

 

Even if any will commit at 43 minutes, that is 3x longer than normal, but I suspect it will run for days and not complete.

 

Unless you have a better idea, we need to roll back our production system this afternoon as we rely on it for capturing sox audit data.

I do have a database backup for production and folders etc from prior to the upgrade.

 

We also need to upgrade test, which I don’t have a db backup for but I suppose we can start with new DB on that one as we can load the servers form a dynamic host list and also we have the previous folders from before migration as well as we can apply prod jobs over there.

 

Thanks

Jim

 



 



 

Current log



 

 

 


 

Internal Use


From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 8:04 AM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

I've been discussing your issue with a T2 engineer and reviewing the logs. In the most recent log you provided, the one where it was only targeting the single SQL server, did it complete on its own, or did you abort the scan? I ask because the logs look like it only sits at that committing step for about 3 minutes then continues on and completes the scan. 

I agree with your findings that the SQL query will be very slow in large SQL environments, especially when there are many, many SQL servers. I'm working to escalate this issue so Dev can examine the query closely, but it would help if I had logs that showed it sitting at that commit step for a long time. Are you able to run the job again, preferably targeting just one server, and let it run for a long time? Then please attach that log along with an export/screenshot of the Job Stats and Task Stats for that run.

Once we have that, there is a couple ways to clear out the SQL permissions data to start a scan fresh. In fact, I believe you already had a job configured to do this, but we didn't examine it closely. Here is a KB on setting up a custom job to drop that data: How to Drop Data Collected from SQL Servers Using the Databases Module
The second half of the KB shows how to drop data for specific servers and/or dropping just the permissions data. I can help with this over a remote session, if you'd like.

Either way, your analysis of the SQL query seems valid. I'm still trying to determine if the query was changed at all between versions. I'm not aware of any SQL changes in the change log.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/24/2025 5:50 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


Looks like there is no WHERE clause on this call.   Meaning for EVERY server, you are running against the entire database.  It SHOULD only be running for the server data it just gathered.

 

Probably this is your issue.

 

Do we need to roll back?  Or can you fix this query.  It runs in seconds when running for the server it is trying to commit.

 

Jim

 

 


 

Internal Use


From: Jim Callison
Sent: Thursday, April 24, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com; SQL111 <SQL111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

It seems like the query is using terribly inefficient nested views.  It joins many tables to views, unions, and the views have many internal table joins.

 

If you have any real amount of data this will not run well.  What would have changed related to this for the .137 upgrade?

 

As the issue started immediately after that, it seems the data would not have changed, but the logic of how it is handled might?

 

 

Another thought.  As this data technically should be wiped and re-loaded every time….. we don’t care about history.

 

However there are tables (object and permissions tables) that still contiain much old data.

 

Can we truncate these and try again?

 

Please give me a list of tables that woudl be wise to truncate prior to this load and we will add that to the start of the process.

 

Probably this slow query will run faster if we do that?

 

Jim

 

 

 



 



 



 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, April 24, 2025 1:26 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

Thank you for meeting with me today. In our session we confirmed the connection profile that the SQL permissions scan job is using has appropriate access to the SQL instances. We also used the Connection Wizzard within the SQL job's query filters to confirm the NEA console could connect to the SQL instances. While there are some that throw ""Access Denied"" messages, the job quickly moves on to the next server. I don't believe that is causing the problem. Using SQL Management Studio, we were able to identify the query that is running while the job seems to hang.

The job doesn't truly lock-up; it seems like it does slowly move onto subsequent servers, but it takes 5+ hours per server. The job's stats table shows that before the upgrade, it use to take 6-7 hours to complete the entire job, including scanning all of your SQL servers. We thought the Test environment was complete without issue, but we found that NEA's SQL server's traction log was out of space in that environment. When you cleared space for the log, the SQL Permission job seemed to hang, just like the Prod environment.

We adjusted the host list assignment for the job to target a single SQL server and found it still hung at the final Committing step of the scan. You have already uploaded to the ticket the SQL query that seems to be causing the stall and the debug logs from when just one server was targeted. Thank you for that.

I'm going to raise this issue internally and see if I can more about what that script is doing or what might be going wrong. I appreciate your patience with this. There is a good chance this will be escalated, so I will let you know if I need any additional artifacts. I'll be in touch with next steps as soon as I have them.

Thank you. 

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/23/2025 6:01 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


Debug log attached to ticket.

Jim

 

 


 

Internal Use


From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Thanks Josh.  Scheduled for tomorrow 10am.

 

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

 

Running instances show all threads stuck in “committing data”.

 

We also upgraded test and it seems fine.

 

Thanks
Jim

 

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 



	
		
			
			[External Content] Please use caution.
			
		
	



Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

ref:!00D70091pB.!500Qk0ONmxO:ref","RE: Netwrix Support Ticket #442987 -  - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","techsupport@netwrix.com","Netwrix Support","jim.callison@regions.com","kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com","joshua.sexton@netwrix.com","true","2025-04-28T18:13:36.000Z","true"
"02sQk00000OHBFlIAP","500Qk00000ONmxOIAT","2025-04-29T14:12:32.000Z","2025-04-29T14:22:52.000Z","ref:_00D7091pB._500Q000ONmxO:ref

Josh,

The scan went great for both test and prod.  In fact, the scan time has gone from 7 hours in prod to about 1 hour.  From what I can tell all the data seems to be there and no major collection issues.

The new .141 version seems to be running well.

Thanks to much for your support.

I appreciate you, Nick, and Dusty working with us to get us back on track, and actually a sizable improvement it looks like!

Thanks

Jim



Internal Use
From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, April 28, 2025 1:14 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

I'm just following up. How'd the SQL permission scan go over the weekend?

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!99ShnQzC4fffftInfqukgPlSxjfn3lMCZzPTiWDvPoUFg-k5EBGd8OyGtYNpxUYtNYxmmPWbslKjxHQX-4yVi_qU8Q$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/25/2025 5:15 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref


Hey Josh.
Thanks for working with us.  Prod seems to be running well so we will let it run over the weekend and check in Monday.

Thanks!

Jim





Internal Use
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Friday, April 25, 2025 4:13 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

Thank you for meeting with Nick and me. In our meeting we upgraded your test and prod deployments of Netwrix Enterprise Auditor to version 11.6.0.141. This version includes a fix for the SQL Permissions Scan the did seem to resolve the issue you were having in production. Interestingly, the test environment is still hanging at the same place, but NEA now identifies it with the message ""slow thread"".

Like we discussed, please let a SQL Permissions scan run over the weekend including all of the servers. Please let me know on Monday how it looks.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!4xE_Mu34_Ejl__-2o4ULmWhYhptw7opk62jHiMAQ7qNxxNTOcWJfieJYfSFIq8hgxa-IRiPWjwP0x5-PdfwSp_mPgw$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/25/2025 4:00 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref


Joining - thansk



Internal Use
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Friday, April 25, 2025 2:42 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

I'm available at the top of the hour, 4:00PM Eastern.

Here is a link for the meeting:

https://netwrix.zoom.us/j/87645531786?pwd=TkZdJbbWff3E0l8dAmVcZanbnCVj0B.1<https://urldefense.com/v3/__https:/netwrix.zoom.us/j/87645531786?pwd=TkZdJbbWff3E0l8dAmVcZanbnCVj0B.1__;!!DgLF0YGH!6FqjT7B-109oivJ2MWHAGRY4_yaRpyvCSbGshNIERJ67zN0Pzgd14TnlUdFardADxOfhSsN13q3C6Crm11ZifQztqQ$>

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!6FqjT7B-109oivJ2MWHAGRY4_yaRpyvCSbGshNIERJ67zN0Pzgd14TnlUdFardADxOfhSsN13q3C6Crm11ZxxBrJjQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/25/2025 3:31 PM
To: jim.callison@regions.com<mailto:jim.callison@regions.com>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

That should be the process. Unfortunately, I don't have a copy of that old installer. Do you happen to still have it?



Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!6FqjT7B-109oivJ2MWHAGRY4_yaRpyvCSbGshNIERJ67zN0Pzgd14TnlUdFardADxOfhSsN13q3C6Crm11ZxxBrJjQ$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/25/2025 2:27 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; manoj.gadhia@regions.com<mailto:manoj.gadhia@regions.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref


Is there anyone that can join me this afternoon for a rollback?  Assuming rollback and upgrade are similar.  Uninstall current version, restore database, install older version.  Replace any jobs needed if necessary.

Jim



Internal Use
From: Jim Callison
Sent: Friday, April 25, 2025 10:48 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Manoj Gadhia <Manoj.Gadhia@Regions.com<mailto:Manoj.Gadhia@Regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

We don’t have a spapshot available.  We have the db backup and the job folder from the prior version.

Thanks
Jim

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Friday, April 25, 2025 10:28 AM
To: Manoj Gadhia <Manoj.Gadhia@Regions.com<mailto:Manoj.Gadhia@Regions.com>>; Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

Thank you for the additional logs. I will review those as soon as I am able. I have confirmed that the offending query is exactly the same in version 11.6.0.89, but I don't have ready access to an older version. I don't believe I will be able provide any solution by this afternoon, so I understand if you want to roll back.

The best, and easiest, way to roll back would require you to also have a backup of the server. You said you have a backup of the folders, but do you have a backup of the whole server?

Stop the services, restore the database to the backups, then roll the NEA server back to a snapshot. Assuming the backups were all taken from the same version of NEA, there shouldn't be any difficulties with that process.

Please feel free to use this link to schedule a remote session. I've included the T2 Engineer that has been helping me with this.

https://nwxcorp.my.salesforce-sites.com/cts?Id=m6EcG4ueUApCZsGv3ew3wu9Fl8ROYXXq7GvasfXsycM-Z&MeetingID=ybt2YqXueXkSEWcAvKLmdypANpjUq8xTU72ZMjzU1GU-Z<https://urldefense.com/v3/__https:/nwxcorp.my.salesforce-sites.com/cts?Id=m6EcG4ueUApCZsGv3ew3wu9Fl8ROYXXq7GvasfXsycM-Z&MeetingID=ybt2YqXueXkSEWcAvKLmdypANpjUq8xTU72ZMjzU1GU-Z__;!!DgLF0YGH!57h6O2CKk0nWgtG8ebuBcn4ZuClqMaQRzB4I0BUKf1_T8agzx0VFM2NLdwKan9N3sh2xu35FZiYbXzUcBoklhWIiNQ$>

Thank you,


Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!57h6O2CKk0nWgtG8ebuBcn4ZuClqMaQRzB4I0BUKf1_T8agzx0VFM2NLdwKan9N3sh2xu35FZiYbXzUcBol5LMJWTA$>


--------------- Original Message ---------------
From: Manoj Gadhia [manoj.gadhia@regions.com]
Sent: 4/25/2025 10:30 AM
To: jim.callison@regions.com<mailto:jim.callison@regions.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

@Netwrix Support<mailto:techsupport@netwrix.com>  can we escalate to highest level – as we can not be missing this data too long ? issue should be treated at production outage level.



Internal Use
From: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Sent: Friday, April 25, 2025 9:27 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; SQL111 <SQL111@regions.com<mailto:SQL111@regions.com>>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

I am currently running a batch of 26 servers – all “stuck” in the “Committing data” stage for 20 minutes so far.
I suspect that each will take between 40 minutes and 5 hours each.
There is one thread of the slow query running at the moment (I expected maybe multiple)

You can see the current log as below where it is during this stuck commit stage.

The single serve run last night completed (I guess) in 43 minutes – log uploaded.

I am also uploading the log of the current running “stuck” process as well as the one form last night.

Even if any will commit at 43 minutes, that is 3x longer than normal, but I suspect it will run for days and not complete.

Unless you have a better idea, we need to roll back our production system this afternoon as we rely on it for capturing sox audit data.
I do have a database backup for production and folders etc from prior to the upgrade.

We also need to upgrade test, which I don’t have a db backup for but I suppose we can start with new DB on that one as we can load the servers form a dynamic host list and also we have the previous folders from before migration as well as we can apply prod jobs over there.

Thanks
Jim

[cid:image001.png@01DBB8E5.174A52D0]

[cid:image002.png@01DBB8E5.174A52D0]

Current log
[cid:image003.png@01DBB8E5.174A52D0]





Internal Use
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Friday, April 25, 2025 8:04 AM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

I've been discussing your issue with a T2 engineer and reviewing the logs. In the most recent log you provided, the one where it was only targeting the single SQL server, did it complete on its own, or did you abort the scan? I ask because the logs look like it only sits at that committing step for about 3 minutes then continues on and completes the scan.

I agree with your findings that the SQL query will be very slow in large SQL environments, especially when there are many, many SQL servers. I'm working to escalate this issue so Dev can examine the query closely, but it would help if I had logs that showed it sitting at that commit step for a long time. Are you able to run the job again, preferably targeting just one server, and let it run for a long time? Then please attach that log along with an export/screenshot of the Job Stats and Task Stats for that run.

Once we have that, there is a couple ways to clear out the SQL permissions data to start a scan fresh. In fact, I believe you already had a job configured to do this, but we didn't examine it closely. Here is a KB on setting up a custom job to drop that data: How to Drop Data Collected from SQL Servers Using the Databases Module<https://urldefense.com/v3/__https:/helpcenter.netwrix.com/bundle/z-kb-articles-salesforce/page/kA0Qk0000001lGDKAY.html__;!!DgLF0YGH!_aop0YYcdeAqjFp4fI9qmWjgdGLOfCE0ziyeypIGOrldHab5BWlTJjvC4PodygFP9kUl2Z4sAYWI-NHFv8Lb7j2yGw$>
The second half of the KB shows how to drop data for specific servers and/or dropping just the permissions data. I can help with this over a remote session, if you'd like.

Either way, your analysis of the SQL query seems valid. I'm still trying to determine if the query was changed at all between versions. I'm not aware of any SQL changes in the change log.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!_aop0YYcdeAqjFp4fI9qmWjgdGLOfCE0ziyeypIGOrldHab5BWlTJjvC4PodygFP9kUl2Z4sAYWI-NHFv8Lvnr3Z8w$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/24/2025 5:50 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

Looks like there is no WHERE clause on this call.   Meaning for EVERY server, you are running against the entire database.  It SHOULD only be running for the server data it just gathered.

Probably this is your issue.

Do we need to roll back?  Or can you fix this query.  It runs in seconds when running for the server it is trying to commit.

Jim




Internal Use
From: Jim Callison
Sent: Thursday, April 24, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; SQL111 <SQL111@regions.com<mailto:SQL111@regions.com>>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

It seems like the query is using terribly inefficient nested views.  It joins many tables to views, unions, and the views have many internal table joins.

If you have any real amount of data this will not run well.  What would have changed related to this for the .137 upgrade?

As the issue started immediately after that, it seems the data would not have changed, but the logic of how it is handled might?


Another thought.  As this data technically should be wiped and re-loaded every time….. we don’t care about history.

However there are tables (object and permissions tables) that still contiain much old data.

Can we truncate these and try again?

Please give me a list of tables that woudl be wise to truncate prior to this load and we will add that to the start of the process.

Probably this slow query will run faster if we do that?

Jim



[cid:image004.png@01DBB8E5.174A52D0]

[cid:image005.png@01DBB8E5.174A52D0]

[cid:image006.png@01DBB8E5.174A52D0]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, April 24, 2025 1:26 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]


Hello Jim,

Thank you for meeting with me today. In our session we confirmed the connection profile that the SQL permissions scan job is using has appropriate access to the SQL instances. We also used the Connection Wizzard within the SQL job's query filters to confirm the NEA console could connect to the SQL instances. While there are some that throw ""Access Denied"" messages, the job quickly moves on to the next server. I don't believe that is causing the problem. Using SQL Management Studio, we were able to identify the query that is running while the job seems to hang.

The job doesn't truly lock-up; it seems like it does slowly move onto subsequent servers, but it takes 5+ hours per server. The job's stats table shows that before the upgrade, it use to take 6-7 hours to complete the entire job, including scanning all of your SQL servers. We thought the Test environment was complete without issue, but we found that NEA's SQL server's traction log was out of space in that environment. When you cleared space for the log, the SQL Permission job seemed to hang, just like the Prod environment.

We adjusted the host list assignment for the job to target a single SQL server and found it still hung at the final Committing step of the scan. You have already uploaded to the ticket the SQL query that seems to be causing the stall and the debug logs from when just one server was targeted. Thank you for that.

I'm going to raise this issue internally and see if I can more about what that script is doing or what might be going wrong. I appreciate your patience with this. There is a good chance this will be escalated, so I will let you know if I need any additional artifacts. I'll be in touch with next steps as soon as I have them.

Thank you.

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!-gflWOTWUk4qHyJyRwCkZmWogLCMahjO0LRwu7VJ9B4mWSlpDGdQxixzLbNyUsEwmgpiEmgCnHjMHR-65A_Il8wmLg$>


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/23/2025 6:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>; kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sql111@regions.com<mailto:sql111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

Debug log attached to ticket.
Jim




Internal Use
From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Thanks Josh.  Scheduled for tomorrow 10am.

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

Running instances show all threads stuck in “committing data”.

We also upgraded test and it seems fine.

Thanks
Jim


From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com<mailto:Jim.Callison@regions.com>>
Cc: kyle.vogley@netwrix.com<mailto:kyle.vogley@netwrix.com>; sina.pourmokhtari@netwrix.com<mailto:sina.pourmokhtari@netwrix.com>
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

[External Content] Please use caution.
Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z<https://urldefense.com/v3/__https:/nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXP7cPRPQw$>

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http:/www.netwrix.com__;!!DgLF0YGH!4QgDTyzrrIb3N7whVphBsMTxFJgDEIiGcCao4aotcD3gnMaP_Y1BFGKbRGTPQhrgmovLPQuX6YH8rP6GXXPzV6Vg3Q$>

ref:!00D70091pB.!500Qk0ONmxO:ref






[https://nwxcorp.my.salesforce.com/servlet/servlet.ImageServer?oid=00D7000000091pB&esid=018Qk00000LfVgU&from=ext]","RE: Netwrix Support Ticket #442987 -  - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","jim.callison@regions.com","Jim Callison","techsupport@netwrix.com","sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com","","true","2025-04-29T14:11:27.000Z","true"
"02sQk00000OHE3xIAH","500Qk00000ONmxOIAT","2025-04-29T14:27:18.000Z","2025-04-29T14:27:18.000Z","Hello Jim,

I'm glad to hear Prod is working again. I believe your test environment was still having problems committing the SQL Permissions data in our last meeting, but you had a plan to recover it. Do you want to keep this ticket open until Test is working again, or are you comfortable close this ticket for now?

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/29/2025 10:11 AM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref



Josh,

 

The scan went great for both test and prod.  In fact, the scan time has gone from 7 hours in prod to about 1 hour.  From what I can tell all the data seems to be there and no major collection issues.

 

The new .141 version seems to be running well.

 

Thanks to much for your support.  

 

I appreciate you, Nick, and Dusty working with us to get us back on track, and actually a sizable improvement it looks like!

 

Thanks

 

Jim

 

 
Internal Use


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, April 28, 2025 1:14 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

I'm just following up. How'd the SQL permission scan go over the weekend?

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/25/2025 5:15 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

 


Hey Josh.

Thanks for working with us.  Prod seems to be running well so we will let it run over the weekend and check in Monday.


Thanks!

 

Jim

 

 

 


 

Internal Use


From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 4:13 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com;  sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

Thank you for meeting with Nick and me. In our meeting we upgraded your test and prod deployments of Netwrix Enterprise Auditor to version 11.6.0.141. This version includes a fix for the SQL Permissions Scan the did seem to resolve the issue you were having in production. Interestingly, the test environment is still hanging at the same place, but NEA now identifies it with the message ""slow thread"".

Like we discussed, please let a SQL Permissions scan run over the weekend including all of the servers. Please let me know on Monday how it looks.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/25/2025 4:00 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

 


Joining - thansk

 


 

Internal Use


From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 2:42 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

I'm available at the top of the hour, 4:00PM Eastern. 

Here is a link for the meeting:

https://netwrix.zoom.us/j/87645531786?pwd=TkZdJbbWff3E0l8dAmVcZanbnCVj0B.1

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/25/2025 3:31 PM
To: jim.callison@regions.com
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

Hello Jim,

That should be the process. Unfortunately, I don't have a copy of that old installer. Do you happen to still have it?



Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/25/2025 2:27 PM
To: techsupport@netwrix.com; manoj.gadhia@regions.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref

 


Is there anyone that can join me this afternoon for a rollback?  Assuming rollback and upgrade are similar.  Uninstall current version, restore database, install older version.  Replace any jobs needed if necessary.

 

Jim

 


 

Internal Use


From: Jim Callison
Sent: Friday, April 25, 2025 10:48 AM
To: Netwrix Support <techsupport@netwrix.com>; Manoj Gadhia <Manoj.Gadhia@Regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

We don’t have a spapshot available.  We have the db backup and the job folder from the prior version.

 

Thanks

Jim

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 10:28 AM
To: Manoj Gadhia <Manoj.Gadhia@Regions.com>; Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

Thank you for the additional logs. I will review those as soon as I am able. I have confirmed that the offending query is exactly the same in version 11.6.0.89, but I don't have ready access to an older version. I don't believe I will be able provide any solution by this afternoon, so I understand if you want to roll back.

The best, and easiest, way to roll back would require you to also have a backup of the server. You said you have a backup of the folders, but do you have a backup of the whole server?

Stop the services, restore the database to the backups, then roll the NEA server back to a snapshot. Assuming the backups were all taken from the same version of NEA, there shouldn't be any difficulties with that process.

Please feel free to use this link to schedule a remote session. I've included the T2 Engineer that has been helping me with this.

https://nwxcorp.my.salesforce-sites.com/cts?Id=m6EcG4ueUApCZsGv3ew3wu9Fl8ROYXXq7GvasfXsycM-Z&MeetingID=ybt2YqXueXkSEWcAvKLmdypANpjUq8xTU72ZMjzU1GU-Z

Thank you,


Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Manoj Gadhia [manoj.gadhia@regions.com]
Sent: 4/25/2025 10:30 AM
To: jim.callison@regions.com; techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


@Netwrix Support  can we escalate to highest level – as we can not be missing this data too long ? issue should be treated at production outage level.

 


 

Internal Use


From: Jim Callison <Jim.Callison@regions.com>
Sent: Friday, April 25, 2025 9:27 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com; SQL111 <SQL111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

I am currently running a batch of 26 servers – all “stuck” in the “Committing data” stage for 20 minutes so far.  

I suspect that each will take between 40 minutes and 5 hours each.

There is one thread of the slow query running at the moment (I expected maybe multiple)

 

You can see the current log as below where it is during this stuck commit stage.

 

The single serve run last night completed (I guess) in 43 minutes – log uploaded.

 

I am also uploading the log of the current running “stuck” process as well as the one form last night.

 

Even if any will commit at 43 minutes, that is 3x longer than normal, but I suspect it will run for days and not complete.

 

Unless you have a better idea, we need to roll back our production system this afternoon as we rely on it for capturing sox audit data.

I do have a database backup for production and folders etc from prior to the upgrade.

 

We also need to upgrade test, which I don’t have a db backup for but I suppose we can start with new DB on that one as we can load the servers form a dynamic host list and also we have the previous folders from before migration as well as we can apply prod jobs over there.

 

Thanks

Jim

 



 



 

Current log



 

 

 


 

Internal Use


From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 25, 2025 8:04 AM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

I've been discussing your issue with a T2 engineer and reviewing the logs. In the most recent log you provided, the one where it was only targeting the single SQL server, did it complete on its own, or did you abort the scan? I ask because the logs look like it only sits at that committing step for about 3 minutes then continues on and completes the scan. 

I agree with your findings that the SQL query will be very slow in large SQL environments, especially when there are many, many SQL servers. I'm working to escalate this issue so Dev can examine the query closely, but it would help if I had logs that showed it sitting at that commit step for a long time. Are you able to run the job again, preferably targeting just one server, and let it run for a long time? Then please attach that log along with an export/screenshot of the Job Stats and Task Stats for that run.

Once we have that, there is a couple ways to clear out the SQL permissions data to start a scan fresh. In fact, I believe you already had a job configured to do this, but we didn't examine it closely. Here is a KB on setting up a custom job to drop that data: How to Drop Data Collected from SQL Servers Using the Databases Module
The second half of the KB shows how to drop data for specific servers and/or dropping just the permissions data. I can help with this over a remote session, if you'd like.

Either way, your analysis of the SQL query seems valid. I'm still trying to determine if the query was changed at all between versions. I'm not aware of any SQL changes in the change log.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/24/2025 5:50 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


Looks like there is no WHERE clause on this call.   Meaning for EVERY server, you are running against the entire database.  It SHOULD only be running for the server data it just gathered.

 

Probably this is your issue.

 

Do we need to roll back?  Or can you fix this query.  It runs in seconds when running for the server it is trying to commit.

 

Jim

 

 


 

Internal Use


From: Jim Callison
Sent: Thursday, April 24, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com; SQL111 <SQL111@regions.com>
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

It seems like the query is using terribly inefficient nested views.  It joins many tables to views, unions, and the views have many internal table joins.

 

If you have any real amount of data this will not run well.  What would have changed related to this for the .137 upgrade?

 

As the issue started immediately after that, it seems the data would not have changed, but the logic of how it is handled might?

 

 

Another thought.  As this data technically should be wiped and re-loaded every time….. we don’t care about history.

 

However there are tables (object and permissions tables) that still contiain much old data.

 

Can we truncate these and try again?

 

Please give me a list of tables that woudl be wise to truncate prior to this load and we will add that to the start of the process.

 

Probably this slow query will run faster if we do that?

 

Jim

 

 

 



 



 



 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, April 24, 2025 1:26 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: Netwrix Support Ticket #442987 - - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Hello Jim,

Thank you for meeting with me today. In our session we confirmed the connection profile that the SQL permissions scan job is using has appropriate access to the SQL instances. We also used the Connection Wizzard within the SQL job's query filters to confirm the NEA console could connect to the SQL instances. While there are some that throw ""Access Denied"" messages, the job quickly moves on to the next server. I don't believe that is causing the problem. Using SQL Management Studio, we were able to identify the query that is running while the job seems to hang.

The job doesn't truly lock-up; it seems like it does slowly move onto subsequent servers, but it takes 5+ hours per server. The job's stats table shows that before the upgrade, it use to take 6-7 hours to complete the entire job, including scanning all of your SQL servers. We thought the Test environment was complete without issue, but we found that NEA's SQL server's traction log was out of space in that environment. When you cleared space for the log, the SQL Permission job seemed to hang, just like the Prod environment.

We adjusted the host list assignment for the job to target a single SQL server and found it still hung at the final Committing step of the scan. You have already uploaded to the ticket the SQL query that seems to be causing the stall and the debug logs from when just one server was targeted. Thank you for that.

I'm going to raise this issue internally and see if I can more about what that script is doing or what might be going wrong. I appreciate your patience with this. There is a good chance this will be escalated, so I will let you know if I need any additional artifacts. I'll be in touch with next steps as soon as I have them.

Thank you. 

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Jim Callison [jim.callison@regions.com]
Sent: 4/23/2025 6:01 PM
To: techsupport@netwrix.com
Cc: sina.pourmokhtari@netwrix.com; kyle.vogley@netwrix.com; sql111@regions.com
Subject: RE: Netwrix Support Ticket #442987 - ref:_00D7091pB._500Q000ONmxO:ref - [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]

ref:_00D7091pB._500Q000ONmxO:ref
 


Debug log attached to ticket.

Jim

 

 


 

Internal Use


From: Jim Callison
Sent: Wednesday, April 23, 2025 4:21 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: RE: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 

Thanks Josh.  Scheduled for tomorrow 10am.

 

FYI our main production scan job is not working (permissions) since the 4/21 upgrade.

 

Running instances show all threads stuck in “committing data”.

 

We also upgraded test and it seems fine.

 

Thanks
Jim

 

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, April 23, 2025 4:09 PM
To: Jim Callison <Jim.Callison@regions.com>
Cc: kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com
Subject: [EXTERNAL] main enviroment scan not working post upgrade. [ ref:!00D70091pB.!500Qk0ONmxO:ref ]



 



	
		
			
			[External Content] Please use caution.
			
		
	



Hello Jim,

Thank you for contacting Netwrix Technical Support. My name is Josh, and I'm happy to help. I can see that this ticket is spun off of ticket 00439545 and some of your details are in your last couple emails on that ticket. If you've already uploaded logs to this new ticket, they aren't available to be just yet. It's common for uploaded files to take a bit before they make it to the ticket on the backend. Dusty is out-of-office for the rest of the week, but I can still meet with you to take a look.

Feel free to use this link to schedule at your convenience:

https://nwxcorp.my.salesforce-sites.com/cts?Id=SbZ3FmpnbQQWjIkcd1Sm4drgKXa7ADzGeXP8_ONHkQ4-Z&MeetingID=8xo1OAC.nPA6h.QBS09PM7rLwFlmHHuUKIswVVtxxB0-Z

Please let me know if you have any questions or concerns in the meantime.

Thank you,

Joshua Sexton
Technical Support Engineer Tier 1
____________________ ______
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

ref:!00D70091pB.!500Qk0ONmxO:ref","RE: Netwrix Support Ticket #442987 -  - [EXTERNAL] main enviroment scan not working post upgrade.    [ ref:!00D70091pB.!500Qk0ONmxO:ref ]","techsupport@netwrix.com","Netwrix Support","jim.callison@regions.com","kyle.vogley@netwrix.com; sina.pourmokhtari@netwrix.com","","true","2025-04-29T14:27:17.000Z","true"
