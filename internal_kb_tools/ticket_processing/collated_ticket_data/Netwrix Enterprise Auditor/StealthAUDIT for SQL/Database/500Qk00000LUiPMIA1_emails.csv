"Id","ParentId","CreatedDate","LastModifiedDate","TextBody","Subject","FromAddress","FromName","ToAddress","CcAddress","BccAddress","HasAttachment","MessageDate","IsExternallyVisible"
"02sQk00000MQNytIAH","500Qk00000LUiPMIA1","2025-03-10T15:31:42.000Z","2025-03-10T15:31:42.000Z","Hi Alison, 

This is Artem, regarding the performance of SQL permission scan ticket. 
I would like to suggest scheduling next meeting to discuss current progress of the troubleshooting and configure next test.

Please, use this link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=LDlSSV4EYXUDTUJdx2EpoqabSb98ZouvgnqSAO4aPbI-Z&MeetingID=47uChTkPasQxdkjLdXo..sCrg9d_0B0b7fj2UOsKxHU-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/6/2025 7:34 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

I also apologize for a late reply.
Thank you very much for uploading the logs for that DUDDBA test job we configured on last meeting. 

I have analyzed the logs and would like to share my findings with you:

Regarding the ADI log entries:

The ADI in NEA terms stands for Active Directory Inventory. This means that Azure ADI is related to information collected by Azure Entra ID inventory solution. 

The SQL server that we selected for this test job is still on-premises and was not yet migrated to cloud, as such, I believe these lines are expected to see:
03/03/2025 14:41:01    DEBUG    SQL    Stealthbits.StealthAUDIT.DataCollectors.SQL.Providers.TaskBase.InternalProcessRecord    ""[1276419] ADI effective members found.""    A0185-DBS0079-S    DCExtract    13440    16996    17524
------
03/03/2025 14:41:01    WARNING    SQL    Stealthbits.StealthAUDIT.DataCollectors.SQL.Providers.TaskBase.InternalProcessRecord    ""No Azure ADI effective members found.""    A0185-DBS0079-S    DCExtract    13440    16996    17524

ADI members - means that SQL permission job looks for the information on on-premises AD users that was collected by Active Directory Inventory.
And the ""ADI effective members found"" means that such on-premises AD users were found and their effective access to this DB was verified. 

The ""No Azure ADI effective members found."" just means that no Azure Entra ID users with effective access to this DB were found by the job. 
Since no Azure ADI effective members found - there was no insertion for such users and job spend less than 1 second in total to process Azure ADI effective members:

03/03/2025 14:41:01    DEBUG    SQL    Stealthbits.StealthAUDIT.DataCollectors.SQL.Providers.TaskBase.InternalProcessRecord    ""End InsertEffectiveRoleMembership(): ADI""    A0185-DBS0079-S    DCExtract    13440    16996    17524
03/03/2025 14:41:01    DEBUG    SQL    Stealthbits.StealthAUDIT.DataCollectors.SQL.Providers.TaskBase.InternalProcessRecord    ""[1276419] ADI effective members found.""    A0185-DBS0079-S    DCExtract    13440    16996    17524
03/03/2025 14:41:01    DEBUG    SQL    Stealthbits.StealthAUDIT.DataCollectors.SQL.Providers.TaskBase.InternalProcessRecord    ""Begin InsertEffectiveRoleMembership(): Azure ADI""    A0185-DBS0079-S    DCExtract    13440    16996    17524
03/03/2025 14:41:01    DEBUG    SQL    Stealthbits.StealthAUDIT.DataCollectors.SQL.Providers.TaskBase.InternalProcessRecord    ""End InsertEffectiveRoleMembership(): Azure ADI""    A0185-DBS0079-S    DCExtract    13440    16996    17524
03/03/2025 14:41:01    WARNING    SQL    Stealthbits.StealthAUDIT.DataCollectors.SQL.Providers.TaskBase.InternalProcessRecord    ""No Azure ADI effective members found.""    A0185-DBS0079-S    DCExtract    13440    16996    17524


To continue, it seems that I found a possible bottleneck.
I noticed that most of the time the job spends on this task in particular:
03/03/2025 09:46:52    DEBUG    SQL    Stealthbits.StealthAUDIT.DataCollectors.SQL.Providers.TaskBase.InternalProcessRecord    ""[189265] Sql Server effective members found.""    A0185-DBS0079-S    DCExtract    13440    16996    17524
03/03/2025 09:47:05    DEBUG    SQL    Stealthbits.StealthAUDIT.DataCollectors.SQL.Providers.TaskBase.InternalProcessRecord    ""Begin InsertEffectiveRoleMembership(): ADI""    A0185-DBS0079-S    DCExtract    13440    16996    17524
03/03/2025 14:41:01    DEBUG    SQL    Stealthbits.StealthAUDIT.DataCollectors.SQL.Providers.TaskBase.InternalProcessRecord    ""End InsertEffectiveRoleMembership(): ADI""    A0185-DBS0079-S    DCExtract    13440    16996    17524

The permission auditing on the database object that happens prior to ""InsertEffectiveRoleMembership"" task completes quite fast actually:
03/03/2025 07:39:57    DEBUG    SQL    Stealthbits.StealthAUDIT.DataCollectors.SQL.Providers.TaskBase.InternalProcessRecord    ""SqlServerDataCollectorBase.CollectPerDatabase(): Begin Processing Database 'DUDDBA'""    A0185-DBS0079-S    DCExtract    13440    16996    17524
------
03/03/2025 07:40:00    DEBUG    SQL    Stealthbits.StealthAUDIT.DataCollectors.SQL.Providers.TaskBase.InternalProcessRecord    ""SqlServerDataCollectorBase.CollectPerDatabase(): END Processing Database 'DUDDBA'""    A0185-DBS0079-S    DCExtract    13440    16996    17524

But then Job starts committing (writing) data into SQL database - and this is where the most time is spent:
03/03/2025 07:40:00    DEBUG    SQL    Stealthbits.StealthAUDIT.DataCollectors.SQL.Providers.TaskBase.InternalProcessRecord    ""Committing data : [A0185-DBS0079-SDU01]  0""    A0185-DBS0079-S    DCExtract    13440    16996    17524

This is then followed by a presumed bottleneck, which is when NEA starts writing information about On-premises Active Directory users Effective Role Membership (for DUDDBA) into SQL database:
03/03/2025 09:47:05    DEBUG    SQL    Stealthbits.StealthAUDIT.DataCollectors.SQL.Providers.TaskBase.InternalProcessRecord    ""Begin InsertEffectiveRoleMembership(): ADI""    A0185-DBS0079-S    DCExtract    13440    16996    17524
03/03/2025 14:41:01    DEBUG    SQL    Stealthbits.StealthAUDIT.DataCollectors.SQL.Providers.TaskBase.InternalProcessRecord    ""End InsertEffectiveRoleMembership(): ADI""    A0185-DBS0079-S    DCExtract    13440    16996    17524

To sum up:

Both ADI and Azure ADI effective membership resolution is needed on every object. Whether the job spends time on either of them depends on whether Entra ID or On-premises users with effective access are found for the Database that is been processed. In case of the test job we configured last time - the Azure ADI effective members were not found and thus job spent negligible amount of time on this task. 

However, what looks like a bottleneck is the task of committing information about effective user membership into NEA SQL db. 
As such, could you please clarify what are the specifications of the NEA SQL db server? On which storage device NEA SQL db is located? What resources are provisioned on the NEA SQL server? How far physically the NEA SQL db storage and server are located from the NEA server? 

In the meantime, I will consult with my team to find what we can do to improve the ""InsertEffectiveRoleMembership"" task. 

I am looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/5/2025 9:14 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 



Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 



 

From the Job Status Export the Messages Table, CSV is preferred: 

 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 


Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:


 


 

Messages shows:



 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 



 



 



 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:


 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:


	On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
	If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.  
	Connection between each SQL server and Netwrix server might also become a bottleneck. 
	Netwrix SQL database where data is eventually written could become a bottleneck as well. 


As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied. 

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com; techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


I have added the log to the ticket on the portal.

 

Thank you,

Alison.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.

Here are the servers which have completed:

 

Thank you,

Alison.

 



 

 



 

These are the servers to yet be scanned:









 



 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks. 

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it. 

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks? 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Log uploaded to portal.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Team,

Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408

 

 

From then on, the logs state:

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

 

I have not ended the scan.

 

Thank you,

Alison.


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hi Alison, 

Understood, I will put our ticket on hold and will be waiting for an update from your side. 
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com; techsupport@netwrix.com
Cc: jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

 

Thank you,

Alison.

 


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Cc: jared.harris@netwrix.com
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hello AllState Team, 

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? 
Please, let me know if you have questions - I will be happy to help! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, 

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance. 

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan? 
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:


	On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
	If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment 
	Connection between each SQL server and Netwrix server might also become a bottleneck. 
	Netwrix SQL database where data is eventually written could become a bottleneck as well. 


According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance. 

I am looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean, 

This is Artem with our second ticket for the SQL Permissions scan performance issues. 
Thank you for your time today! 

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers. 
To isolate the cause of the issue I need to analyze support logs for this job. 
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket. 

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share. 

Thank you! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com



ref:!00D70091pB.!500Qk0LUiPM:ref","RE:  RE:  RE:  RE:  RE:  RE: Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","alison.mills@allstate.com","jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com","","true","2025-03-10T15:31:40.000Z","true"
"02sQk00000MSmeaIAD","500Qk00000LUiPMIA1","2025-03-11T11:43:13.000Z","2025-03-11T13:21:04.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image017.png@01DB927A.34617830]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image003.png@01DB9278.DE3779B0]

[cid:image004.png@01DB9278.DE3779B0]

Messages shows:
[cid:image005.png@01DB9278.DE3779B0]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image006.png@01DB9278.DE3779B0]

[cid:image007.png@01DB9278.DE3779B0]

[cid:image008.png@01DB9278.DE3779B0]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.
Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image009.png@01DB9278.DE3779B0]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image010.png@01DB9278.DE3779B0]


[cid:image011.png@01DB9278.DE3779B0]

These are the servers to yet be scanned:
[cid:image012.png@01DB9278.DE3779B0]
[cid:image013.png@01DB9278.DE3779B0]
[cid:image014.png@01DB9278.DE3779B0]
[cid:image015.png@01DB9278.DE3779B0]

[cid:image016.png@01DB9278.DE3779B0]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!IZDTAj0iIcLQhr7gPC5_IKiv62HNP4jZ5CYI_oig9OXYVywunGv0sCE33mPBwjxkwRyfBSdo0NY5SVIe5wlbCcLmCWSzScFT5w$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hello AllState Team,

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance?
Please, let me know if you have questions - I will be happy to help!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team,

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance.

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan?
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOGqdO0cAg$>
This will help decrease time to process each individual SQL server.

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance.

I am looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean,

This is Artem with our second ticket for the SQL Permissions scan performance issues.
Thank you for your time today!

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers.
To isolate the cause of the issue I need to analyze support logs for this job.
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket.

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


ref:!00D70091pB.!500Qk0LUiPM:ref","RE:  RE:  RE:  RE:  RE:  RE: Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","alison.mills@allstate.com","Mills, Alison","techsupport@netwrix.com","aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com","","true","2025-03-11T11:42:39.000Z","true"
"02sQk00000MSy7pIAD","500Qk00000LUiPMIA1","2025-03-11T12:25:42.000Z","2025-03-11T12:25:42.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image018.png@01DB927F.99496EB0]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image019.png@01DB927F.99496EB0]

The last piece of SQL that was executed was:
[cid:image001.png@01DB9280.90844BA0]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image020.png@01DB927F.99496EB0]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image023.png@01DB927F.99496EB0]

[cid:image024.png@01DB927F.99496EB0]

Messages shows:
[cid:image025.png@01DB927F.99496EB0]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image026.png@01DB927F.99496EB0]

[cid:image027.png@01DB927F.99496EB0]

[cid:image028.png@01DB927F.99496EB0]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image029.png@01DB927F.99496EB0]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image030.png@01DB927F.99496EB0]


[cid:image031.png@01DB927F.99496EB0]

These are the servers to yet be scanned:
[cid:image032.png@01DB927F.99496EB0]
[cid:image033.png@01DB927F.99496EB0]
[cid:image034.png@01DB927F.99496EB0]
[cid:image035.png@01DB927F.99496EB0]

[cid:image036.png@01DB927F.99496EB0]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!IZDTAj0iIcLQhr7gPC5_IKiv62HNP4jZ5CYI_oig9OXYVywunGv0sCE33mPBwjxkwRyfBSdo0NY5SVIe5wlbCcLmCWSzScFT5w$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hello AllState Team,

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance?
Please, let me know if you have questions - I will be happy to help!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team,

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance.

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan?
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOGqdO0cAg$>
This will help decrease time to process each individual SQL server.

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance.

I am looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean,

This is Artem with our second ticket for the SQL Permissions scan performance issues.
Thank you for your time today!

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers.
To isolate the cause of the issue I need to analyze support logs for this job.
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket.

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


ref:!00D70091pB.!500Qk0LUiPM:ref","RE:  RE:  RE:  RE:  RE:  RE: Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","alison.mills@allstate.com","Mills, Alison","techsupport@netwrix.com","aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com","","true","2025-03-11T12:24:58.000Z","true"
"02sQk00000MSyFtIAL","500Qk00000LUiPMIA1","2025-03-11T12:26:18.000Z","2025-03-11T12:30:52.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image018.png@01DB927F.99496EB0]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image019.png@01DB927F.99496EB0]

The last piece of SQL that was executed was:
[cid:image001.png@01DB9280.90844BA0]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image020.png@01DB927F.99496EB0]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image023.png@01DB927F.99496EB0]

[cid:image024.png@01DB927F.99496EB0]

Messages shows:
[cid:image025.png@01DB927F.99496EB0]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image026.png@01DB927F.99496EB0]

[cid:image027.png@01DB927F.99496EB0]

[cid:image028.png@01DB927F.99496EB0]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image029.png@01DB927F.99496EB0]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image030.png@01DB927F.99496EB0]


[cid:image031.png@01DB927F.99496EB0]

These are the servers to yet be scanned:
[cid:image032.png@01DB927F.99496EB0]
[cid:image033.png@01DB927F.99496EB0]
[cid:image034.png@01DB927F.99496EB0]
[cid:image035.png@01DB927F.99496EB0]

[cid:image036.png@01DB927F.99496EB0]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!IZDTAj0iIcLQhr7gPC5_IKiv62HNP4jZ5CYI_oig9OXYVywunGv0sCE33mPBwjxkwRyfBSdo0NY5SVIe5wlbCcLmCWSzScFT5w$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hello AllState Team,

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance?
Please, let me know if you have questions - I will be happy to help!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team,

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance.

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan?
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOGqdO0cAg$>
This will help decrease time to process each individual SQL server.

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance.

I am looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean,

This is Artem with our second ticket for the SQL Permissions scan performance issues.
Thank you for your time today!

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers.
To isolate the cause of the issue I need to analyze support logs for this job.
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket.

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


ref:!00D70091pB.!500Qk0LUiPM:ref","RE:  RE:  RE:  RE:  RE:  RE: Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","alison.mills@allstate.com","Mills, Alison","techsupport@netwrix.com; rkuqk@allstate.com","aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com","","true","2025-03-11T12:25:34.000Z","true"
"02sQk00000MT1p3IAD","500Qk00000LUiPMIA1","2025-03-11T13:30:52.000Z","2025-03-11T13:30:52.000Z","Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref




Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:


 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 



 

The last piece of SQL that was executed was:



Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 




 




From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 



 

From the Job Status Export the Messages Table, CSV is preferred: 

 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 


Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:


 


 

Messages shows:



 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 



 



 



 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:


 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:


	On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
	If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.  
	Connection between each SQL server and Netwrix server might also become a bottleneck. 
	Netwrix SQL database where data is eventually written could become a bottleneck as well. 


As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied. 

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com; techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


I have added the log to the ticket on the portal.

 

Thank you,

Alison.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.

Here are the servers which have completed:

 

Thank you,

Alison.

 



 

 



 

These are the servers to yet be scanned:









 



 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks. 

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it. 

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks? 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Log uploaded to portal.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Team,

Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408

 

 

From then on, the logs state:

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

 

I have not ended the scan.

 

Thank you,

Alison.


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hi Alison, 

Understood, I will put our ticket on hold and will be waiting for an update from your side. 
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com; techsupport@netwrix.com
Cc: jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

 

Thank you,

Alison.

 


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Cc: jared.harris@netwrix.com
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hello AllState Team, 

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? 
Please, let me know if you have questions - I will be happy to help! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, 

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance. 

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan? 
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:


	On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
	If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment 
	Connection between each SQL server and Netwrix server might also become a bottleneck. 
	Netwrix SQL database where data is eventually written could become a bottleneck as well. 


According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance. 

I am looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean, 

This is Artem with our second ticket for the SQL Permissions scan performance issues. 
Thank you for your time today! 

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers. 
To isolate the cause of the issue I need to analyze support logs for this job. 
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket. 

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share. 

Thank you! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com



ref:!00D70091pB.!500Qk0LUiPM:ref","RE:  RE:  RE:  RE:  RE:  RE: Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","alison.mills@allstate.com","jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com","","true","2025-03-11T13:30:51.000Z","true"
"02sQk00000MT7OfIAL","500Qk00000LUiPMIA1","2025-03-11T13:57:08.000Z","2025-03-11T13:57:08.000Z","Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 
Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 



Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:


 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 



 

The last piece of SQL that was executed was:



Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 




 




From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 



 

From the Job Status Export the Messages Table, CSV is preferred: 

 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 


Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:


 


 

Messages shows:



 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 



 



 



 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:


 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:


	On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
	If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.  
	Connection between each SQL server and Netwrix server might also become a bottleneck. 
	Netwrix SQL database where data is eventually written could become a bottleneck as well. 


As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied. 

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com; techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


I have added the log to the ticket on the portal.

 

Thank you,

Alison.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.

Here are the servers which have completed:

 

Thank you,

Alison.

 



 

 



 

These are the servers to yet be scanned:









 



 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks. 

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it. 

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks? 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Log uploaded to portal.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Team,

Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408

 

 

From then on, the logs state:

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

 

I have not ended the scan.

 

Thank you,

Alison.


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hi Alison, 

Understood, I will put our ticket on hold and will be waiting for an update from your side. 
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com; techsupport@netwrix.com
Cc: jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

 

Thank you,

Alison.

 


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Cc: jared.harris@netwrix.com
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hello AllState Team, 

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? 
Please, let me know if you have questions - I will be happy to help! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, 

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance. 

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan? 
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:


	On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
	If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment 
	Connection between each SQL server and Netwrix server might also become a bottleneck. 
	Netwrix SQL database where data is eventually written could become a bottleneck as well. 


According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance. 

I am looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean, 

This is Artem with our second ticket for the SQL Permissions scan performance issues. 
Thank you for your time today! 

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers. 
To isolate the cause of the issue I need to analyze support logs for this job. 
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket. 

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share. 

Thank you! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com



ref:!00D70091pB.!500Qk0LUiPM:ref","Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","alison.mills@allstate.com","jared.harris@netwrix.com","damir.akhmatshin@netwrix.com","true","2025-03-11T13:57:07.000Z","true"
"02sQk00000MTXfBIAX","500Qk00000LUiPMIA1","2025-03-11T15:51:31.000Z","2025-03-12T13:28:40.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image001.png@01DB929C.E8387850]

[cid:image022.png@01DB929D.420A1780]

Here is the last excerpt from the job log:

[cid:image023.png@01DB929D.420A1780]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image002.png@01DB929C.E8387850]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image003.png@01DB929C.E8387850]

The last piece of SQL that was executed was:
[cid:image004.png@01DB929C.E8387850]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image005.png@01DB929C.E8387850]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image008.png@01DB929C.E8387850]

[cid:image009.png@01DB929C.E8387850]

Messages shows:
[cid:image010.png@01DB929C.E8387850]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image011.png@01DB929C.E8387850]

[cid:image012.png@01DB929C.E8387850]

[cid:image013.png@01DB929C.E8387850]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image014.png@01DB929C.E8387850]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image015.png@01DB929C.E8387850]


[cid:image016.png@01DB929C.E8387850]

These are the servers to yet be scanned:
[cid:image017.png@01DB929C.E8387850]
[cid:image018.png@01DB929C.E8387850]
[cid:image019.png@01DB929C.E8387850]
[cid:image020.png@01DB929C.E8387850]

[cid:image021.png@01DB929C.E8387850]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!IZDTAj0iIcLQhr7gPC5_IKiv62HNP4jZ5CYI_oig9OXYVywunGv0sCE33mPBwjxkwRyfBSdo0NY5SVIe5wlbCcLmCWSzScFT5w$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hello AllState Team,

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance?
Please, let me know if you have questions - I will be happy to help!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team,

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance.

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan?
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOGqdO0cAg$>
This will help decrease time to process each individual SQL server.

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance.

I am looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean,

This is Artem with our second ticket for the SQL Permissions scan performance issues.
Thank you for your time today!

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers.
To isolate the cause of the issue I need to analyze support logs for this job.
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket.

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


ref:!00D70091pB.!500Qk0LUiPM:ref","RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","alison.mills@allstate.com","Mills, Alison","techsupport@netwrix.com; rkuqk@allstate.com","aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com","","true","2025-03-11T15:50:25.000Z","true"
"02sQk00000MUjr8IAD","500Qk00000LUiPMIA1","2025-03-11T22:22:46.000Z","2025-03-12T13:24:25.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
Please see attached the scan details:
[cid:image024.png@01DB92D2.9E290F00]


Task stats:
[cid:image001.png@01DB92D2.FC4E77F0]

Messages:
[cid:image002.png@01DB92D2.FC4E77F0]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image025.png@01DB92D2.9E290F00]

[cid:image026.png@01DB92D2.9E290F00]

Here is the last excerpt from the job log:

[cid:image027.png@01DB92D2.9E290F00]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image028.png@01DB92D2.9E290F00]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image029.png@01DB92D2.9E290F00]

The last piece of SQL that was executed was:
[cid:image030.png@01DB92D2.9E290F00]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image031.png@01DB92D2.9E290F00]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image034.png@01DB92D2.9E290F00]

[cid:image035.png@01DB92D2.9E290F00]

Messages shows:
[cid:image036.png@01DB92D2.9E290F00]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image037.png@01DB92D2.9E290F00]

[cid:image038.png@01DB92D2.9E290F00]

[cid:image039.png@01DB92D2.9E290F00]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image040.png@01DB92D2.9E290F00]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image041.png@01DB92D2.9E290F00]


[cid:image042.png@01DB92D2.9E290F00]

These are the servers to yet be scanned:
[cid:image043.png@01DB92D2.9E290F00]
[cid:image044.png@01DB92D2.9E290F00]
[cid:image045.png@01DB92D2.9E290F00]
[cid:image046.png@01DB92D2.9E290F00]

[cid:image047.png@01DB92D2.9E290F00]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!IZDTAj0iIcLQhr7gPC5_IKiv62HNP4jZ5CYI_oig9OXYVywunGv0sCE33mPBwjxkwRyfBSdo0NY5SVIe5wlbCcLmCWSzScFT5w$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hello AllState Team,

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance?
Please, let me know if you have questions - I will be happy to help!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team,

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance.

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan?
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOGqdO0cAg$>
This will help decrease time to process each individual SQL server.

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance.

I am looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean,

This is Artem with our second ticket for the SQL Permissions scan performance issues.
Thank you for your time today!

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers.
To isolate the cause of the issue I need to analyze support logs for this job.
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket.

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


ref:!00D70091pB.!500Qk0LUiPM:ref","RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","alison.mills@allstate.com","Mills, Alison","techsupport@netwrix.com; rkuqk@allstate.com","aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com","","true","2025-03-11T22:21:59.000Z","true"
"02sQk00000MW2TTIA1","500Qk00000LUiPMIA1","2025-03-12T13:28:32.000Z","2025-03-12T13:28:32.000Z","Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref



Hi all,

Please see attached the scan details:



 

 

Task stats:


 

Messages:



 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 



 



 

Here is the last excerpt from the job log:

 



 

Please reply all on your response.

 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com;  rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:


 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 



 

The last piece of SQL that was executed was:



Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 




 




From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 



 

From the Job Status Export the Messages Table, CSV is preferred: 

 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 


Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:


 


 

Messages shows:



 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 



 



 



 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:


 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:


	On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
	If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.  
	Connection between each SQL server and Netwrix server might also become a bottleneck. 
	Netwrix SQL database where data is eventually written could become a bottleneck as well. 


As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied. 

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com; techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


I have added the log to the ticket on the portal.

 

Thank you,

Alison.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.

Here are the servers which have completed:

 

Thank you,

Alison.

 



 

 



 

These are the servers to yet be scanned:









 



 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks. 

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it. 

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks? 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Log uploaded to portal.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Team,

Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408

 

 

From then on, the logs state:

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

 

I have not ended the scan.

 

Thank you,

Alison.


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hi Alison, 

Understood, I will put our ticket on hold and will be waiting for an update from your side. 
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com; techsupport@netwrix.com
Cc: jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

 

Thank you,

Alison.

 


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Cc: jared.harris@netwrix.com
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hello AllState Team, 

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? 
Please, let me know if you have questions - I will be happy to help! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, 

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance. 

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan? 
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:


	On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
	If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment 
	Connection between each SQL server and Netwrix server might also become a bottleneck. 
	Netwrix SQL database where data is eventually written could become a bottleneck as well. 


According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance. 

I am looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean, 

This is Artem with our second ticket for the SQL Permissions scan performance issues. 
Thank you for your time today! 

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers. 
To isolate the cause of the issue I need to analyze support logs for this job. 
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket. 

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share. 

Thank you! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com



ref:!00D70091pB.!500Qk0LUiPM:ref","RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","alison.mills@allstate.com","jared.harris@netwrix.com","damir.akhmatshin@netwrix.com","true","2025-03-12T13:28:32.000Z","true"
"02sQk00000MWDgcIAH","500Qk00000LUiPMIA1","2025-03-12T14:44:34.000Z","2025-03-13T07:58:12.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Please see attached the scan details:
[cid:image001.png@01DB935C.5CE8B330]


Task stats:
[cid:image002.png@01DB935C.5CE8B330]

Messages:
[cid:image003.png@01DB935C.5CE8B330]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image004.png@01DB935C.5CE8B330]

[cid:image005.png@01DB935C.5CE8B330]

Here is the last excerpt from the job log:

[cid:image006.png@01DB935C.5CE8B330]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image007.png@01DB935C.5CE8B330]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image008.png@01DB935C.5CE8B330]

The last piece of SQL that was executed was:
[cid:image009.png@01DB935C.5CE8B330]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image010.png@01DB935C.5CE8B330]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image013.png@01DB935C.5CE8B330]

[cid:image014.png@01DB935C.5CE8B330]

Messages shows:
[cid:image015.png@01DB935C.5CE8B330]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image016.png@01DB935C.5CE8B330]

[cid:image017.png@01DB935C.5CE8B330]

[cid:image018.png@01DB935C.5CE8B330]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image019.png@01DB935C.5CE8B330]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image020.png@01DB935C.5CE8B330]


[cid:image021.png@01DB935C.5CE8B330]

These are the servers to yet be scanned:
[cid:image022.png@01DB935C.5CE8B330]
[cid:image023.png@01DB935C.5CE8B330]
[cid:image024.png@01DB935C.5CE8B330]
[cid:image025.png@01DB935C.5CE8B330]

[cid:image026.png@01DB935C.5CE8B330]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!IZDTAj0iIcLQhr7gPC5_IKiv62HNP4jZ5CYI_oig9OXYVywunGv0sCE33mPBwjxkwRyfBSdo0NY5SVIe5wlbCcLmCWSzScFT5w$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hello AllState Team,

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance?
Please, let me know if you have questions - I will be happy to help!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team,

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance.

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan?
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOGqdO0cAg$>
This will help decrease time to process each individual SQL server.

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance.

I am looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean,

This is Artem with our second ticket for the SQL Permissions scan performance issues.
Thank you for your time today!

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers.
To isolate the cause of the issue I need to analyze support logs for this job.
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket.

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


ref:!00D70091pB.!500Qk0LUiPM:ref












[https://nwxcorp.my.salesforce.com/servlet/servlet.ImageServer?oid=00D7000000091pB&esid=018Qk00000K7th1&from=ext]","RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","alison.mills@allstate.com","Mills, Alison","techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com","aemstealthauditadmins@allstate.com; jared.harris@netwrix.com","","true","2025-03-12T14:43:44.000Z","true"
"02sQk00000MWiqrIAD","500Qk00000LUiPMIA1","2025-03-12T16:24:59.000Z","2025-03-12T16:24:59.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,
Just as an FYI please reply to all.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
Please see attached the scan details:
[cid:image001.png@01DB936B.1D91A6B0]


Task stats:
[cid:image002.png@01DB936B.1D91A6B0]

Messages:
[cid:image003.png@01DB936B.1D91A6B0]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image004.png@01DB936B.1D91A6B0]

[cid:image005.png@01DB936B.1D91A6B0]

Here is the last excerpt from the job log:

[cid:image006.png@01DB936B.1D91A6B0]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image007.png@01DB936B.1D91A6B0]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image008.png@01DB936B.1D91A6B0]

The last piece of SQL that was executed was:
[cid:image009.png@01DB936B.1D91A6B0]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image010.png@01DB936B.1D91A6B0]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image013.png@01DB936B.1D91A6B0]

[cid:image014.png@01DB936B.1D91A6B0]

Messages shows:
[cid:image015.png@01DB936B.1D91A6B0]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image016.png@01DB936B.1D91A6B0]

[cid:image017.png@01DB936B.1D91A6B0]

[cid:image018.png@01DB936B.1D91A6B0]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image019.png@01DB936B.1D91A6B0]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image020.png@01DB936B.1D91A6B0]


[cid:image021.png@01DB936B.1D91A6B0]

These are the servers to yet be scanned:
[cid:image022.png@01DB936B.1D91A6B0]
[cid:image023.png@01DB936B.1D91A6B0]
[cid:image024.png@01DB936B.1D91A6B0]
[cid:image025.png@01DB936B.1D91A6B0]

[cid:image026.png@01DB936B.1D91A6B0]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!IZDTAj0iIcLQhr7gPC5_IKiv62HNP4jZ5CYI_oig9OXYVywunGv0sCE33mPBwjxkwRyfBSdo0NY5SVIe5wlbCcLmCWSzScFT5w$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hello AllState Team,

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance?
Please, let me know if you have questions - I will be happy to help!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team,

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance.

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan?
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOGqdO0cAg$>
This will help decrease time to process each individual SQL server.

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance.

I am looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean,

This is Artem with our second ticket for the SQL Permissions scan performance issues.
Thank you for your time today!

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers.
To isolate the cause of the issue I need to analyze support logs for this job.
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket.

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


ref:!00D70091pB.!500Qk0LUiPM:ref












[https://nwxcorp.my.salesforce.com/servlet/servlet.ImageServer?oid=00D7000000091pB&esid=018Qk00000K7th1&from=ext]","RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","alison.mills@allstate.com","Mills, Alison","techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com","aemstealthauditadmins@allstate.com; jared.harris@netwrix.com","","true","2025-03-12T16:24:00.000Z","true"
"02sQk00000MX4rOIAT","500Qk00000LUiPMIA1","2025-03-12T18:27:33.000Z","2025-03-12T18:27:33.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi all,

[cid:image027.png@01DB9377.F792DCB0]

Per the above,  would someone please advise why there is time difference from 06:29 to 07:47? It appears there is a gap of activity between these times.
Also, when the SQL data has been scanned from the target server, are there tier 2 logs held on the NEA console (as with FSAA)? If there are tier 2 logs, where are they on the NEA console and what format are they stored in?
As of yesterday, we can see 1269329 effective members found.....that seems a lot for one server and just tempDB?
Do we have a list of the target tables where the scanned data is being written to?

I can see 'StatName' but no table name:
[cid:image001.png@01DB937C.2807F700]

Thank you.
Please reply all to this email.

Thank you,
Alison.
From: Mills, Alison
Sent: Wednesday, March 12, 2025 4:24 P
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Just as an FYI please reply to all.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; Damir Akhmatshin <damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
Hi all,
Please see attached the scan details:
[cid:image028.png@01DB9377.F792DCB0]


Task stats:
[cid:image029.png@01DB9377.F792DCB0]

Messages:
[cid:image030.png@01DB9377.F792DCB0]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image031.png@01DB9377.F792DCB0]

[cid:image032.png@01DB9377.F792DCB0]

Here is the last excerpt from the job log:

[cid:image033.png@01DB9377.F792DCB0]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image034.png@01DB9377.F792DCB0]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image035.png@01DB9377.F792DCB0]

The last piece of SQL that was executed was:
[cid:image036.png@01DB9377.F792DCB0]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image037.png@01DB9377.F792DCB0]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image040.png@01DB9377.F792DCB0]

[cid:image041.png@01DB9377.F792DCB0]

Messages shows:
[cid:image042.png@01DB9377.F792DCB0]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image043.png@01DB9377.F792DCB0]

[cid:image044.png@01DB9377.F792DCB0]

[cid:image045.png@01DB9377.F792DCB0]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image046.png@01DB9377.F792DCB0]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image047.png@01DB9377.F792DCB0]


[cid:image048.png@01DB9377.F792DCB0]

These are the servers to yet be scanned:
[cid:image049.png@01DB9377.F792DCB0]
[cid:image050.png@01DB9377.F792DCB0]
[cid:image051.png@01DB9377.F792DCB0]
[cid:image052.png@01DB9377.F792DCB0]

[cid:image053.png@01DB9377.F792DCB0]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!IZDTAj0iIcLQhr7gPC5_IKiv62HNP4jZ5CYI_oig9OXYVywunGv0sCE33mPBwjxkwRyfBSdo0NY5SVIe5wlbCcLmCWSzScFT5w$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hello AllState Team,

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance?
Please, let me know if you have questions - I will be happy to help!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team,

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance.

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan?
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOGqdO0cAg$>
This will help decrease time to process each individual SQL server.

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance.

I am looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean,

This is Artem with our second ticket for the SQL Permissions scan performance issues.
Thank you for your time today!

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers.
To isolate the cause of the issue I need to analyze support logs for this job.
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket.

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


ref:!00D70091pB.!500Qk0LUiPM:ref












[https://nwxcorp.my.salesforce.com/servlet/servlet.ImageServer?oid=00D7000000091pB&esid=018Qk00000K7th1&from=ext]","RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","alison.mills@allstate.com","Mills, Alison","techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com","aemstealthauditadmins@allstate.com; mohith.premachandranpoduval@allstate.com; jared.harris@netwrix.com","","true","2025-03-12T18:26:38.000Z","true"
"02sQk00000MYFJMIA5","500Qk00000LUiPMIA1","2025-03-13T07:58:06.000Z","2025-03-13T07:58:06.000Z","Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref



Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com;  rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi all,

Please see attached the scan details:



 

 

Task stats:


 

Messages:



 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 



 



 

Here is the last excerpt from the job log:

 



 

Please reply all on your response.

 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:


 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 



 

The last piece of SQL that was executed was:



Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 




 




From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 



 

From the Job Status Export the Messages Table, CSV is preferred: 

 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 


Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:


 


 

Messages shows:



 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 



 



 



 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:


 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:


	On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
	If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.  
	Connection between each SQL server and Netwrix server might also become a bottleneck. 
	Netwrix SQL database where data is eventually written could become a bottleneck as well. 


As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied. 

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com; techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


I have added the log to the ticket on the portal.

 

Thank you,

Alison.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.

Here are the servers which have completed:

 

Thank you,

Alison.

 



 

 



 

These are the servers to yet be scanned:









 



 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks. 

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it. 

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks? 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Log uploaded to portal.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Team,

Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408

 

 

From then on, the logs state:

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

 

I have not ended the scan.

 

Thank you,

Alison.


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hi Alison, 

Understood, I will put our ticket on hold and will be waiting for an update from your side. 
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com; techsupport@netwrix.com
Cc: jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

 

Thank you,

Alison.

 


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Cc: jared.harris@netwrix.com
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hello AllState Team, 

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? 
Please, let me know if you have questions - I will be happy to help! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, 

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance. 

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan? 
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:


	On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
	If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment 
	Connection between each SQL server and Netwrix server might also become a bottleneck. 
	Netwrix SQL database where data is eventually written could become a bottleneck as well. 


According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance. 

I am looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean, 

This is Artem with our second ticket for the SQL Permissions scan performance issues. 
Thank you for your time today! 

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers. 
To isolate the cause of the issue I need to analyze support logs for this job. 
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket. 

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share. 

Thank you! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com



ref:!00D70091pB.!500Qk0LUiPM:ref","Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","alison.mills@allstate.com","jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; rkuqk@allstate.com","damir.akhmatshin@netwrix.com","true","2025-03-13T07:58:06.000Z","true"
"02sQk00000MYPvNIAX","500Qk00000LUiPMIA1","2025-03-13T08:10:05.000Z","2025-03-13T08:17:54.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hello All,

What are we waiting on from SQL side please?
I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

Regards
Ravi Kumar

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

You don't often get email from techsupport@netwrix.com<mailto:techsupport@netwrix.com>. Learn why this is important<https://aka.ms/LearnAboutSenderIdentification>
Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
Just as an FYI please reply to all.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; Damir Akhmatshin <damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
Please see attached the scan details:
[cid:image001.png@01DB93C4.3F8B79E0]


Task stats:
[cid:image002.png@01DB93C4.3F8B79E0]

Messages:
[cid:image003.png@01DB93C4.3F8B79E0]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image004.png@01DB93C4.3F8B79E0]

[cid:image005.png@01DB93C4.3F8B79E0]

Here is the last excerpt from the job log:

[cid:image006.png@01DB93C4.3F8B79E0]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image007.png@01DB93C4.3F8B79E0]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image008.png@01DB93C4.3F8B79E0]

The last piece of SQL that was executed was:
[cid:image009.png@01DB93C4.3F8B79E0]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image010.png@01DB93C4.3F8B79E0]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image013.png@01DB93C4.3F8B79E0]

[cid:image014.png@01DB93C4.3F8B79E0]

Messages shows:
[cid:image015.png@01DB93C4.3F8B79E0]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image016.png@01DB93C4.3F8B79E0]

[cid:image017.png@01DB93C4.3F8B79E0]

[cid:image018.png@01DB93C4.3F8B79E0]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image019.png@01DB93C4.3F8B79E0]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image020.png@01DB93C4.3F8B79E0]


[cid:image021.png@01DB93C4.3F8B79E0]

These are the servers to yet be scanned:
[cid:image022.png@01DB93C4.3F8B79E0]
[cid:image023.png@01DB93C4.3F8B79E0]
[cid:image024.png@01DB93C4.3F8B79E0]
[cid:image025.png@01DB93C4.3F8B79E0]

[cid:image026.png@01DB93C4.3F8B79E0]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!IZDTAj0iIcLQhr7gPC5_IKiv62HNP4jZ5CYI_oig9OXYVywunGv0sCE33mPBwjxkwRyfBSdo0NY5SVIe5wlbCcLmCWSzScFT5w$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hello AllState Team,

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance?
Please, let me know if you have questions - I will be happy to help!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team,

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance.

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan?
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOGqdO0cAg$>
This will help decrease time to process each individual SQL server.

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance.

I am looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean,

This is Artem with our second ticket for the SQL Permissions scan performance issues.
Thank you for your time today!

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers.
To isolate the cause of the issue I need to analyze support logs for this job.
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket.

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


ref:!00D70091pB.!500Qk0LUiPM:ref













[https://nwxcorp.my.salesforce.com/servlet/servlet.ImageServer?oid=00D7000000091pB&esid=018Qk00000K9u4K&from=ext]","RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","rkuqk@allstate.com","Kumar, Ravi","alison.mills@allstate.com; techsupport@netwrix.com","aemstealthauditadmins@allstate.com; jared.harris@netwrix.com","","true","2025-03-13T08:09:22.000Z","true"
"02sQk00000MYMEOIA5","500Qk00000LUiPMIA1","2025-03-13T08:22:41.000Z","2025-03-13T08:22:41.000Z","Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com


--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref



Hello All,

 

What are we waiting on from SQL side please?

I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

 

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

 

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

 

Regards

Ravi Kumar

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 


	
		
			 
			
			
			You don't often get email from techsupport@netwrix.com.  Learn why this is important 
			
			
			 
		
	



Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com;  rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 


Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements.  @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi all,

Please see attached the scan details:



 

 

Task stats:


 

Messages:



 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 



 



 

Here is the last excerpt from the job log:

 



 

Please reply all on your response.

 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:


 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 



 

The last piece of SQL that was executed was:



Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 




 




From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 



 

From the Job Status Export the Messages Table, CSV is preferred: 

 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 


Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:


 


 

Messages shows:



 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 



 



 



 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:


 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:


	On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
	If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.  
	Connection between each SQL server and Netwrix server might also become a bottleneck. 
	Netwrix SQL database where data is eventually written could become a bottleneck as well. 


As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied. 

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com; techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


I have added the log to the ticket on the portal.

 

Thank you,

Alison.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.

Here are the servers which have completed:

 

Thank you,

Alison.

 



 

 



 

These are the servers to yet be scanned:









 



 



From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hello Alison, 

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks. 

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it. 

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks? 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Log uploaded to portal.

 



From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]



 

Hi Team,

Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408

 

 

From then on, the logs state:

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

 

I have not ended the scan.

 

Thank you,

Alison.


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hi Alison, 

Understood, I will put our ticket on hold and will be waiting for an update from your side. 
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com; techsupport@netwrix.com
Cc: jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 


Hi Artem,

We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

 

Thank you,

Alison.

 


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Cc: jared.harris@netwrix.com
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


 


Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,



ZjQcmQRYFpfptBannerStart



	
		
			
			
				
					
						
						
							
								
									
									This Message Is From an External Sender! 
									
								
								
									
									This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
									
								
							
						
						
					
				
			
			
		
	



ZjQcmQRYFpfptBannerEnd


Hello AllState Team, 

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? 
Please, let me know if you have questions - I will be happy to help! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, 

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance. 

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan? 
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:


	On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
	If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment 
	Connection between each SQL server and Netwrix server might also become a bottleneck. 
	Netwrix SQL database where data is eventually written could become a bottleneck as well. 


According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance. 

I am looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean, 

This is Artem with our second ticket for the SQL Permissions scan performance issues. 
Thank you for your time today! 

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers. 
To isolate the cause of the issue I need to analyze support logs for this job. 
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket. 

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share. 

Thank you! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com



ref:!00D70091pB.!500Qk0LUiPM:ref","RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","rkuqk@allstate.com","alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com","damir.akhmatshin@netwrix.com","true","2025-03-13T08:22:41.000Z","true"
"02sQk00000MbHbVIAV","500Qk00000LUiPMIA1","2025-03-14T09:56:31.000Z","2025-03-14T12:54:10.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi Ravi,

Could please provide update for the below. The Support team needs some assistance.

Thanks,
Kaviya.

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd
Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNR5HL5Hf$>


--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hello All,

What are we waiting on from SQL side please?
I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

Regards
Ravi Kumar

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


You don't often get email from techsupport@netwrix.com<mailto:techsupport@netwrix.com>. Learn why this is important<https://urldefense.com/v3/__https://aka.ms/LearnAboutSenderIdentification__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNWCe4t6-$>

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
Just as an FYI please reply to all.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; Damir Akhmatshin <damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
Please see attached the scan details:
[cid:image001.png@01DB94F5.4EC3E140]


Task stats:
[cid:image002.png@01DB94F5.4EC3E140]

Messages:
[cid:image003.png@01DB94F5.4EC3E140]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image004.png@01DB94F5.4EC3E140]

[cid:image005.png@01DB94F5.4EC3E140]

Here is the last excerpt from the job log:

[cid:image006.png@01DB94F5.4EC3E140]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image007.png@01DB94F5.4EC3E140]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image008.png@01DB94F5.4EC3E140]

The last piece of SQL that was executed was:
[cid:image009.png@01DB94F5.4EC3E140]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image010.png@01DB94F5.4EC3E140]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image013.png@01DB94F5.4EC3E140]

[cid:image014.png@01DB94F5.4EC3E140]

Messages shows:
[cid:image015.png@01DB94F5.4EC3E140]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image016.png@01DB94F5.4EC3E140]

[cid:image017.png@01DB94F5.4EC3E140]

[cid:image018.png@01DB94F5.4EC3E140]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image019.png@01DB94F5.4EC3E140]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image020.png@01DB94F5.4EC3E140]


[cid:image021.png@01DB94F5.4EC3E140]

These are the servers to yet be scanned:
[cid:image022.png@01DB94F5.4EC3E140]
[cid:image023.png@01DB94F5.4EC3E140]
[cid:image024.png@01DB94F5.4EC3E140]
[cid:image025.png@01DB94F5.4EC3E140]

[cid:image026.png@01DB94F5.4EC3E140]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!IZDTAj0iIcLQhr7gPC5_IKiv62HNP4jZ5CYI_oig9OXYVywunGv0sCE33mPBwjxkwRyfBSdo0NY5SVIe5wlbCcLmCWSzScFT5w$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hello AllState Team,

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance?
Please, let me know if you have questions - I will be happy to help!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team,

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance.

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan?
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOGqdO0cAg$>
This will help decrease time to process each individual SQL server.

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance.

I am looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean,

This is Artem with our second ticket for the SQL Permissions scan performance issues.
Thank you for your time today!

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers.
To isolate the cause of the issue I need to analyze support logs for this job.
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket.

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


ref:!00D70091pB.!500Qk0LUiPM:ref














[https://nwxcorp.my.salesforce.com/servlet/servlet.ImageServer?oid=00D7000000091pB&esid=018Qk00000KA62D&from=ext]","RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","kaaah@allstate.com","., Kaviya","techsupport@netwrix.com; rkuqk@allstate.com","alison.mills@allstate.com; aemstealthauditadmins@allstate.com; jared.harris@netwrix.com","","true","2025-03-14T09:55:47.000Z","true"
"02sQk00000MfYfUIAV","500Qk00000LUiPMIA1","2025-03-16T21:12:32.000Z","2025-03-16T21:12:32.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,
We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.

Thank you,
Alison.

From: ., Kaviya <kaaah@allstate.com>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi,

Could please provide update for the below. The Support team needs some assistance.

Thanks,
Kaviya.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd
Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNR5HL5Hf$>


--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hello All,

What are we waiting on from SQL side please?
I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

Regards
Ravi Kumar

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


You don't often get email from techsupport@netwrix.com<mailto:techsupport@netwrix.com>. Learn why this is important<https://urldefense.com/v3/__https://aka.ms/LearnAboutSenderIdentification__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNWCe4t6-$>

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
Just as an FYI please reply to all.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; Damir Akhmatshin <damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
Please see attached the scan details:
[cid:image001.png@01DB96B7.FCBD0830]


Task stats:
[cid:image002.png@01DB96B7.FCBD0830]

Messages:
[cid:image003.png@01DB96B7.FCBD0830]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image004.png@01DB96B7.FCBD0830]

[cid:image005.png@01DB96B7.FCBD0830]

Here is the last excerpt from the job log:

[cid:image006.png@01DB96B7.FCBD0830]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image007.png@01DB96B7.FCBD0830]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image008.png@01DB96B7.FCBD0830]

The last piece of SQL that was executed was:
[cid:image009.png@01DB96B7.FCBD0830]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image010.png@01DB96B7.FCBD0830]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image013.png@01DB96B7.FCBD0830]

[cid:image014.png@01DB96B7.FCBD0830]

Messages shows:
[cid:image015.png@01DB96B7.FCBD0830]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image016.png@01DB96B7.FCBD0830]

[cid:image017.png@01DB96B7.FCBD0830]

[cid:image018.png@01DB96B7.FCBD0830]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image019.png@01DB96B7.FCBD0830]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image020.png@01DB96B7.FCBD0830]


[cid:image021.png@01DB96B7.FCBD0830]

These are the servers to yet be scanned:
[cid:image022.png@01DB96B7.FCBD0830]
[cid:image023.png@01DB96B7.FCBD0830]
[cid:image024.png@01DB96B7.FCBD0830]
[cid:image025.png@01DB96B7.FCBD0830]

[cid:image026.png@01DB96B7.FCBD0830]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!IZDTAj0iIcLQhr7gPC5_IKiv62HNP4jZ5CYI_oig9OXYVywunGv0sCE33mPBwjxkwRyfBSdo0NY5SVIe5wlbCcLmCWSzScFT5w$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hello AllState Team,

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance?
Please, let me know if you have questions - I will be happy to help!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team,

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance.

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan?
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOGqdO0cAg$>
This will help decrease time to process each individual SQL server.

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance.

I am looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean,

This is Artem with our second ticket for the SQL Permissions scan performance issues.
Thank you for your time today!

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers.
To isolate the cause of the issue I need to analyze support logs for this job.
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket.

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


ref:!00D70091pB.!500Qk0LUiPM:ref














[https://nwxcorp.my.salesforce.com/servlet/servlet.ImageServer?oid=00D7000000091pB&esid=018Qk00000KA62D&from=ext]","RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","alison.mills@allstate.com","Mills, Alison","techsupport@netwrix.com; rkuqk@allstate.com; kaaah@allstate.com","aemstealthauditadmins@allstate.com; jared.harris@netwrix.com","","true","2025-03-16T21:11:52.000Z","true"
"02sQk00000MfzNqIAJ","500Qk00000LUiPMIA1","2025-03-17T05:28:13.000Z","2025-03-17T05:28:13.000Z","Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com; rkuqk@allstate.com; kaaah@allstate.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,

We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.  

 

Thank you,

Alison.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi,

 

Could please provide update for the below. The Support team needs some assistance.

 

Thanks,

Kaviya.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hello All,

 

What are we waiting on from SQL side please?

I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

 

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

 

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

 

Regards

Ravi Kumar

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

	 
	
	
	You don't often get email from techsupport@netwrix.com. Learn why this is important 
	
	
	 
	

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi all,

Please see attached the scan details:

[Inline image name : image001.png]

 

 

Task stats:
[Inline image name : image002.png]

 

Messages:

[Inline image name : image003.png]

 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 

[Inline image name : image004.png]

 

[Inline image name : image005.png]

 

Here is the last excerpt from the job log:

 

[Inline image name : image006.png]

 

Please reply all on your response.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:
[Inline image name : image007.png]

 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 

[Inline image name : image008.png]

 

The last piece of SQL that was executed was:

[Inline image name : image009.png]

Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 

[Inline image name : image010.png]

 

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 

[Inline image name : image011.png]

 

From the Job Status Export the Messages Table, CSV is preferred: 

[Inline image name : image012.png] 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:
[Inline image name : image013.png]

 

[Inline image name : image014.png]
 

Messages shows:

[Inline image name : image015.png]

 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 

[Inline image name : image016.png]

 

[Inline image name : image017.png]

 

[Inline image name : image018.png]

 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[Inline image name : image019.png]

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:

On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.  Connection between each SQL server and Netwrix server might also become a bottleneck. Netwrix SQL database where data is eventually written could become a bottleneck as well. 

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied. 

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com; techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

I have added the log to the ticket on the portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.

Here are the servers which have completed:

 

Thank you,

Alison.

 

[Inline image name : image020.png]

 

 

[Inline image name : image021.png]

 

These are the servers to yet be scanned:

[Inline image name : image022.png]

[Inline image name : image023.png]

[Inline image name : image024.png]

[Inline image name : image025.png]

 

[Inline image name : image026.png]

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks. 

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it. 

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks? 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Log uploaded to portal.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Team,

Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408

 

 

From then on, the logs state:

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

 

I have not ended the scan.

 

Thank you,

Alison.

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison, 

Understood, I will put our ticket on hold and will be waiting for an update from your side. 
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com; techsupport@netwrix.com
Cc: jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Cc: jared.harris@netwrix.com
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hello AllState Team, 

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? 
Please, let me know if you have questions - I will be happy to help! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, 

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance. 

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan? 
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:

On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment Connection between each SQL server and Netwrix server might also become a bottleneck. Netwrix SQL database where data is eventually written could become a bottleneck as well. 

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance. 

I am looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean, 

This is Artem with our second ticket for the SQL Permissions scan performance issues. 
Thank you for your time today! 

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers. 
To isolate the cause of the issue I need to analyze support logs for this job. 
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket. 

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share. 

Thank you! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

ref:!00D70091pB.!500Qk0LUiPM:ref
 

 

 

 

 ","RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","alison.mills@allstate.com","jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com","damir.akhmatshin@netwrix.com","true","2025-03-17T05:28:13.000Z","true"
"02sQk00000MgFcHIAV","500Qk00000LUiPMIA1","2025-03-17T10:07:06.000Z","2025-03-17T10:14:23.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Thank you, Damir.
Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

Damir, would you please advise:
1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?
It may be more advantageous to meet so please advise a time when we can meet to discuss.
Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.

Thank you,
Alison.

From: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi,

Could please provide update for the below. The Support team needs some assistance.

Thanks,
Kaviya.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd
Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNR5HL5Hf$>


--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hello All,

What are we waiting on from SQL side please?
I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

Regards
Ravi Kumar

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


You don't often get email from techsupport@netwrix.com<mailto:techsupport@netwrix.com>. Learn why this is important<https://urldefense.com/v3/__https://aka.ms/LearnAboutSenderIdentification__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNWCe4t6-$>

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
Just as an FYI please reply to all.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; Damir Akhmatshin <damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
Please see attached the scan details:
[cid:image001.png@01DB9720.62FA4C80]


Task stats:
[cid:image002.png@01DB9720.62FA4C80]

Messages:
[cid:image003.png@01DB9720.62FA4C80]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image004.png@01DB9720.62FA4C80]

[cid:image005.png@01DB9720.62FA4C80]

Here is the last excerpt from the job log:

[cid:image006.png@01DB9720.62FA4C80]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image007.png@01DB9720.62FA4C80]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image008.png@01DB9720.62FA4C80]

The last piece of SQL that was executed was:
[cid:image009.png@01DB9720.62FA4C80]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image010.png@01DB9720.62FA4C80]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image013.png@01DB9720.62FA4C80]

[cid:image014.png@01DB9720.62FA4C80]

Messages shows:
[cid:image015.png@01DB9720.62FA4C80]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image016.png@01DB9720.62FA4C80]

[cid:image017.png@01DB9720.62FA4C80]

[cid:image018.png@01DB9720.62FA4C80]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image019.png@01DB9720.62FA4C80]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image020.png@01DB9720.62FA4C80]


[cid:image021.png@01DB9720.62FA4C80]

These are the servers to yet be scanned:
[cid:image022.png@01DB9720.62FA4C80]
[cid:image023.png@01DB9720.62FA4C80]
[cid:image024.png@01DB9720.62FA4C80]
[cid:image025.png@01DB9720.62FA4C80]

[cid:image026.png@01DB9720.62FA4C80]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!IZDTAj0iIcLQhr7gPC5_IKiv62HNP4jZ5CYI_oig9OXYVywunGv0sCE33mPBwjxkwRyfBSdo0NY5SVIe5wlbCcLmCWSzScFT5w$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hello AllState Team,

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance?
Please, let me know if you have questions - I will be happy to help!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team,

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance.

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan?
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOGqdO0cAg$>
This will help decrease time to process each individual SQL server.

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance.

I am looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean,

This is Artem with our second ticket for the SQL Permissions scan performance issues.
Thank you for your time today!

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers.
To isolate the cause of the issue I need to analyze support logs for this job.
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket.

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


ref:!00D70091pB.!500Qk0LUiPM:ref















[https://nwxcorp.my.salesforce.com/servlet/servlet.ImageServer?oid=00D7000000091pB&esid=018Qk00000KG721&from=ext]","RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","alison.mills@allstate.com","Mills, Alison","techsupport@netwrix.com","aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com","","true","2025-03-17T10:06:25.000Z","true"
"02sQk00000MgGlFIAV","500Qk00000LUiPMIA1","2025-03-17T10:25:40.000Z","2025-03-17T10:25:40.000Z","Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Thank you, Damir.

Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

 

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

 

Damir, would you please advise:

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

It may be more advantageous to meet so please advise a time when we can meet to discuss.

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com; rkuqk@allstate.com; kaaah@allstate.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.  

 

Thank you,

Alison.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi,

 

Could please provide update for the below. The Support team needs some assistance.

 

Thanks,

Kaviya.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hello All,

 

What are we waiting on from SQL side please?

I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

 

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

 

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

 

Regards

Ravi Kumar

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

	 
	
	
	You don't often get email from techsupport@netwrix.com. Learn why this is important 
	
	
	 
	

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi all,

Please see attached the scan details:

[Inline image name : image001.png]

 

 

Task stats:
[Inline image name : image002.png]

 

Messages:

[Inline image name : image003.png]

 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 

[Inline image name : image004.png]

 

[Inline image name : image005.png]

 

Here is the last excerpt from the job log:

 

[Inline image name : image006.png]

 

Please reply all on your response.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:
[Inline image name : image007.png]

 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 

[Inline image name : image008.png]

 

The last piece of SQL that was executed was:

[Inline image name : image009.png]

Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 

[Inline image name : image010.png]

 

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 

[Inline image name : image011.png]

 

From the Job Status Export the Messages Table, CSV is preferred: 

[Inline image name : image012.png] 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:
[Inline image name : image013.png]

 

[Inline image name : image014.png]
 

Messages shows:

[Inline image name : image015.png]

 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 

[Inline image name : image016.png]

 

[Inline image name : image017.png]

 

[Inline image name : image018.png]

 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[Inline image name : image019.png]

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:

On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.  Connection between each SQL server and Netwrix server might also become a bottleneck. Netwrix SQL database where data is eventually written could become a bottleneck as well. 

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied. 

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com; techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

I have added the log to the ticket on the portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.

Here are the servers which have completed:

 

Thank you,

Alison.

 

[Inline image name : image020.png]

 

 

[Inline image name : image021.png]

 

These are the servers to yet be scanned:

[Inline image name : image022.png]

[Inline image name : image023.png]

[Inline image name : image024.png]

[Inline image name : image025.png]

 

[Inline image name : image026.png]

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks. 

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it. 

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks? 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Log uploaded to portal.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Team,

Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408

 

 

From then on, the logs state:

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

 

I have not ended the scan.

 

Thank you,

Alison.

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison, 

Understood, I will put our ticket on hold and will be waiting for an update from your side. 
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com; techsupport@netwrix.com
Cc: jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Cc: jared.harris@netwrix.com
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hello AllState Team, 

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? 
Please, let me know if you have questions - I will be happy to help! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, 

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance. 

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan? 
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:

On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment Connection between each SQL server and Netwrix server might also become a bottleneck. Netwrix SQL database where data is eventually written could become a bottleneck as well. 

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance. 

I am looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean, 

This is Artem with our second ticket for the SQL Permissions scan performance issues. 
Thank you for your time today! 

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers. 
To isolate the cause of the issue I need to analyze support logs for this job. 
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket. 

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share. 

Thank you! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

ref:!00D70091pB.!500Qk0LUiPM:ref
 

 

 

 

 ","RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","alison.mills@allstate.com","jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com","damir.akhmatshin@netwrix.com","true","2025-03-17T10:25:39.000Z","true"
"02sQk00000MgrZYIAZ","500Qk00000LUiPMIA1","2025-03-17T14:59:46.000Z","2025-03-18T05:35:16.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.
In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

[cid:image001.png@01DB974B.6819BC20]

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image028.jpg@01DB974D.0A58A860]

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image029.jpg@01DB974D.0A58A860]


Thank you,
Alison.


From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Thank you, Damir.
Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

Damir, would you please advise:
1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?
It may be more advantageous to meet so please advise a time when we can meet to discuss.
Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.

Thank you,
Alison.

From: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi,

Could please provide update for the below. The Support team needs some assistance.

Thanks,
Kaviya.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd
Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNR5HL5Hf$>


--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hello All,

What are we waiting on from SQL side please?
I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

Regards
Ravi Kumar

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


You don't often get email from techsupport@netwrix.com<mailto:techsupport@netwrix.com>. Learn why this is important<https://urldefense.com/v3/__https://aka.ms/LearnAboutSenderIdentification__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNWCe4t6-$>

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
Just as an FYI please reply to all.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; Damir Akhmatshin <damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
Please see attached the scan details:
[cid:image002.png@01DB974B.6819BC20]


Task stats:
[cid:image003.png@01DB974B.6819BC20]

Messages:
[cid:image004.png@01DB974B.6819BC20]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image005.png@01DB974B.6819BC20]

[cid:image006.png@01DB974B.6819BC20]

Here is the last excerpt from the job log:

[cid:image007.png@01DB974B.6819BC20]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image008.png@01DB974B.6819BC20]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image009.png@01DB974B.6819BC20]

The last piece of SQL that was executed was:
[cid:image010.png@01DB974B.6819BC20]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image011.png@01DB974B.6819BC20]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image014.png@01DB974B.6819BC20]

[cid:image015.png@01DB974B.6819BC20]

Messages shows:
[cid:image016.png@01DB974B.6819BC20]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image017.png@01DB974B.6819BC20]

[cid:image018.png@01DB974B.6819BC20]

[cid:image019.png@01DB974B.6819BC20]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image020.png@01DB974B.6819BC20]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image021.png@01DB974B.6819BC20]


[cid:image022.png@01DB974B.6819BC20]

These are the servers to yet be scanned:
[cid:image023.png@01DB974B.6819BC20]
[cid:image024.png@01DB974B.6819BC20]
[cid:image025.png@01DB974B.6819BC20]
[cid:image026.png@01DB974B.6819BC20]

[cid:image027.png@01DB974B.6819BC20]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!IZDTAj0iIcLQhr7gPC5_IKiv62HNP4jZ5CYI_oig9OXYVywunGv0sCE33mPBwjxkwRyfBSdo0NY5SVIe5wlbCcLmCWSzScFT5w$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hello AllState Team,

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance?
Please, let me know if you have questions - I will be happy to help!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team,

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance.

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan?
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOGqdO0cAg$>
This will help decrease time to process each individual SQL server.

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance.

I am looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean,

This is Artem with our second ticket for the SQL Permissions scan performance issues.
Thank you for your time today!

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers.
To isolate the cause of the issue I need to analyze support logs for this job.
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket.

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


ref:!00D70091pB.!500Qk0LUiPM:ref","RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","alison.mills@allstate.com","Mills, Alison","techsupport@netwrix.com","aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com","","true","2025-03-17T14:58:56.000Z","true"
"02sQk00000Mgv26IAB","500Qk00000LUiPMIA1","2025-03-17T16:03:16.000Z","2025-03-18T07:47:46.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hey all,
As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi all,
I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.
In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

[cid:image001.png@01DB974B.6819BC20]

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image028.jpg@01DB974D.0A58A860]

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image029.jpg@01DB974D.0A58A860]


Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Thank you, Damir.
Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

Damir, would you please advise:
1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?
It may be more advantageous to meet so please advise a time when we can meet to discuss.
Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.

Thank you,
Alison.

From: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi,

Could please provide update for the below. The Support team needs some assistance.

Thanks,
Kaviya.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd
Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNR5HL5Hf$>


--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hello All,

What are we waiting on from SQL side please?
I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

Regards
Ravi Kumar

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


You don't often get email from techsupport@netwrix.com<mailto:techsupport@netwrix.com>. Learn why this is important<https://urldefense.com/v3/__https://aka.ms/LearnAboutSenderIdentification__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNWCe4t6-$>

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
Just as an FYI please reply to all.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; Damir Akhmatshin <damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
Please see attached the scan details:
[cid:image002.png@01DB974B.6819BC20]


Task stats:
[cid:image003.png@01DB974B.6819BC20]

Messages:
[cid:image004.png@01DB974B.6819BC20]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image005.png@01DB974B.6819BC20]

[cid:image006.png@01DB974B.6819BC20]

Here is the last excerpt from the job log:

[cid:image007.png@01DB974B.6819BC20]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image008.png@01DB974B.6819BC20]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image009.png@01DB974B.6819BC20]

The last piece of SQL that was executed was:
[cid:image010.png@01DB974B.6819BC20]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image011.png@01DB974B.6819BC20]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image014.png@01DB974B.6819BC20]

[cid:image015.png@01DB974B.6819BC20]

Messages shows:
[cid:image016.png@01DB974B.6819BC20]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image017.png@01DB974B.6819BC20]

[cid:image018.png@01DB974B.6819BC20]

[cid:image019.png@01DB974B.6819BC20]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image020.png@01DB974B.6819BC20]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image021.png@01DB974B.6819BC20]


[cid:image022.png@01DB974B.6819BC20]

These are the servers to yet be scanned:
[cid:image023.png@01DB974B.6819BC20]
[cid:image024.png@01DB974B.6819BC20]
[cid:image025.png@01DB974B.6819BC20]
[cid:image026.png@01DB974B.6819BC20]

[cid:image027.png@01DB974B.6819BC20]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!IZDTAj0iIcLQhr7gPC5_IKiv62HNP4jZ5CYI_oig9OXYVywunGv0sCE33mPBwjxkwRyfBSdo0NY5SVIe5wlbCcLmCWSzScFT5w$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hello AllState Team,

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance?
Please, let me know if you have questions - I will be happy to help!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team,

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance.

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan?
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOGqdO0cAg$>
This will help decrease time to process each individual SQL server.

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this because depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance.

I am looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/5/2025 5:09 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Greetings Alyson, Sean,

This is Artem with our second ticket for the SQL Permissions scan performance issues.
Thank you for your time today!

Here is a recap for your records:

We discussed that that SQL Permissions scan job is running very slowly. Current Job run has been active for the last 6 days and it keeps processing servers.
To isolate the cause of the issue I need to analyze support logs for this job.
We collected SQL Permissions Scan Job logs and its Messages. These artifacts are uploaded to the ticket.

Please, allow me time to go through support logs. I will get back to you as soon as I have news to share.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


ref:!00D70091pB.!500Qk0LUiPM:ref","FW:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","alison.mills@allstate.com","Mills, Alison","techsupport@netwrix.com","aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com","","true","2025-03-17T16:01:28.000Z","true"
"02sQk00000MjA9pIAF","500Qk00000LUiPMIA1","2025-03-18T11:10:01.000Z","2025-03-18T11:10:01.000Z","Hi everyone, thank you for your time on meeting, I've reviewed current state of the issue and SQL Permissions scan settings. As Alison mentioned and demonstrated on meeting, temp db scan takes around 40 minutes from one server and around 7 hours from another, we've collected logs for both scans.

We would need to clarify the issue with development team, including questions regarding row count question asked on March 17, 2025.

I will follow up and will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hey all,

As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi all,

I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.

In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

 

[Inline image name : image001.png]

 

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image028.jpg]

 

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image029.jpg]

 

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Thank you, Damir.

Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

 

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

 

Damir, would you please advise:

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

It may be more advantageous to meet so please advise a time when we can meet to discuss.

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com; rkuqk@allstate.com; kaaah@allstate.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.  

 

Thank you,

Alison.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi,

 

Could please provide update for the below. The Support team needs some assistance.

 

Thanks,

Kaviya.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hello All,

 

What are we waiting on from SQL side please?

I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

 

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

 

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

 

Regards

Ravi Kumar

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

	 
	
	
	You don't often get email from techsupport@netwrix.com. Learn why this is important 
	
	
	 
	

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi all,

Please see attached the scan details:

[Inline image name : image002.png]

 

 

Task stats:
[Inline image name : image003.png]

 

Messages:

[Inline image name : image004.png]

 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 

[Inline image name : image005.png]

 

[Inline image name : image006.png]

 

Here is the last excerpt from the job log:

 

[Inline image name : image007.png]

 

Please reply all on your response.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:
[Inline image name : image008.png]

 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 

[Inline image name : image009.png]

 

The last piece of SQL that was executed was:

[Inline image name : image010.png]

Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 

[Inline image name : image011.png]

 

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 

[Inline image name : image012.png]

 

From the Job Status Export the Messages Table, CSV is preferred: 

[Inline image name : image013.png] 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:
[Inline image name : image014.png]

 

[Inline image name : image015.png]
 

Messages shows:

[Inline image name : image016.png]

 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 

[Inline image name : image017.png]

 

[Inline image name : image018.png]

 

[Inline image name : image019.png]

 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[Inline image name : image020.png]

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:

On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.  Connection between each SQL server and Netwrix server might also become a bottleneck. Netwrix SQL database where data is eventually written could become a bottleneck as well. 

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied. 

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com; techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

I have added the log to the ticket on the portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.

Here are the servers which have completed:

 

Thank you,

Alison.

 

[Inline image name : image021.png]

 

 

[Inline image name : image022.png]

 

These are the servers to yet be scanned:

[Inline image name : image023.png]

[Inline image name : image024.png]

[Inline image name : image025.png]

[Inline image name : image026.png]

 

[Inline image name : image027.png]

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks. 

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it. 

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks? 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Log uploaded to portal.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Team,

Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408

 

 

From then on, the logs state:

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

 

I have not ended the scan.

 

Thank you,

Alison.

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison, 

Understood, I will put our ticket on hold and will be waiting for an update from your side. 
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com; techsupport@netwrix.com
Cc: jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Cc: jared.harris@netwrix.com
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hello AllState Team, 

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? 
Please, let me know if you have questions - I will be happy to help! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, 

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance. 

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan? 
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:

On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment Connection between each SQL server and Netwrix server might also become a bottleneck. Netwrix SQL database where data is eventually written could become a bottleneck as well. 

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this becau","RE: FW:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","alison.mills@allstate.com","jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com","damir.akhmatshin@netwrix.com","true","2025-03-18T11:10:00.000Z","true"
"02sQk00000MlrVdIAJ","500Qk00000LUiPMIA1","2025-03-19T10:28:13.000Z","2025-03-19T10:28:13.000Z","Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test?

2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists:

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

3. Are both servers in the same physical location? 

4. Can you run ping command using command line: 

ping A0185-DBS0079-S

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both.

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hey all,

As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi all,

I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.

In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

 

[Inline image name : image001.png]

 

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image028.jpg]

 

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image029.jpg]

 

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Thank you, Damir.

Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

 

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

 

Damir, would you please advise:

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

It may be more advantageous to meet so please advise a time when we can meet to discuss.

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com; rkuqk@allstate.com; kaaah@allstate.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.  

 

Thank you,

Alison.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi,

 

Could please provide update for the below. The Support team needs some assistance.

 

Thanks,

Kaviya.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hello All,

 

What are we waiting on from SQL side please?

I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

 

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

 

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

 

Regards

Ravi Kumar

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

	 
	
	
	You don't often get email from techsupport@netwrix.com. Learn why this is important 
	
	
	 
	

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi all,

Please see attached the scan details:

[Inline image name : image002.png]

 

 

Task stats:
[Inline image name : image003.png]

 

Messages:

[Inline image name : image004.png]

 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 

[Inline image name : image005.png]

 

[Inline image name : image006.png]

 

Here is the last excerpt from the job log:

 

[Inline image name : image007.png]

 

Please reply all on your response.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:
[Inline image name : image008.png]

 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 

[Inline image name : image009.png]

 

The last piece of SQL that was executed was:

[Inline image name : image010.png]

Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 

[Inline image name : image011.png]

 

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 

[Inline image name : image012.png]

 

From the Job Status Export the Messages Table, CSV is preferred: 

[Inline image name : image013.png] 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:
[Inline image name : image014.png]

 

[Inline image name : image015.png]
 

Messages shows:

[Inline image name : image016.png]

 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 

[Inline image name : image017.png]

 

[Inline image name : image018.png]

 

[Inline image name : image019.png]

 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[Inline image name : image020.png]

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:

On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.  Connection between each SQL server and Netwrix server might also become a bottleneck. Netwrix SQL database where data is eventually written could become a bottleneck as well. 

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied. 

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com; techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

I have added the log to the ticket on the portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.

Here are the servers which have completed:

 

Thank you,

Alison.

 

[Inline image name : image021.png]

 

 

[Inline image name : image022.png]

 

These are the servers to yet be scanned:

[Inline image name : image023.png]

[Inline image name : image024.png]

[Inline image name : image025.png]

[Inline image name : image026.png]

 

[Inline image name : image027.png]

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks. 

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it. 

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks? 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Log uploaded to portal.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Team,

Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408

 

 

From then on, the logs state:

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

 

I have not ended the scan.

 

Thank you,

Alison.

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison, 

Understood, I will put our ticket on hold and will be waiting for an update from your side. 
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com; techsupport@netwrix.com
Cc: jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Cc: jared.harris@netwrix.com
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hello AllState Team, 

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? 
Please, let me know if you have questions - I will be happy to help! 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com
Cc: jared.harris@netwrix.com
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, 

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance. 

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan? 
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:

On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment Connection between each SQL server and Netwrix server might also become a bottleneck. Netwrix SQL database where data is eventually written could become a bottleneck as well. 

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this becau","Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","alison.mills@allstate.com","jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com","damir.akhmatshin@netwrix.com","true","2025-03-19T10:28:13.000Z","true"
"02sQk00000Mm7x2IAB","500Qk00000LUiPMIA1","2025-03-19T13:08:49.000Z","2025-03-20T06:10:43.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,
Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).
Currently:

[cid:image041.png@01DB98CF.7BE52A70]

Task stats:
[cid:image042.png@01DB98CF.7BE52A70]

Messages:
[cid:image043.png@01DB98CF.7BE52A70]

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.
[cid:image001.png@01DB98BD.B4514EF0]

[cid:image002.png@01DB98BD.B4514EF0]

[cid:image032.png@01DB98BE.665EF930]

DB:
[cid:image034.png@01DB98BF.33502EF0]


2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

A0185-APP2750-S:

[cid:image040.png@01DB98C8.5CBE7B30]

[cid:image039.png@01DB98C7.732C5280]


3. Are both servers in the same physical location? Yes.
[cid:image033.png@01DB98BE.D36918D0]

[cid:image035.png@01DB98BF.33502EF0]

[cid:image036.png@01DB98BF.33502EF0]

Prod DB:
[cid:image037.png@01DB98BF.93A19FA0]


Dev DB:
[cid:image038.png@01DB98BF.F3799A90]

4. Can you run ping command using command line:

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hey all,
As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi all,
I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.
In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

[cid:image003.png@01DB98BD.B4514EF0]

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image004.jpg@01DB98BD.B4514EF0]

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image005.jpg@01DB98BD.B4514EF0]


Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Thank you, Damir.
Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

Damir, would you please advise:
1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?
It may be more advantageous to meet so please advise a time when we can meet to discuss.
Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.

Thank you,
Alison.

From: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi,

Could please provide update for the below. The Support team needs some assistance.

Thanks,
Kaviya.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd
Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNR5HL5Hf$>


--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hello All,

What are we waiting on from SQL side please?
I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

Regards
Ravi Kumar

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


You don't often get email from techsupport@netwrix.com<mailto:techsupport@netwrix.com>. Learn why this is important<https://urldefense.com/v3/__https://aka.ms/LearnAboutSenderIdentification__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNWCe4t6-$>

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
Just as an FYI please reply to all.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; Damir Akhmatshin <damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
Please see attached the scan details:
[cid:image006.png@01DB98BD.B4514EF0]


Task stats:
[cid:image007.png@01DB98BD.B4514EF0]

Messages:
[cid:image008.png@01DB98BD.B4514EF0]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image009.png@01DB98BD.B4514EF0]

[cid:image010.png@01DB98BD.B4514EF0]

Here is the last excerpt from the job log:

[cid:image011.png@01DB98BD.B4514EF0]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image012.png@01DB98BD.B4514EF0]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image013.png@01DB98BD.B4514EF0]

The last piece of SQL that was executed was:
[cid:image014.png@01DB98BD.B4514EF0]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image015.png@01DB98BD.B4514EF0]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image018.png@01DB98BD.B4514EF0]

[cid:image019.png@01DB98BD.B4514EF0]

Messages shows:
[cid:image020.png@01DB98BD.B4514EF0]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image021.png@01DB98BD.B4514EF0]

[cid:image022.png@01DB98BD.B4514EF0]

[cid:image023.png@01DB98BD.B4514EF0]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image024.png@01DB98BD.B4514EF0]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image025.png@01DB98BD.B4514EF0]


[cid:image026.png@01DB98BD.B4514EF0]

These are the servers to yet be scanned:
[cid:image027.png@01DB98BD.B4514EF0]
[cid:image028.png@01DB98BD.B4514EF0]
[cid:image029.png@01DB98BD.B4514EF0]
[cid:image030.png@01DB98BD.B4514EF0]

[cid:image031.png@01DB98BD.B4514EF0]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!IZDTAj0iIcLQhr7gPC5_IKiv62HNP4jZ5CYI_oig9OXYVywunGv0sCE33mPBwjxkwRyfBSdo0NY5SVIe5wlbCcLmCWSzScFT5w$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hello AllState Team,

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance?
Please, let me know if you have questions - I will be happy to help!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team,

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance.

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan?
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOGqdO0cAg$>
This will help decrease time to process each individual SQL server.

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this becau
[https://nwxcorp.my.salesforce.com/servlet/servlet.ImageServer?oid=00D7000000091pB&esid=018Qk00000KLWXe&from=ext]","RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","alison.mills@allstate.com","Mills, Alison","techsupport@netwrix.com","aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com","","true","2025-03-19T13:07:54.000Z","true"
"02sQk00000Mm86hIAB","500Qk00000LUiPMIA1","2025-03-19T13:19:26.000Z","2025-03-20T06:11:01.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,
Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).
Currently:

[cid:image041.png@01DB98CF.7BE52A70]

Task stats:
[cid:image042.png@01DB98CF.7BE52A70]

Messages:
[cid:image043.png@01DB98CF.7BE52A70]

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.
[cid:image001.png@01DB98BD.B4514EF0]

[cid:image002.png@01DB98BD.B4514EF0]

[cid:image032.png@01DB98BE.665EF930]

DB:
[cid:image034.png@01DB98BF.33502EF0]


2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

A0185-APP2750-S: attached to portal.

3. Are both servers in the same physical location? Yes.
[cid:image033.png@01DB98BE.D36918D0]

[cid:image035.png@01DB98BF.33502EF0]

[cid:image036.png@01DB98BF.33502EF0]

Prod DB:
[cid:image037.png@01DB98BF.93A19FA0]

Dev DB:
[cid:image038.png@01DB98BF.F3799A90]

4. Can you run ping command using command line:

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hey all,
As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi all,
I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.
In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

[cid:image003.png@01DB98BD.B4514EF0]

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image004.jpg@01DB98BD.B4514EF0]

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image005.jpg@01DB98BD.B4514EF0]


Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Thank you, Damir.
Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

Damir, would you please advise:
1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?
It may be more advantageous to meet so please advise a time when we can meet to discuss.
Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.

Thank you,
Alison.

From: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi,

Could please provide update for the below. The Support team needs some assistance.

Thanks,
Kaviya.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd
Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNR5HL5Hf$>


--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hello All,

What are we waiting on from SQL side please?
I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

Regards
Ravi Kumar

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


You don't often get email from techsupport@netwrix.com<mailto:techsupport@netwrix.com>. Learn why this is important<https://urldefense.com/v3/__https://aka.ms/LearnAboutSenderIdentification__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNWCe4t6-$>

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
Just as an FYI please reply to all.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; Damir Akhmatshin <damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
Please see attached the scan details:
[cid:image006.png@01DB98BD.B4514EF0]


Task stats:
[cid:image007.png@01DB98BD.B4514EF0]

Messages:
[cid:image008.png@01DB98BD.B4514EF0]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image009.png@01DB98BD.B4514EF0]

[cid:image010.png@01DB98BD.B4514EF0]

Here is the last excerpt from the job log:

[cid:image011.png@01DB98BD.B4514EF0]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image012.png@01DB98BD.B4514EF0]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image013.png@01DB98BD.B4514EF0]

The last piece of SQL that was executed was:
[cid:image014.png@01DB98BD.B4514EF0]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image015.png@01DB98BD.B4514EF0]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image018.png@01DB98BD.B4514EF0]

[cid:image019.png@01DB98BD.B4514EF0]

Messages shows:
[cid:image020.png@01DB98BD.B4514EF0]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image021.png@01DB98BD.B4514EF0]

[cid:image022.png@01DB98BD.B4514EF0]

[cid:image023.png@01DB98BD.B4514EF0]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image024.png@01DB98BD.B4514EF0]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image025.png@01DB98BD.B4514EF0]


[cid:image026.png@01DB98BD.B4514EF0]

These are the servers to yet be scanned:
[cid:image027.png@01DB98BD.B4514EF0]
[cid:image028.png@01DB98BD.B4514EF0]
[cid:image029.png@01DB98BD.B4514EF0]
[cid:image030.png@01DB98BD.B4514EF0]

[cid:image031.png@01DB98BD.B4514EF0]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!IZDTAj0iIcLQhr7gPC5_IKiv62HNP4jZ5CYI_oig9OXYVywunGv0sCE33mPBwjxkwRyfBSdo0NY5SVIe5wlbCcLmCWSzScFT5w$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hello AllState Team,

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance?
Please, let me know if you have questions - I will be happy to help!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team,

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance.

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan?
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOGqdO0cAg$>
This will help decrease time to process each individual SQL server.

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this becau","RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","alison.mills@allstate.com","Mills, Alison","techsupport@netwrix.com","aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com","","true","2025-03-19T13:16:29.000Z","true"
"02sQk00000MmEfCIAV","500Qk00000LUiPMIA1","2025-03-19T14:47:27.000Z","2025-03-20T07:17:17.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,
The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).
Currently:

[cid:image039.png@01DB98DD.5CDFB240]

Task stats:
[cid:image040.png@01DB98DD.5CDFB240]

Messages:
[cid:image041.png@01DB98DD.5CDFB240]

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.
[cid:image042.png@01DB98DD.5CDFB240]

[cid:image043.png@01DB98DD.5CDFB240]

[cid:image044.png@01DB98DD.5CDFB240]

DB:
[cid:image045.png@01DB98DD.5CDFB240]


2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

A0185-APP2750-S: attached to portal.

3. Are both servers in the same physical location? Yes.
[cid:image046.png@01DB98DD.5CDFB240]

[cid:image047.png@01DB98DD.5CDFB240]

[cid:image048.png@01DB98DD.5CDFB240]

Prod DB:
[cid:image049.png@01DB98DD.5CDFB240]

Dev DB:
[cid:image050.png@01DB98DD.5CDFB240]

4. Can you run ping command using command line:

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
Hey all,
As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi all,
I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.
In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

[cid:image051.png@01DB98DD.5CDFB240]

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image052.jpg@01DB98DD.5CDFB240]

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image053.jpg@01DB98DD.5CDFB240]


Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Thank you, Damir.
Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

Damir, would you please advise:
1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?
It may be more advantageous to meet so please advise a time when we can meet to discuss.
Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.

Thank you,
Alison.

From: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi,

Could please provide update for the below. The Support team needs some assistance.

Thanks,
Kaviya.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd
Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNR5HL5Hf$>


--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hello All,

What are we waiting on from SQL side please?
I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

Regards
Ravi Kumar

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


You don't often get email from techsupport@netwrix.com<mailto:techsupport@netwrix.com>. Learn why this is important<https://urldefense.com/v3/__https://aka.ms/LearnAboutSenderIdentification__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNWCe4t6-$>

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
Just as an FYI please reply to all.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; Damir Akhmatshin <damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
Please see attached the scan details:
[cid:image054.png@01DB98DD.5CDFB240]


Task stats:
[cid:image055.png@01DB98DD.5CDFB240]

Messages:
[cid:image056.png@01DB98DD.5CDFB240]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image057.png@01DB98DD.5CDFB240]

[cid:image058.png@01DB98DD.5CDFB240]

Here is the last excerpt from the job log:

[cid:image059.png@01DB98DD.5CDFB240]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image060.png@01DB98DD.5CDFB240]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image061.png@01DB98DD.5CDFB240]

The last piece of SQL that was executed was:
[cid:image062.png@01DB98DD.5CDFB240]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image063.png@01DB98DD.5CDFB240]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image066.png@01DB98DD.5CDFB240]

[cid:image067.png@01DB98DD.5CDFB240]

Messages shows:
[cid:image068.png@01DB98DD.5CDFB240]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image069.png@01DB98DD.5CDFB240]

[cid:image070.png@01DB98DD.5CDFB240]

[cid:image071.png@01DB98DD.5CDFB240]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image072.png@01DB98DD.5CDFB240]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image073.png@01DB98DD.5CDFB240]


[cid:image074.png@01DB98DD.5CDFB240]

These are the servers to yet be scanned:
[cid:image075.png@01DB98DD.5CDFB240]
[cid:image076.png@01DB98DD.5CDFB240]
[cid:image077.png@01DB98DD.5CDFB240]
[cid:image078.png@01DB98DD.5CDFB240]

[cid:image079.png@01DB98DD.5CDFB240]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!IZDTAj0iIcLQhr7gPC5_IKiv62HNP4jZ5CYI_oig9OXYVywunGv0sCE33mPBwjxkwRyfBSdo0NY5SVIe5wlbCcLmCWSzScFT5w$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/10/2025 5:38 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
We have requested assistance from our DBA team. We will update the ticket as soon as we can confirm the points you have raised below.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 1:19 PM
To: AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [External] RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team, Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance? Please, let me know if you have questions - I will be happy to help! Best regards,
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hello AllState Team,

Did you have time to review my previous email with additional questions and suggestions on how to improve SQL permissions scan performance?
Please, let me know if you have questions - I will be happy to help!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOEkRjPjIQ$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/6/2025 7:21 PM
To: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello AllState Team,

Thank you for waiting, I have an update for you regarding SQL Permissions scan performance.

I realized that we haven`t touched this during our meeting last time, but none the less it is an important detail - what is the expected time to complete SQL Permissions scan?
May I ask you to clarify, what is an average time this task took to complete previously?

To continue, to make sure we are on the same page I wanted to provide details about how SQL Permissions scan works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan. After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. At the moment
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

According to this, I would like to suggest the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOGqdO0cAg$>
This will help decrease time to process each individual SQL server.

2. To continue, since you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!LvdsWOTGrx5eHmpLzK24DIqz0OOALRy_43TYpUO-Y860FwLjiyC3Pbrbk3lLE35_W-bZ4mVBupMZCj89yqxdOcwenOG2tZfk7A$>

3. May I ask you to check the Netwrix`s SQL Database recovery mode? Is it set to Simple or Full recovery mode?
It is important to check this becau","RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","alison.mills@allstate.com","Mills, Alison","techsupport@netwrix.com","aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com","","true","2025-03-19T14:45:01.000Z","true"
"02sQk00000MoLe5IAF","500Qk00000LUiPMIA1","2025-03-20T07:24:23.000Z","2025-03-20T07:24:23.000Z","Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

Login to A0185-APP2750-S open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,

The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).

Currently:

 

[Inline image name : image039.png]

 

Task stats:

[Inline image name : image040.png]

 

Messages:

[Inline image name : image041.png]

 

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.

[Inline image name : image042.png]

 

[Inline image name : image043.png]

 

[Inline image name : image044.png]

 

DB:

[Inline image name : image045.png]

2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

 

A0185-APP2750-S: attached to portal.

 

3. Are both servers in the same physical location? Yes.

[Inline image name : image046.png]

 

[Inline image name : image047.png]

 

[Inline image name : image048.png]

 

Prod DB:

[Inline image name : image049.png]

 

Dev DB:

[Inline image name : image050.png]

4. Can you run ping command using command line: 

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hey all,

As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi all,

I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.

In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

 

[Inline image name : image051.png]

 

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image052.jpg]

 

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image053.jpg]

 

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Thank you, Damir.

Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

 

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

 

Damir, would you please advise:

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

It may be more advantageous to meet so please advise a time when we can meet to discuss.

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com; rkuqk@allstate.com; kaaah@allstate.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.  

 

Thank you,

Alison.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi,

 

Could please provide update for the below. The Support team needs some assistance.

 

Thanks,

Kaviya.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hello All,

 

What are we waiting on from SQL side please?

I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

 

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

 

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

 

Regards

Ravi Kumar

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

	 
	
	
	You don't often get email from techsupport@netwrix.com. Learn why this is important 
	
	
	 
	

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi all,

Please see attached the scan details:

[Inline image name : image054.png]

 

 

Task stats:
[Inline image name : image055.png]

 

Messages:

[Inline image name : image056.png]

 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 

[Inline image name : image057.png]

 

[Inline image name : image058.png]

 

Here is the last excerpt from the job log:

 

[Inline image name : image059.png]

 

Please reply all on your response.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:
[Inline image name : image060.png]

 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 

[Inline image name : image061.png]

 

The last piece of SQL that was executed was:

[Inline image name : image062.png]

Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 

[Inline image name : image063.png]

 

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 

[Inline image name : image064.png]

 

From the Job Status Export the Messages Table, CSV is preferred: 

[Inline image name : image065.png] 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:
[Inline image name : image066.png]

 

[Inline image name : image067.png]
 

Messages shows:

[Inline image name : image068.png]

 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 

[Inline image name : image069.png]

 

[Inline image name : image070.png]

 

[Inline image name : image071.png]

 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[Inline image name : image072.png]

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:

On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.  Connection between each SQL server and Netwrix server might also become a bottleneck. Netwrix SQL database where data is eventually written could become a bottleneck as well. 

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied. 

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com; techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

I have added the log to the ticket on the portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.

Here are the servers which have completed:

 

Thank you,

Alison.

 

[Inline image name : image073.png]

 

 

[Inline image name : image074.png]

 

These are the servers to yet be scanned:

[Inline image name : image075.png]

[Inline image name : image076.png]

[Inline image name : image077.png]

[Inline image name : image078.png]

 

[Inline image name : image079.png]

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks. 

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it. 

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks? 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Log uploaded to portal.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Team,

Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408

 

 

From then on, the logs state:

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408

11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

 

I have not ended the scan.

 

Thank you,

Alison.

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison, 

Understood, I will put our ticket on hold and will be waiting for an update from your side. 
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support E","RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","alison.mills@allstate.com","jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com","damir.akhmatshin@netwrix.com","true","2025-03-20T07:24:23.000Z","true"
"02sQk00000MoNUbIAN","500Qk00000LUiPMIA1","2025-03-20T07:55:53.000Z","2025-03-20T12:00:23.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,

Please see screenshots below.

Thanks,
Sean

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 20, 2025 7:24 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run:

ping A0185-DBS0079-S

Take screenshot of output.
[cid:image001.png@01DB996D.306CE710]


Login to A0185-APP2750-S open command line and run:

ping A0185-DBS0079-S

Take screenshot of output.
[cid:image002.png@01DB996D.306CE710]


Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).
Currently:

[cid:image003.png@01DB996D.306CE710]

Task stats:
[cid:image004.png@01DB996D.306CE710]

Messages:
[cid:image005.png@01DB996D.306CE710]

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.
[cid:image006.png@01DB996D.306CE710]

[cid:image007.png@01DB996D.306CE710]

[cid:image008.png@01DB996D.306CE710]

DB:
[cid:image009.png@01DB996D.306CE710]


2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

A0185-APP2750-S: attached to portal.

3. Are both servers in the same physical location? Yes.
[cid:image010.png@01DB996D.306CE710]

[cid:image011.png@01DB996D.306CE710]

[cid:image012.png@01DB996D.306CE710]

Prod DB:
[cid:image013.png@01DB996D.306CE710]

Dev DB:
[cid:image014.png@01DB996D.306CE710]

4. Can you run ping command using command line:

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
Hey all,
As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi all,
I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.
In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

[cid:image015.png@01DB996D.306CE710]

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image016.jpg@01DB996D.306CE710]

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image017.jpg@01DB996D.306CE710]


Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Thank you, Damir.
Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

Damir, would you please advise:
1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?
It may be more advantageous to meet so please advise a time when we can meet to discuss.
Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.

Thank you,
Alison.

From: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi,

Could please provide update for the below. The Support team needs some assistance.

Thanks,
Kaviya.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd
Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNR5HL5Hf$>


--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hello All,

What are we waiting on from SQL side please?
I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

Regards
Ravi Kumar

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


You don't often get email from techsupport@netwrix.com<mailto:techsupport@netwrix.com>. Learn why this is important<https://urldefense.com/v3/__https://aka.ms/LearnAboutSenderIdentification__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNWCe4t6-$>

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
Just as an FYI please reply to all.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; Damir Akhmatshin <damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
Please see attached the scan details:
[cid:image018.png@01DB996D.306CE710]


Task stats:
[cid:image019.png@01DB996D.306CE710]

Messages:
[cid:image020.png@01DB996D.306CE710]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image021.png@01DB996D.306CE710]

[cid:image022.png@01DB996D.306CE710]

Here is the last excerpt from the job log:

[cid:image023.png@01DB996D.306CE710]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image024.png@01DB996D.306CE710]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image025.png@01DB996D.306CE710]

The last piece of SQL that was executed was:
[cid:image026.png@01DB996D.306CE710]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image027.png@01DB996D.306CE710]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image030.png@01DB996D.306CE710]

[cid:image031.png@01DB996D.306CE710]

Messages shows:
[cid:image032.png@01DB996D.306CE710]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image033.png@01DB996D.306CE710]

[cid:image034.png@01DB996D.306CE710]

[cid:image035.png@01DB996D.306CE710]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image036.png@01DB996D.306CE710]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image037.png@01DB996D.306CE710]


[cid:image038.png@01DB996D.306CE710]

These are the servers to yet be scanned:
[cid:image039.png@01DB996D.306CE710]
[cid:image040.png@01DB996D.306CE710]
[cid:image041.png@01DB996D.306CE710]
[cid:image042.png@01DB996D.306CE710]

[cid:image043.png@01DB996D.306CE710]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408
11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408
11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408
11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Creating new connection object""                                      174520 227164 190408


From then on, the logs state:
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Trying to load action collection""                            1-SQL_PermissionsScan    174520 227164 190408
11/02/2025 13:31:22     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  1-SQL_PermissionsScan 174520              227164 190408

I have not ended the scan.

Thank you,
Alison.
From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 10, 2025 4:14 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Understood, I will put our ticket on hold and will be waiting for an update from your side. Let me know if I can be of assistance or if DBA team needs us to clarify any details. Thank you! Best regards, Artem Naskal Technical Support
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Understood, I will put our ticket on hold and will be waiting for an update from your side.
Let me know if I can be of assistance or if DBA team needs us to clarify any details.

Thank you!

Best regards,
Artem Naskal
Technical Support E","RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","smcmb@allstate.com","McMahon, Sean","alison.mills@allstate.com; techsupport@netwrix.com","aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com","","true","2025-03-20T07:54:09.000Z","true"
"02sQk00000Moh1uIAB","500Qk00000LUiPMIA1","2025-03-20T12:07:46.000Z","2025-03-20T12:07:46.000Z","Hi all, thank you for update, I am following up with development team, I will get back to you once I receive feedback from them either later today or tomorrow.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: McMahon, Sean [smcmb@allstate.com]
Sent: 3/20/2025 11:54 AM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,

 

Please see screenshots below.

 

Thanks,

Sean

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 20, 2025 7:24 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image001.png]

Login to A0185-APP2750-S open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image002.png]

Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).

Currently:

 

[Inline image name : image003.png]

 

Task stats:

[Inline image name : image004.png]

 

Messages:

[Inline image name : image005.png]

 

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.

[Inline image name : image006.png]

 

[Inline image name : image007.png]

 

[Inline image name : image008.png]

 

DB:

[Inline image name : image009.png]

2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

 

A0185-APP2750-S: attached to portal.

 

3. Are both servers in the same physical location? Yes.

[Inline image name : image010.png]

 

[Inline image name : image011.png]

 

[Inline image name : image012.png]

 

Prod DB:

[Inline image name : image013.png]

 

Dev DB:

[Inline image name : image014.png]

4. Can you run ping command using command line: 

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hey all,

As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi all,

I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.

In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

 

[Inline image name : image015.png]

 

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image016.jpg]

 

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image017.jpg]

 

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Thank you, Damir.

Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

 

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

 

Damir, would you please advise:

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

It may be more advantageous to meet so please advise a time when we can meet to discuss.

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com; rkuqk@allstate.com; kaaah@allstate.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.  

 

Thank you,

Alison.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi,

 

Could please provide update for the below. The Support team needs some assistance.

 

Thanks,

Kaviya.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hello All,

 

What are we waiting on from SQL side please?

I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

 

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

 

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

 

Regards

Ravi Kumar

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

	 
	
	
	You don't often get email from techsupport@netwrix.com. Learn why this is important 
	
	
	 
	

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi all,

Please see attached the scan details:

[Inline image name : image018.png]

 

 

Task stats:
[Inline image name : image019.png]

 

Messages:

[Inline image name : image020.png]

 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 

[Inline image name : image021.png]

 

[Inline image name : image022.png]

 

Here is the last excerpt from the job log:

 

[Inline image name : image023.png]

 

Please reply all on your response.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:
[Inline image name : image024.png]

 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 

[Inline image name : image025.png]

 

The last piece of SQL that was executed was:

[Inline image name : image026.png]

Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 

[Inline image name : image027.png]

 

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 

[Inline image name : image028.png]

 

From the Job Status Export the Messages Table, CSV is preferred: 

[Inline image name : image029.png] 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:
[Inline image name : image030.png]

 

[Inline image name : image031.png]
 

Messages shows:

[Inline image name : image032.png]

 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 

[Inline image name : image033.png]

 

[Inline image name : image034.png]

 

[Inline image name : image035.png]

 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[Inline image name : image036.png]

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:

On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.  Connection between each SQL server and Netwrix server might also become a bottleneck. Netwrix SQL database where data is eventually written could become a bottleneck as well. 

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied. 

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com; techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

I have added the log to the ticket on the portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.

Here are the servers which have completed:

 

Thank you,

Alison.

 

[Inline image name : image037.png]

 

 

[Inline image name : image038.png]

 

These are the servers to yet be scanned:

[Inline image name : image039.png]

[Inline image name : image040.png]

[Inline image name : image041.png]

[Inline image name : image042.png]

 

[Inline image name : image043.png]

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks. 

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it. 

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks? 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Log uploaded to portal.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Team,

Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLPro","RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","smcmb@allstate.com","alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com","damir.akhmatshin@netwrix.com","true","2025-03-20T12:07:46.000Z","true"
"02sQk00000MzDqHIAV","500Qk00000LUiPMIA1","2025-03-25T15:26:11.000Z","2025-03-25T17:07:58.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Per NOC team: I did checked logs at switch side interface whereas A0185-APP2750-S is connected and not seen any drops or incremental errors yet. Switch side looks clear. Santosh Lashkare.","Netwrix Support Ticket #434705 - SQL Permissions Performance is low","aem-stealthaudit-vm@allstate.com","Stealth Audit","techsupport@netwrix.com","","","false","2025-03-25T15:26:11.000Z","true"
"02sQk00000MzE4mIAF","500Qk00000LUiPMIA1","2025-03-25T15:26:18.000Z","2025-03-25T17:08:02.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Customer has requested update for the ticket 00434705","Netwrix Support Ticket #434705 - ref:_00D7091pB._500Q000LUiPM:ref - Customer is requesting update","aem-stealthaudit-vm@allstate.com","Stealth Audit","techsupport@netwrix.com","","","false","2025-03-25T15:26:17.000Z","true"
"02sQk00000N1FmEIAV","500Qk00000LUiPMIA1","2025-03-26T05:53:18.000Z","2025-03-26T05:53:18.000Z","Thank you for update Santosh, I am following up with R&D team and will get back to as soon as possible.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: McMahon, Sean [smcmb@allstate.com]
Sent: 3/20/2025 11:54 AM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,

 

Please see screenshots below.

 

Thanks,

Sean

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 20, 2025 7:24 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image001.png]

Login to A0185-APP2750-S open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image002.png]

Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).

Currently:

 

[Inline image name : image003.png]

 

Task stats:

[Inline image name : image004.png]

 

Messages:

[Inline image name : image005.png]

 

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.

[Inline image name : image006.png]

 

[Inline image name : image007.png]

 

[Inline image name : image008.png]

 

DB:

[Inline image name : image009.png]

2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

 

A0185-APP2750-S: attached to portal.

 

3. Are both servers in the same physical location? Yes.

[Inline image name : image010.png]

 

[Inline image name : image011.png]

 

[Inline image name : image012.png]

 

Prod DB:

[Inline image name : image013.png]

 

Dev DB:

[Inline image name : image014.png]

4. Can you run ping command using command line: 

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hey all,

As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi all,

I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.

In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

 

[Inline image name : image015.png]

 

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image016.jpg]

 

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image017.jpg]

 

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Thank you, Damir.

Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

 

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

 

Damir, would you please advise:

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

It may be more advantageous to meet so please advise a time when we can meet to discuss.

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com; rkuqk@allstate.com; kaaah@allstate.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.  

 

Thank you,

Alison.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi,

 

Could please provide update for the below. The Support team needs some assistance.

 

Thanks,

Kaviya.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hello All,

 

What are we waiting on from SQL side please?

I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

 

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

 

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

 

Regards

Ravi Kumar

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

	 
	
	
	You don't often get email from techsupport@netwrix.com. Learn why this is important 
	
	
	 
	

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi all,

Please see attached the scan details:

[Inline image name : image018.png]

 

 

Task stats:
[Inline image name : image019.png]

 

Messages:

[Inline image name : image020.png]

 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 

[Inline image name : image021.png]

 

[Inline image name : image022.png]

 

Here is the last excerpt from the job log:

 

[Inline image name : image023.png]

 

Please reply all on your response.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:
[Inline image name : image024.png]

 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 

[Inline image name : image025.png]

 

The last piece of SQL that was executed was:

[Inline image name : image026.png]

Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 

[Inline image name : image027.png]

 

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 

[Inline image name : image028.png]

 

From the Job Status Export the Messages Table, CSV is preferred: 

[Inline image name : image029.png] 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:
[Inline image name : image030.png]

 

[Inline image name : image031.png]
 

Messages shows:

[Inline image name : image032.png]

 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 

[Inline image name : image033.png]

 

[Inline image name : image034.png]

 

[Inline image name : image035.png]

 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[Inline image name : image036.png]

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:

On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.  Connection between each SQL server and Netwrix server might also become a bottleneck. Netwrix SQL database where data is eventually written could become a bottleneck as well. 

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied. 

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com; techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

I have added the log to the ticket on the portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.

Here are the servers which have completed:

 

Thank you,

Alison.

 

[Inline image name : image037.png]

 

 

[Inline image name : image038.png]

 

These are the servers to yet be scanned:

[Inline image name : image039.png]

[Inline image name : image040.png]

[Inline image name : image041.png]

[Inline image name : image042.png]

 

[Inline image name : image043.png]

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks. 

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it. 

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks? 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Log uploaded to portal.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Team,

Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLPro","RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","smcmb@allstate.com","alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com","","true","2025-03-26T05:53:17.000Z","true"
"02sQk00000N40YrIAJ","500Qk00000LUiPMIA1","2025-03-27T05:18:46.000Z","2025-03-27T05:18:46.000Z","Hi everyone, following up on this issue, we have identified issues with effective membership calculation that are causing these slowdowns and we are currently working to address them. I will keep monitoring for feedback from development team and will follow up with you once fix is available. I will provide next status update on Monday, if I will not receive news earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: McMahon, Sean [smcmb@allstate.com]
Sent: 3/20/2025 11:54 AM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,

 

Please see screenshots below.

 

Thanks,

Sean

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 20, 2025 7:24 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image001.png]

Login to A0185-APP2750-S open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image002.png]

Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).

Currently:

 

[Inline image name : image003.png]

 

Task stats:

[Inline image name : image004.png]

 

Messages:

[Inline image name : image005.png]

 

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.

[Inline image name : image006.png]

 

[Inline image name : image007.png]

 

[Inline image name : image008.png]

 

DB:

[Inline image name : image009.png]

2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

 

A0185-APP2750-S: attached to portal.

 

3. Are both servers in the same physical location? Yes.

[Inline image name : image010.png]

 

[Inline image name : image011.png]

 

[Inline image name : image012.png]

 

Prod DB:

[Inline image name : image013.png]

 

Dev DB:

[Inline image name : image014.png]

4. Can you run ping command using command line: 

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hey all,

As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi all,

I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.

In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

 

[Inline image name : image015.png]

 

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image016.jpg]

 

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image017.jpg]

 

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Thank you, Damir.

Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

 

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

 

Damir, would you please advise:

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

It may be more advantageous to meet so please advise a time when we can meet to discuss.

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com; rkuqk@allstate.com; kaaah@allstate.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.  

 

Thank you,

Alison.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi,

 

Could please provide update for the below. The Support team needs some assistance.

 

Thanks,

Kaviya.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hello All,

 

What are we waiting on from SQL side please?

I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

 

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

 

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

 

Regards

Ravi Kumar

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

	 
	
	
	You don't often get email from techsupport@netwrix.com. Learn why this is important 
	
	
	 
	

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi all,

Please see attached the scan details:

[Inline image name : image018.png]

 

 

Task stats:
[Inline image name : image019.png]

 

Messages:

[Inline image name : image020.png]

 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 

[Inline image name : image021.png]

 

[Inline image name : image022.png]

 

Here is the last excerpt from the job log:

 

[Inline image name : image023.png]

 

Please reply all on your response.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:
[Inline image name : image024.png]

 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 

[Inline image name : image025.png]

 

The last piece of SQL that was executed was:

[Inline image name : image026.png]

Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 

[Inline image name : image027.png]

 

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 

[Inline image name : image028.png]

 

From the Job Status Export the Messages Table, CSV is preferred: 

[Inline image name : image029.png] 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:
[Inline image name : image030.png]

 

[Inline image name : image031.png]
 

Messages shows:

[Inline image name : image032.png]

 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 

[Inline image name : image033.png]

 

[Inline image name : image034.png]

 

[Inline image name : image035.png]

 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[Inline image name : image036.png]

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:

On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.  Connection between each SQL server and Netwrix server might also become a bottleneck. Netwrix SQL database where data is eventually written could become a bottleneck as well. 

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied. 

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com; techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

I have added the log to the ticket on the portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.

Here are the servers which have completed:

 

Thank you,

Alison.

 

[Inline image name : image037.png]

 

 

[Inline image name : image038.png]

 

These are the servers to yet be scanned:

[Inline image name : image039.png]

[Inline image name : image040.png]

[Inline image name : image041.png]

[Inline image name : image042.png]

 

[Inline image name : image043.png]

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks. 

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it. 

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks? 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Log uploaded to portal.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Team,

Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLPro","RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","smcmb@allstate.com","alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com","","true","2025-03-27T05:18:45.000Z","true"
"02sQk00000NBz9UIAT","500Qk00000LUiPMIA1","2025-03-31T11:07:12.000Z","2025-03-31T11:07:12.000Z","Hi everyone, following up on this issue, the work on fix is still ongoing, I will keep monitoring and will provide next status update on Wednesday, unless I will get news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/27/2025 9:18 AM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, we have identified issues with effective membership calculation that are causing these slowdowns and we are currently working to address them. I will keep monitoring for feedback from development team and will follow up with you once fix is available. I will provide next status update on Monday, if I will not receive news earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: McMahon, Sean [smcmb@allstate.com]
Sent: 3/20/2025 11:54 AM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,

 

Please see screenshots below.

 

Thanks,

Sean

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 20, 2025 7:24 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image001.png]

Login to A0185-APP2750-S open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image002.png]

Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).

Currently:

 

[Inline image name : image003.png]

 

Task stats:

[Inline image name : image004.png]

 

Messages:

[Inline image name : image005.png]

 

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.

[Inline image name : image006.png]

 

[Inline image name : image007.png]

 

[Inline image name : image008.png]

 

DB:

[Inline image name : image009.png]

2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

 

A0185-APP2750-S: attached to portal.

 

3. Are both servers in the same physical location? Yes.

[Inline image name : image010.png]

 

[Inline image name : image011.png]

 

[Inline image name : image012.png]

 

Prod DB:

[Inline image name : image013.png]

 

Dev DB:

[Inline image name : image014.png]

4. Can you run ping command using command line: 

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hey all,

As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi all,

I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.

In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

 

[Inline image name : image015.png]

 

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image016.jpg]

 

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image017.jpg]

 

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Thank you, Damir.

Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

 

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

 

Damir, would you please advise:

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

It may be more advantageous to meet so please advise a time when we can meet to discuss.

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com; rkuqk@allstate.com; kaaah@allstate.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.  

 

Thank you,

Alison.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi,

 

Could please provide update for the below. The Support team needs some assistance.

 

Thanks,

Kaviya.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hello All,

 

What are we waiting on from SQL side please?

I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

 

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

 

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

 

Regards

Ravi Kumar

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

	 
	
	
	You don't often get email from techsupport@netwrix.com. Learn why this is important 
	
	
	 
	

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi all,

Please see attached the scan details:

[Inline image name : image018.png]

 

 

Task stats:
[Inline image name : image019.png]

 

Messages:

[Inline image name : image020.png]

 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 

[Inline image name : image021.png]

 

[Inline image name : image022.png]

 

Here is the last excerpt from the job log:

 

[Inline image name : image023.png]

 

Please reply all on your response.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:
[Inline image name : image024.png]

 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 

[Inline image name : image025.png]

 

The last piece of SQL that was executed was:

[Inline image name : image026.png]

Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 

[Inline image name : image027.png]

 

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 

[Inline image name : image028.png]

 

From the Job Status Export the Messages Table, CSV is preferred: 

[Inline image name : image029.png] 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:
[Inline image name : image030.png]

 

[Inline image name : image031.png]
 

Messages shows:

[Inline image name : image032.png]

 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 

[Inline image name : image033.png]

 

[Inline image name : image034.png]

 

[Inline image name : image035.png]

 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[Inline image name : image036.png]

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:

On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.  Connection between each SQL server and Netwrix server might also become a bottleneck. Netwrix SQL database where data is eventually written could become a bottleneck as well. 

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied. 

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com; techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

I have added the log to the ticket on the portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.

Here are the servers which have completed:

 

Thank you,

Alison.

 

[Inline image name : image037.png]

 

 

[Inline image name : image038.png]

 

These are the servers to yet be scanned:

[Inline image name : image039.png]

[Inline image name : image040.png]

[Inline image name : image041.png]

[Inline image name : image042.png]

 

[Inline image name : image043.png]

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks. 

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it. 

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks? 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Log uploaded to portal.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Team,

Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetProfileConnectionInterface       ""End""                                 174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile()      ""Start""                               174520 227164 190408

11/02/2025 13:31:16     INFO     SQLSERVER              TSPSQLProfileConnectionItf.ConnectProfile         ""Preparing ADO connection""                                    174520 227164 190408","RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","smcmb@allstate.com","alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com","","true","2025-03-31T11:07:12.000Z","true"
"02sQk00000NKGjNIAX","500Qk00000LUiPMIA1","2025-04-03T09:59:30.000Z","2025-04-03T09:59:30.000Z","Hi everyone, my apologies for delay, the fix is still in development, I will follow up with status update on Friday, unless I will have news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/31/2025 3:07 PM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, the work on fix is still ongoing, I will keep monitoring and will provide next status update on Wednesday, unless I will get news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/27/2025 9:18 AM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, we have identified issues with effective membership calculation that are causing these slowdowns and we are currently working to address them. I will keep monitoring for feedback from development team and will follow up with you once fix is available. I will provide next status update on Monday, if I will not receive news earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: McMahon, Sean [smcmb@allstate.com]
Sent: 3/20/2025 11:54 AM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,

 

Please see screenshots below.

 

Thanks,

Sean

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 20, 2025 7:24 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image001.png]

Login to A0185-APP2750-S open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image002.png]

Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).

Currently:

 

[Inline image name : image003.png]

 

Task stats:

[Inline image name : image004.png]

 

Messages:

[Inline image name : image005.png]

 

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.

[Inline image name : image006.png]

 

[Inline image name : image007.png]

 

[Inline image name : image008.png]

 

DB:

[Inline image name : image009.png]

2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

 

A0185-APP2750-S: attached to portal.

 

3. Are both servers in the same physical location? Yes.

[Inline image name : image010.png]

 

[Inline image name : image011.png]

 

[Inline image name : image012.png]

 

Prod DB:

[Inline image name : image013.png]

 

Dev DB:

[Inline image name : image014.png]

4. Can you run ping command using command line: 

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hey all,

As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi all,

I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.

In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

 

[Inline image name : image015.png]

 

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image016.jpg]

 

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image017.jpg]

 

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Thank you, Damir.

Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

 

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

 

Damir, would you please advise:

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

It may be more advantageous to meet so please advise a time when we can meet to discuss.

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com; rkuqk@allstate.com; kaaah@allstate.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.  

 

Thank you,

Alison.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi,

 

Could please provide update for the below. The Support team needs some assistance.

 

Thanks,

Kaviya.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hello All,

 

What are we waiting on from SQL side please?

I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

 

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

 

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

 

Regards

Ravi Kumar

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

	 
	
	
	You don't often get email from techsupport@netwrix.com. Learn why this is important 
	
	
	 
	

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi all,

Please see attached the scan details:

[Inline image name : image018.png]

 

 

Task stats:
[Inline image name : image019.png]

 

Messages:

[Inline image name : image020.png]

 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 

[Inline image name : image021.png]

 

[Inline image name : image022.png]

 

Here is the last excerpt from the job log:

 

[Inline image name : image023.png]

 

Please reply all on your response.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:
[Inline image name : image024.png]

 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 

[Inline image name : image025.png]

 

The last piece of SQL that was executed was:

[Inline image name : image026.png]

Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 

[Inline image name : image027.png]

 

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 

[Inline image name : image028.png]

 

From the Job Status Export the Messages Table, CSV is preferred: 

[Inline image name : image029.png] 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:
[Inline image name : image030.png]

 

[Inline image name : image031.png]
 

Messages shows:

[Inline image name : image032.png]

 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 

[Inline image name : image033.png]

 

[Inline image name : image034.png]

 

[Inline image name : image035.png]

 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[Inline image name : image036.png]

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:

On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.  Connection between each SQL server and Netwrix server might also become a bottleneck. Netwrix SQL database where data is eventually written could become a bottleneck as well. 

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied. 

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com; techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

I have added the log to the ticket on the portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.

Here are the servers which have completed:

 

Thank you,

Alison.

 

[Inline image name : image037.png]

 

 

[Inline image name : image038.png]

 

These are the servers to yet be scanned:

[Inline image name : image039.png]

[Inline image name : image040.png]

[Inline image name : image041.png]

[Inline image name : image042.png]

 

[Inline image name : image043.png]

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks. 

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it. 

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks? 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Log uploaded to portal.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Team,

Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT    TJob.EnumActionsTasks              ""Trying to load action collection""                          SQL_RoleMembers         174520 227164 190408

11/02/2025 13:31:15     DEBUG StealthAUDIT     TJob.EnumActionsTasks              ""Loading action file...""                  SQL_RoleMembers         174520              227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""Start""                               174520 227164 190408

11/02/2025 13:31:16     DEBUG SQLSERVER              TSPSQLServerRootItf.GetUniversalSQLItf              ""End""                                174520 227164 190408","RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","smcmb@allstate.com","alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com","","true","2025-04-03T09:59:30.000Z","true"
"02sQk00000NMsPWIA1","500Qk00000LUiPMIA1","2025-04-04T06:09:31.000Z","2025-04-04T06:09:31.000Z","Hi everyone, a hotfix to cover this issue is available for download:

https://releases.netwrix.com/products/auditor-enterprise/11.6/auditor-enterprise-hotfix-11.6.0.074.zip

Instructions:
1. Unblock the hotfix zip file in the windows property dialog, if an unblock button exists there.
2. Close all the instances of StealthAUDIT (Check task manager under process for all users)
3. Update all files in your %SAInstallDir% folder.

Please install it and let me know if issue persists.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/3/2025 1:59 PM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, my apologies for delay, the fix is still in development, I will follow up with status update on Friday, unless I will have news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/31/2025 3:07 PM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, the work on fix is still ongoing, I will keep monitoring and will provide next status update on Wednesday, unless I will get news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/27/2025 9:18 AM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, we have identified issues with effective membership calculation that are causing these slowdowns and we are currently working to address them. I will keep monitoring for feedback from development team and will follow up with you once fix is available. I will provide next status update on Monday, if I will not receive news earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: McMahon, Sean [smcmb@allstate.com]
Sent: 3/20/2025 11:54 AM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,

 

Please see screenshots below.

 

Thanks,

Sean

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 20, 2025 7:24 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image001.png]

Login to A0185-APP2750-S open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image002.png]

Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).

Currently:

 

[Inline image name : image003.png]

 

Task stats:

[Inline image name : image004.png]

 

Messages:

[Inline image name : image005.png]

 

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.

[Inline image name : image006.png]

 

[Inline image name : image007.png]

 

[Inline image name : image008.png]

 

DB:

[Inline image name : image009.png]

2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

 

A0185-APP2750-S: attached to portal.

 

3. Are both servers in the same physical location? Yes.

[Inline image name : image010.png]

 

[Inline image name : image011.png]

 

[Inline image name : image012.png]

 

Prod DB:

[Inline image name : image013.png]

 

Dev DB:

[Inline image name : image014.png]

4. Can you run ping command using command line: 

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hey all,

As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi all,

I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.

In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

 

[Inline image name : image015.png]

 

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image016.jpg]

 

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image017.jpg]

 

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Thank you, Damir.

Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

 

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

 

Damir, would you please advise:

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

It may be more advantageous to meet so please advise a time when we can meet to discuss.

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com; rkuqk@allstate.com; kaaah@allstate.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.  

 

Thank you,

Alison.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi,

 

Could please provide update for the below. The Support team needs some assistance.

 

Thanks,

Kaviya.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hello All,

 

What are we waiting on from SQL side please?

I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

 

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

 

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

 

Regards

Ravi Kumar

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

	 
	
	
	You don't often get email from techsupport@netwrix.com. Learn why this is important 
	
	
	 
	

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi all,

Please see attached the scan details:

[Inline image name : image018.png]

 

 

Task stats:
[Inline image name : image019.png]

 

Messages:

[Inline image name : image020.png]

 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 

[Inline image name : image021.png]

 

[Inline image name : image022.png]

 

Here is the last excerpt from the job log:

 

[Inline image name : image023.png]

 

Please reply all on your response.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:
[Inline image name : image024.png]

 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 

[Inline image name : image025.png]

 

The last piece of SQL that was executed was:

[Inline image name : image026.png]

Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 

[Inline image name : image027.png]

 

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 

[Inline image name : image028.png]

 

From the Job Status Export the Messages Table, CSV is preferred: 

[Inline image name : image029.png] 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:
[Inline image name : image030.png]

 

[Inline image name : image031.png]
 

Messages shows:

[Inline image name : image032.png]

 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 

[Inline image name : image033.png]

 

[Inline image name : image034.png]

 

[Inline image name : image035.png]

 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[Inline image name : image036.png]

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:

On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.  Connection between each SQL server and Netwrix server might also become a bottleneck. Netwrix SQL database where data is eventually written could become a bottleneck as well. 

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list. 
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases. 
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm
This will help decrease time to process each individual SQL server. 

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan. 
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with. 
Please note that each concurrent thread requires additional CPU and RAM resources. 

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied. 

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com; techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

I have added the log to the ticket on the portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.

Here are the servers which have completed:

 

Thank you,

Alison.

 

[Inline image name : image037.png]

 

 

[Inline image name : image038.png]

 

These are the servers to yet be scanned:

[Inline image name : image039.png]

[Inline image name : image040.png]

[Inline image name : image041.png]

[Inline image name : image042.png]

 

[Inline image name : image043.png]

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks. 

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it. 

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks? 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com
Cc: aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Log uploaded to portal.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Team,

Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408

05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408

06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408","RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","smcmb@allstate.com","alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com","","true","2025-04-04T06:09:31.000Z","true"
"02sQk00000NN6PGIA1","500Qk00000LUiPMIA1","2025-04-04T09:19:37.000Z","2025-04-04T09:19:37.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi Team,

We have followed the below steps , we will try scan again if issue persists , we will get back you , Thank you.



From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 4, 2025 11:40 AM
To: McMahon, Sean <smcmb@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, a hotfix to cover this issue is available for download:

https://releases.netwrix.com/products/auditor-enterprise/11.6/auditor-enterprise-hotfix-11.6.0.074.zip


Instructions:
1. Unblock the hotfix zip file in the windows property dialog, if an unblock button exists there.
2. Close all the instances of StealthAUDIT (Check task manager under process for all users)
3. Update all files in your %SAInstallDir% folder.

Please install it and let me know if issue persists.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/3/2025 1:59 PM
To: smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, my apologies for delay, the fix is still in development, I will follow up with status update on Friday, unless I will have news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/31/2025 3:07 PM
To: smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, the work on fix is still ongoing, I will keep monitoring and will provide next status update on Wednesday, unless I will get news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/27/2025 9:18 AM
To: smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, we have identified issues with effective membership calculation that are causing these slowdowns and we are currently working to address them. I will keep monitoring for feedback from development team and will follow up with you once fix is available. I will provide next status update on Monday, if I will not receive news earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: McMahon, Sean [smcmb@allstate.com]
Sent: 3/20/2025 11:54 AM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,

Please see screenshots below.

Thanks,
Sean

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 20, 2025 7:24 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run:

ping A0185-DBS0079-S

Take screenshot of output.
[cid:image001.png@01DBA570.81ABC600]


Login to A0185-APP2750-S open command line and run:

ping A0185-DBS0079-S

Take screenshot of output.
[cid:image002.png@01DBA570.81ABC600]


Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).
Currently:

[cid:image003.png@01DBA570.81ABC600]

Task stats:
[cid:image004.png@01DBA570.81ABC600]

Messages:
[cid:image005.png@01DBA570.81ABC600]

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.
[cid:image006.png@01DBA570.81ABC600]

[cid:image007.png@01DBA570.81ABC600]

[cid:image008.png@01DBA570.81ABC600]

DB:
[cid:image009.png@01DBA570.81ABC600]


2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

A0185-APP2750-S: attached to portal.

3. Are both servers in the same physical location? Yes.
[cid:image010.png@01DBA570.81ABC600]

[cid:image011.png@01DBA570.81ABC600]

[cid:image012.png@01DBA570.81ABC600]

Prod DB:
[cid:image013.png@01DBA570.81ABC600]

Dev DB:
[cid:image014.png@01DBA570.81ABC600]

4. Can you run ping command using command line:

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
Hey all,
As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi all,
I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.
In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

[cid:image015.png@01DBA570.81ABC600]

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image016.jpg@01DBA570.81ABC600]

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image017.jpg@01DBA570.81ABC600]


Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Thank you, Damir.
Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

Damir, would you please advise:
1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?
It may be more advantageous to meet so please advise a time when we can meet to discuss.
Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.

Thank you,
Alison.

From: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi,

Could please provide update for the below. The Support team needs some assistance.

Thanks,
Kaviya.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd
Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNR5HL5Hf$>


--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hello All,

What are we waiting on from SQL side please?
I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

Regards
Ravi Kumar

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


You don't often get email from techsupport@netwrix.com<mailto:techsupport@netwrix.com>. Learn why this is important<https://urldefense.com/v3/__https://aka.ms/LearnAboutSenderIdentification__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNWCe4t6-$>

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
Just as an FYI please reply to all.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; Damir Akhmatshin <damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
Please see attached the scan details:
[cid:image018.png@01DBA570.81ABC600]


Task stats:
[cid:image019.png@01DBA570.81ABC600]

Messages:
[cid:image020.png@01DBA570.81ABC600]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image021.png@01DBA570.81ABC600]

[cid:image022.png@01DBA570.81ABC600]

Here is the last excerpt from the job log:

[cid:image023.png@01DBA570.81ABC600]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image024.png@01DBA570.81ABC600]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image025.png@01DBA570.81ABC600]

The last piece of SQL that was executed was:
[cid:image026.png@01DBA570.81ABC600]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image027.png@01DBA570.81ABC600]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image030.png@01DBA570.81ABC600]

[cid:image031.png@01DBA570.81ABC600]

Messages shows:
[cid:image032.png@01DBA570.81ABC600]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image033.png@01DBA570.81ABC600]

[cid:image034.png@01DBA570.81ABC600]

[cid:image035.png@01DBA570.81ABC600]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image036.png@01DBA570.81ABC600]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image037.png@01DBA570.81ABC600]


[cid:image038.png@01DBA570.81ABC600]

These are the servers to yet be scanned:
[cid:image039.png@01DBA570.81ABC600]
[cid:image040.png@01DBA570.81ABC600]
[cid:image041.png@01DBA570.81ABC600]
[cid:image042.png@01DBA570.81ABC600]

[cid:image043.png@01DBA570.81ABC600]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408","RE: [EXTERNAL] RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","kaaah@allstate.com","., Kaviya","techsupport@netwrix.com; smcmb@allstate.com","aemstealthauditadmins@allstate.com; alison.mills@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com","","true","2025-04-04T09:19:04.000Z","true"
"02sQk00000NSEFhIAP","500Qk00000LUiPMIA1","2025-04-07T09:35:42.000Z","2025-04-07T09:35:42.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi Team , please send us the link to schedule a call to install hotfix to the folder , we have followed the steps still we have queries on that","Netwrix Support Ticket #434705 - SQL Permissions Performance is low","aem-stealthaudit-vm@allstate.com","Stealth Audit","techsupport@netwrix.com","","","false","2025-04-07T09:35:42.000Z","true"
"02sQk00000NSAX5IAP","500Qk00000LUiPMIA1","2025-04-07T09:40:06.000Z","2025-04-07T10:55:37.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi Team,

We have updated the request to schedule the call for the queries regarding this HOTFIX , please send us the link to schedule a call.

Thanks,
Kaviya.

From: ., Kaviya <kaaah@allstate.com>
Sent: 04 April 2025 02:49 PM
To: Netwrix Support <techsupport@netwrix.com>; McMahon, Sean <smcmb@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,

We have followed the below steps , we will try scan again if issue persists , we will get back you , Thank you.



From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Friday, April 4, 2025 11:40 AM
To: McMahon, Sean <smcmb@allstate.com<mailto:smcmb@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, a hotfix to cover this issue is available for download:

https://releases.netwrix.com/products/auditor-enterprise/11.6/auditor-enterprise-hotfix-11.6.0.074.zip


Instructions:
1. Unblock the hotfix zip file in the windows property dialog, if an unblock button exists there.
2. Close all the instances of StealthAUDIT (Check task manager under process for all users)
3. Update all files in your %SAInstallDir% folder.

Please install it and let me know if issue persists.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/3/2025 1:59 PM
To: smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, my apologies for delay, the fix is still in development, I will follow up with status update on Friday, unless I will have news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/31/2025 3:07 PM
To: smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, the work on fix is still ongoing, I will keep monitoring and will provide next status update on Wednesday, unless I will get news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/27/2025 9:18 AM
To: smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, we have identified issues with effective membership calculation that are causing these slowdowns and we are currently working to address them. I will keep monitoring for feedback from development team and will follow up with you once fix is available. I will provide next status update on Monday, if I will not receive news earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: McMahon, Sean [smcmb@allstate.com]
Sent: 3/20/2025 11:54 AM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,

Please see screenshots below.

Thanks,
Sean

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 20, 2025 7:24 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run:

ping A0185-DBS0079-S

Take screenshot of output.
[cid:image001.png@01DBA7CE.F7B35BF0]


Login to A0185-APP2750-S open command line and run:

ping A0185-DBS0079-S

Take screenshot of output.
[cid:image002.png@01DBA7CE.F7B35BF0]


Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).
Currently:

[cid:image003.png@01DBA7CE.F7B35BF0]

Task stats:
[cid:image004.png@01DBA7CE.F7B35BF0]

Messages:
[cid:image005.png@01DBA7CE.F7B35BF0]

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.
[cid:image006.png@01DBA7CE.F7B35BF0]

[cid:image007.png@01DBA7CE.F7B35BF0]

[cid:image008.png@01DBA7CE.F7B35BF0]

DB:
[cid:image009.png@01DBA7CE.F7B35BF0]


2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

A0185-APP2750-S: attached to portal.

3. Are both servers in the same physical location? Yes.
[cid:image010.png@01DBA7CE.F7B35BF0]

[cid:image011.png@01DBA7CE.F7B35BF0]

[cid:image012.png@01DBA7CE.F7B35BF0]

Prod DB:
[cid:image013.png@01DBA7CE.F7B35BF0]

Dev DB:
[cid:image014.png@01DBA7CE.F7B35BF0]

4. Can you run ping command using command line:

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
Hey all,
As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi all,
I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.
In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

[cid:image015.png@01DBA7CE.F7B35BF0]

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image016.jpg@01DBA7CE.F7B35BF0]

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image017.jpg@01DBA7CE.F7B35BF0]


Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Thank you, Damir.
Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

Damir, would you please advise:
1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?
It may be more advantageous to meet so please advise a time when we can meet to discuss.
Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.

Thank you,
Alison.

From: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi,

Could please provide update for the below. The Support team needs some assistance.

Thanks,
Kaviya.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd
Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNR5HL5Hf$>


--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hello All,

What are we waiting on from SQL side please?
I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

Regards
Ravi Kumar

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


You don't often get email from techsupport@netwrix.com<mailto:techsupport@netwrix.com>. Learn why this is important<https://urldefense.com/v3/__https://aka.ms/LearnAboutSenderIdentification__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNWCe4t6-$>

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
Just as an FYI please reply to all.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; Damir Akhmatshin <damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
Please see attached the scan details:
[cid:image018.png@01DBA7CE.F7B35BF0]


Task stats:
[cid:image019.png@01DBA7CE.F7B35BF0]

Messages:
[cid:image020.png@01DBA7CE.F7B35BF0]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image021.png@01DBA7CE.F7B35BF0]

[cid:image022.png@01DBA7CE.F7B35BF0]

Here is the last excerpt from the job log:

[cid:image023.png@01DBA7CE.F7B35BF0]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image024.png@01DBA7CE.F7B35BF0]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image025.png@01DBA7CE.F7B35BF0]

The last piece of SQL that was executed was:
[cid:image026.png@01DBA7CE.F7B35BF0]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image027.png@01DBA7CE.F7B35BF0]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image030.png@01DBA7CE.F7B35BF0]

[cid:image031.png@01DBA7CE.F7B35BF0]

Messages shows:
[cid:image032.png@01DBA7CE.F7B35BF0]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image033.png@01DBA7CE.F7B35BF0]

[cid:image034.png@01DBA7CE.F7B35BF0]

[cid:image035.png@01DBA7CE.F7B35BF0]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image036.png@01DBA7CE.F7B35BF0]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
  2.  If there are multiple target SQL servers to scan - then scan performance will also depend on the number of servers scanned at the same time. Number of SQL servers scanned simultaneously depends on the number of concurrent threads configured for the job. As such, performance depends on both - number of SQL servers to process as well as number of concurrent threads that process multiple SQL servers at once.
  3.  Connection between each SQL server and Netwrix server might also become a bottleneck.
  4.  Netwrix SQL database where data is eventually written could become a bottleneck as well.

As such, the key points that must be taken into consideration are the following:

1. It is important to check the list of databases that need to be scanned on each SQL server in the host list.
If you find databases that are not eligible for Permissions Scans or if permission scan is not needed for some databases because they are not actively used - then you can set up a filter to skip processing these databases.
Filter is configured in the Query settings for SQL Permissions scan data collector. Please, refer to this article for more details about this process:
SQL: Filter
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/SQL/Filter.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjraeT3hMw$>
This will help decrease time to process each individual SQL server.

2. To continue, in case you have multiple SQL servers in target Host List - then you can try increasing the number of concurrent threads on the Permission scan.
Currently you have a default of 10 Threads configured for the SQL Permissions scan. I would recommend increasing the number of concurrent threads to 15 to begin with.
Please note that each concurrent thread requires additional CPU and RAM resources.

Number of threads can be increased in ""Performance"" tab which is available in the job`s ""Properties"". Please, refer to this article for an example of this tab:
Performance Tab<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>
https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm<https://urldefense.com/v3/__https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/Jobs/Job/Properties/Performance.htm__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjq7_hrELw$>

3. It is important to check the NEA SQL database recovery mode as well. Depending on the recovery mode the database instance will be using transaction logs differently which can further reduce the scan performance due to lower performance of the SQL instance. The best practice is to leave Netwrix Enterprise Auditor`s SQL database in Simple recovery mode for the best performance and to facilitate database ""Cleanup"" feature which helps to conserve space occupied.

Please, let me know if you have any additional questions or if you notice issues - I will be happy to help.
Looking forward to hearing back from you.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/12/2025 7:34 PM
To: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

I have added the log to the ticket on the portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, February 12, 2025 3:27 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you for the clarification Artem, this is very helpful. Currently the scan is progressing slowly. I have attached a copy of the latest job log and have a meeting with a DBA today to see what is happening on the SQL server side.
Here are the servers which have completed:

Thank you,
Alison.

[cid:image037.png@01DBA7CE.F7B35BF0]


[cid:image038.png@01DBA7CE.F7B35BF0]

These are the servers to yet be scanned:
[cid:image039.png@01DBA7CE.F7B35BF0]
[cid:image040.png@01DBA7CE.F7B35BF0]
[cid:image041.png@01DBA7CE.F7B35BF0]
[cid:image042.png@01DBA7CE.F7B35BF0]

[cid:image043.png@01DBA7CE.F7B35BF0]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 12, 2025 2:30 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for getting back to me with an update.

The log file you shared is not a SQL Scan job log. This logfile - ""SADebug"", is a log file of the operations that Netwrix Enterprise Auditor web service performs with the SQL database as Jobs themselves. In other words, this log file represents what Netwrix Enterprise Auditor web service does in regard to its SQL database and the Job processes and tasks.

This message:
06/02/2025 06:31:42    ERROR    StealthAUDIT    TRemoteAuditServer.CompleteV1    ""GetOverlappedResult: The pipe has been ended""            233236    227164    190408
while been marked as an error is a debugging message. The SQL permission scan job is not supposed to be affected by it.

May I ask, what is the current status of SQL permission scan? Are you seeing exceptions or errors in the job messages/tasks?

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/11/2025 10:43 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Log uploaded to portal.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 11, 2025 6:41 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,
Just checking the logs for the SQL scan and I see the following:
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Terminating normally""               SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Abort requested, clearing queue""                             SQL_RoleMembers         182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Start""                               182036              227164 190408
05/02/2025 05:43:45     INFO     StealthAUDIT              TJobQueueThread.RunNextJob  ""Suspending""                                 182036 227164 190408
06/02/2025 06:31:42     ERROR  StealthAUDIT              TRemoteAuditServer.CompleteV1          ""GetOverlappedResult: The pipe has been ended""                                       233236 227164 190408","RE: [EXTERNAL] RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","kaaah@allstate.com","., Kaviya","techsupport@netwrix.com; smcmb@allstate.com","aemstealthauditadmins@allstate.com; alison.mills@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com","","true","2025-04-07T09:39:29.000Z","true"
"02sQk00000NSJ7LIAX","500Qk00000LUiPMIA1","2025-04-07T10:57:31.000Z","2025-04-07T10:57:31.000Z","Hi Kaviya, please use this link to book a meeting:

https://nwxcorp.my.salesforce-sites.com/cts?Id=BQkpAwAGgOsP2QjI2LvTO7LgCmZyg4NBv5KHEDv5dU8-Z&MeetingID=7V7imxt6ZYoAYASCc0i9Vqk_p_Prt53A4ab_BnZxIvY-Z

Are there any questions that you can ask prior to meeting so I can clarify the answer for you before meeting?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: ., Kaviya [kaaah@allstate.com]
Sent: 4/7/2025 1:39 PM
To: techsupport@netwrix.com; smcmb@allstate.com
Cc: aemstealthauditadmins@allstate.com; alison.mills@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Team,

 

We have updated the request to schedule the call for the queries regarding this HOTFIX , please send us the link to schedule a call.

 

Thanks,

Kaviya.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: 04 April 2025 02:49 PM
To: Netwrix Support <techsupport@netwrix.com>; McMahon, Sean <smcmb@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Team,

 

We have followed the below steps , we will try scan again if issue persists , we will get back you , Thank you.

 

 

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 4, 2025 11:40 AM
To: McMahon, Sean <smcmb@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi everyone, a hotfix to cover this issue is available for download:

https://releases.netwrix.com/products/auditor-enterprise/11.6/auditor-enterprise-hotfix-11.6.0.074.zip

Instructions:
1. Unblock the hotfix zip file in the windows property dialog, if an unblock button exists there.
2. Close all the instances of StealthAUDIT (Check task manager under process for all users)
3. Update all files in your %SAInstallDir% folder.

Please install it and let me know if issue persists.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/3/2025 1:59 PM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, my apologies for delay, the fix is still in development, I will follow up with status update on Friday, unless I will have news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/31/2025 3:07 PM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, the work on fix is still ongoing, I will keep monitoring and will provide next status update on Wednesday, unless I will get news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/27/2025 9:18 AM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, we have identified issues with effective membership calculation that are causing these slowdowns and we are currently working to address them. I will keep monitoring for feedback from development team and will follow up with you once fix is available. I will provide next status update on Monday, if I will not receive news earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: McMahon, Sean [smcmb@allstate.com]
Sent: 3/20/2025 11:54 AM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Damir,

 

Please see screenshots below.

 

Thanks,

Sean

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 20, 2025 7:24 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image001.png]

Login to A0185-APP2750-S open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image002.png]

Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).

Currently:

 

[Inline image name : image003.png]

 

Task stats:

[Inline image name : image004.png]

 

Messages:

[Inline image name : image005.png]

 

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.

[Inline image name : image006.png]

 

[Inline image name : image007.png]

 

[Inline image name : image008.png]

 

DB:

[Inline image name : image009.png]

2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

 

A0185-APP2750-S: attached to portal.

 

3. Are both servers in the same physical location? Yes.

[Inline image name : image010.png]

 

[Inline image name : image011.png]

 

[Inline image name : image012.png]

 

Prod DB:

[Inline image name : image013.png]

 

Dev DB:

[Inline image name : image014.png]

4. Can you run ping command using command line: 

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hey all,

As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi all,

I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.

In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

 

[Inline image name : image015.png]

 

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image016.jpg]

 

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image017.jpg]

 

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Thank you, Damir.

Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

 

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

 

Damir, would you please advise:

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

It may be more advantageous to meet so please advise a time when we can meet to discuss.

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com; rkuqk@allstate.com; kaaah@allstate.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.  

 

Thank you,

Alison.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi,

 

Could please provide update for the below. The Support team needs some assistance.

 

Thanks,

Kaviya.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hello All,

 

What are we waiting on from SQL side please?

I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

 

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

 

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

 

Regards

Ravi Kumar

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

	 
	
	
	You don't often get email from techsupport@netwrix.com. Learn why this is important 
	
	
	 
	

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi all,

Please see attached the scan details:

[Inline image name : image018.png]

 

 

Task stats:
[Inline image name : image019.png]

 

Messages:

[Inline image name : image020.png]

 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 

[Inline image name : image021.png]

 

[Inline image name : image022.png]

 

Here is the last excerpt from the job log:

 

[Inline image name : image023.png]

 

Please reply all on your response.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:
[Inline image name : image024.png]

 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 

[Inline image name : image025.png]

 

The last piece of SQL that was executed was:

[Inline image name : image026.png]

Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 

[Inline image name : image027.png]

 

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 

[Inline image name : image028.png]

 

From the Job Status Export the Messages Table, CSV is preferred: 

[Inline image name : image029.png] 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:
[Inline image name : image030.png]

 

[Inline image name : image031.png]
 

Messages shows:

[Inline image name : image032.png]

 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 

[Inline image name : image033.png]

 

[Inline image name : image034.png]

 

[Inline image name : image035.png]

 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[Inline image name : image036.png]

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:

On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.","RE: [EXTERNAL] RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","kaaah@allstate.com","alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; rkuqk@allstate.com; smcmb@allstate.com","","true","2025-04-07T10:57:31.000Z","true"
"02sQk00000NVJ1CIAX","500Qk00000LUiPMIA1","2025-04-08T11:43:43.000Z","2025-04-08T11:43:43.000Z","Hi Kaviya, thank you for your time on meeting, I've took a backup of existing files and applied hotfix provided by our team, I've also queued the SQL Permissions scan to check if scan times are improved. Please let me know if the issue persists after job finishes.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: ., Kaviya [kaaah@allstate.com]
Sent: 4/7/2025 1:39 PM
To: techsupport@netwrix.com; smcmb@allstate.com
Cc: aemstealthauditadmins@allstate.com; alison.mills@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Team,

 

We have updated the request to schedule the call for the queries regarding this HOTFIX , please send us the link to schedule a call.

 

Thanks,

Kaviya.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: 04 April 2025 02:49 PM
To: Netwrix Support <techsupport@netwrix.com>; McMahon, Sean <smcmb@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Team,

 

We have followed the below steps , we will try scan again if issue persists , we will get back you , Thank you.

 

 

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 4, 2025 11:40 AM
To: McMahon, Sean <smcmb@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi everyone, a hotfix to cover this issue is available for download:

https://releases.netwrix.com/products/auditor-enterprise/11.6/auditor-enterprise-hotfix-11.6.0.074.zip

Instructions:
1. Unblock the hotfix zip file in the windows property dialog, if an unblock button exists there.
2. Close all the instances of StealthAUDIT (Check task manager under process for all users)
3. Update all files in your %SAInstallDir% folder.

Please install it and let me know if issue persists.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/3/2025 1:59 PM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, my apologies for delay, the fix is still in development, I will follow up with status update on Friday, unless I will have news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/31/2025 3:07 PM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, the work on fix is still ongoing, I will keep monitoring and will provide next status update on Wednesday, unless I will get news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/27/2025 9:18 AM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, we have identified issues with effective membership calculation that are causing these slowdowns and we are currently working to address them. I will keep monitoring for feedback from development team and will follow up with you once fix is available. I will provide next status update on Monday, if I will not receive news earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: McMahon, Sean [smcmb@allstate.com]
Sent: 3/20/2025 11:54 AM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Damir,

 

Please see screenshots below.

 

Thanks,

Sean

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 20, 2025 7:24 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image001.png]

Login to A0185-APP2750-S open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image002.png]

Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).

Currently:

 

[Inline image name : image003.png]

 

Task stats:

[Inline image name : image004.png]

 

Messages:

[Inline image name : image005.png]

 

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.

[Inline image name : image006.png]

 

[Inline image name : image007.png]

 

[Inline image name : image008.png]

 

DB:

[Inline image name : image009.png]

2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

 

A0185-APP2750-S: attached to portal.

 

3. Are both servers in the same physical location? Yes.

[Inline image name : image010.png]

 

[Inline image name : image011.png]

 

[Inline image name : image012.png]

 

Prod DB:

[Inline image name : image013.png]

 

Dev DB:

[Inline image name : image014.png]

4. Can you run ping command using command line: 

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hey all,

As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi all,

I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.

In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

 

[Inline image name : image015.png]

 

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image016.jpg]

 

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image017.jpg]

 

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Thank you, Damir.

Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

 

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

 

Damir, would you please advise:

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

It may be more advantageous to meet so please advise a time when we can meet to discuss.

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com; rkuqk@allstate.com; kaaah@allstate.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.  

 

Thank you,

Alison.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi,

 

Could please provide update for the below. The Support team needs some assistance.

 

Thanks,

Kaviya.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hello All,

 

What are we waiting on from SQL side please?

I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

 

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

 

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

 

Regards

Ravi Kumar

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

	 
	
	
	You don't often get email from techsupport@netwrix.com. Learn why this is important 
	
	
	 
	

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi all,

Please see attached the scan details:

[Inline image name : image018.png]

 

 

Task stats:
[Inline image name : image019.png]

 

Messages:

[Inline image name : image020.png]

 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 

[Inline image name : image021.png]

 

[Inline image name : image022.png]

 

Here is the last excerpt from the job log:

 

[Inline image name : image023.png]

 

Please reply all on your response.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:
[Inline image name : image024.png]

 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 

[Inline image name : image025.png]

 

The last piece of SQL that was executed was:

[Inline image name : image026.png]

Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 

[Inline image name : image027.png]

 

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 

[Inline image name : image028.png]

 

From the Job Status Export the Messages Table, CSV is preferred: 

[Inline image name : image029.png] 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:
[Inline image name : image030.png]

 

[Inline image name : image031.png]
 

Messages shows:

[Inline image name : image032.png]

 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 

[Inline image name : image033.png]

 

[Inline image name : image034.png]

 

[Inline image name : image035.png]

 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[Inline image name : image036.png]

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We’re here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hi Alison, 

Thank you for sharing the log file. According to the log file entries the scan is running without errors. 

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present. 

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database. 

As such, there might be several places where scan could experience a bottleneck.
For example:

On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.","RE: [EXTERNAL] RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","kaaah@allstate.com","alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; rkuqk@allstate.com; smcmb@allstate.com","","true","2025-04-08T11:43:43.000Z","true"
"02sQk00000NVUnrIAH","500Qk00000LUiPMIA1","2025-04-08T13:16:49.000Z","2025-04-08T13:16:49.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi Team,

The job Ran successfully with one warning as mentioned below , it almost took 1hr 23min:

[cid:image037.png@01DBA8B6.66224DC0]

From: Netwrix Support <techsupport@netwrix.com>
Sent: 08 April 2025 05:14 PM
To: ., Kaviya <kaaah@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>; McMahon, Sean <smcmb@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Kaviya, thank you for your time on meeting, I've took a backup of existing files and applied hotfix provided by our team, I've also queued the SQL Permissions scan to check if scan times are improved. Please let me know if the issue persists after job finishes.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: ., Kaviya [kaaah@allstate.com]
Sent: 4/7/2025 1:39 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Team,

We have updated the request to schedule the call for the queries regarding this HOTFIX , please send us the link to schedule a call.

Thanks,
Kaviya.

From: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Sent: 04 April 2025 02:49 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; McMahon, Sean <smcmb@allstate.com<mailto:smcmb@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,

We have followed the below steps , we will try scan again if issue persists , we will get back you , Thank you.



From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Friday, April 4, 2025 11:40 AM
To: McMahon, Sean <smcmb@allstate.com<mailto:smcmb@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, a hotfix to cover this issue is available for download:

https://releases.netwrix.com/products/auditor-enterprise/11.6/auditor-enterprise-hotfix-11.6.0.074.zip


Instructions:
1. Unblock the hotfix zip file in the windows property dialog, if an unblock button exists there.
2. Close all the instances of StealthAUDIT (Check task manager under process for all users)
3. Update all files in your %SAInstallDir% folder.

Please install it and let me know if issue persists.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/3/2025 1:59 PM
To: smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, my apologies for delay, the fix is still in development, I will follow up with status update on Friday, unless I will have news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/31/2025 3:07 PM
To: smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, the work on fix is still ongoing, I will keep monitoring and will provide next status update on Wednesday, unless I will get news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/27/2025 9:18 AM
To: smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, we have identified issues with effective membership calculation that are causing these slowdowns and we are currently working to address them. I will keep monitoring for feedback from development team and will follow up with you once fix is available. I will provide next status update on Monday, if I will not receive news earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: McMahon, Sean [smcmb@allstate.com]
Sent: 3/20/2025 11:54 AM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,

Please see screenshots below.

Thanks,
Sean

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 20, 2025 7:24 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run:

ping A0185-DBS0079-S

Take screenshot of output.
[cid:image001.png@01DBA8B6.2505C150]


Login to A0185-APP2750-S open command line and run:

ping A0185-DBS0079-S

Take screenshot of output.
[cid:image002.png@01DBA8B6.2505C150]


Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).
Currently:

[cid:image003.png@01DBA8B6.2505C150]

Task stats:
[cid:image004.png@01DBA8B6.2505C150]

Messages:
[cid:image005.png@01DBA8B6.2505C150]

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.
[cid:image006.png@01DBA8B6.2505C150]

[cid:image007.png@01DBA8B6.2505C150]

[cid:image008.png@01DBA8B6.2505C150]

DB:
[cid:image009.png@01DBA8B6.2505C150]


2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

A0185-APP2750-S: attached to portal.

3. Are both servers in the same physical location? Yes.
[cid:image010.png@01DBA8B6.2505C150]

[cid:image011.png@01DBA8B6.2505C150]

[cid:image012.png@01DBA8B6.2505C150]

Prod DB:
[cid:image013.png@01DBA8B6.2505C150]

Dev DB:
[cid:image014.png@01DBA8B6.2505C150]

4. Can you run ping command using command line:

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
Hey all,
As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi all,
I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.
In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

[cid:image015.png@01DBA8B6.2505C150]

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image016.jpg@01DBA8B6.2505C150]

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image017.jpg@01DBA8B6.2505C150]


Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Thank you, Damir.
Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

Damir, would you please advise:
1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?
It may be more advantageous to meet so please advise a time when we can meet to discuss.
Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.

Thank you,
Alison.

From: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi,

Could please provide update for the below. The Support team needs some assistance.

Thanks,
Kaviya.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd
Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNR5HL5Hf$>


--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hello All,

What are we waiting on from SQL side please?
I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

Regards
Ravi Kumar

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


You don't often get email from techsupport@netwrix.com<mailto:techsupport@netwrix.com>. Learn why this is important<https://urldefense.com/v3/__https://aka.ms/LearnAboutSenderIdentification__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNWCe4t6-$>

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
Just as an FYI please reply to all.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; Damir Akhmatshin <damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
Please see attached the scan details:
[cid:image018.png@01DBA8B6.2505C150]


Task stats:
[cid:image019.png@01DBA8B6.2505C150]

Messages:
[cid:image020.png@01DBA8B6.2505C150]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image021.png@01DBA8B6.2505C150]

[cid:image022.png@01DBA8B6.2505C150]

Here is the last excerpt from the job log:

[cid:image023.png@01DBA8B6.2505C150]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image024.png@01DBA8B6.2505C150]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image025.png@01DBA8B6.2505C150]

The last piece of SQL that was executed was:
[cid:image026.png@01DBA8B6.2505C150]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image027.png@01DBA8B6.2505C150]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image030.png@01DBA8B6.2505C150]

[cid:image031.png@01DBA8B6.2505C150]

Messages shows:
[cid:image032.png@01DBA8B6.2505C150]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image033.png@01DBA8B6.2505C150]

[cid:image034.png@01DBA8B6.2505C150]

[cid:image035.png@01DBA8B6.2505C150]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image036.png@01DBA8B6.2505C150]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this email with any updates or questions. We're here to help you get the most out of your Netwrix products.

Ticket Number: 00434705
Ticket Subject: SQL Permissions Performance is low.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/13/2025 5:05 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hi Alison,

Thank you for sharing the log file. According to the log file entries the scan is running without errors.

Just for your information I would like to emphasize these key points which are crucial for SQL Permission Scan performance improvement:

First of all, you need to gauge what`s the expected time to complete SQL Permissions scan based on previous job runs. At least a couple of Full SQL Permissions scan runs must be present.

Then, to understand how to improve the SQL Permissions scan we need to understand how it works:
The Data Collector for the SQL Permissions scan consists of a SQL script. This SQL script is executed on each individual SQL server host added to the Host List of the SQL Permissions scan.
After SQL Script is executed on the SQL server the resulted data is then transported back to Enterprise Auditor server and finally gets written into Netwrix Database.

As such, there might be several places where scan could experience a bottleneck.
For example:

  1.  On each individual SQL server script might take different amounts of time to complete. It depends on the number of databases that need to be scanned on each SQL server.
[https://nwxcorp.my.salesforce.com/servlet/servlet.ImageServer?oid=00D7000000091pB&esid=018Qk00000Kzoly&from=ext]","RE: [EXTERNAL] RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","kaaah@allstate.com","., Kaviya","techsupport@netwrix.com","aemstealthauditadmins@allstate.com; alison.mills@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com; smcmb@allstate.com","","true","2025-04-08T13:16:04.000Z","true"
"02sQk00000NXaKTIA1","500Qk00000LUiPMIA1","2025-04-09T05:47:48.000Z","2025-04-09T05:47:48.000Z","Hi Kaviya, great news, thank you! Is it ok for us to close this ticket?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: ., Kaviya [kaaah@allstate.com]
Sent: 4/8/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; alison.mills@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com; smcmb@allstate.com
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Team,

 

The job Ran successfully with one warning as mentioned below , it almost took 1hr 23min:

 

[Inline image name : image037.png]

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: 08 April 2025 05:14 PM
To: ., Kaviya <kaaah@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>; McMahon, Sean <smcmb@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Kaviya, thank you for your time on meeting, I've took a backup of existing files and applied hotfix provided by our team, I've also queued the SQL Permissions scan to check if scan times are improved. Please let me know if the issue persists after job finishes.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: ., Kaviya [kaaah@allstate.com]
Sent: 4/7/2025 1:39 PM
To: techsupport@netwrix.com; smcmb@allstate.com
Cc: aemstealthauditadmins@allstate.com; alison.mills@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Team,

 

We have updated the request to schedule the call for the queries regarding this HOTFIX , please send us the link to schedule a call.

 

Thanks,

Kaviya.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: 04 April 2025 02:49 PM
To: Netwrix Support <techsupport@netwrix.com>; McMahon, Sean <smcmb@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Team,

 

We have followed the below steps , we will try scan again if issue persists , we will get back you , Thank you.

 

 

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 4, 2025 11:40 AM
To: McMahon, Sean <smcmb@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi everyone, a hotfix to cover this issue is available for download:

https://releases.netwrix.com/products/auditor-enterprise/11.6/auditor-enterprise-hotfix-11.6.0.074.zip

Instructions:
1. Unblock the hotfix zip file in the windows property dialog, if an unblock button exists there.
2. Close all the instances of StealthAUDIT (Check task manager under process for all users)
3. Update all files in your %SAInstallDir% folder.

Please install it and let me know if issue persists.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/3/2025 1:59 PM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, my apologies for delay, the fix is still in development, I will follow up with status update on Friday, unless I will have news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/31/2025 3:07 PM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, the work on fix is still ongoing, I will keep monitoring and will provide next status update on Wednesday, unless I will get news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/27/2025 9:18 AM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, we have identified issues with effective membership calculation that are causing these slowdowns and we are currently working to address them. I will keep monitoring for feedback from development team and will follow up with you once fix is available. I will provide next status update on Monday, if I will not receive news earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: McMahon, Sean [smcmb@allstate.com]
Sent: 3/20/2025 11:54 AM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Damir,

 

Please see screenshots below.

 

Thanks,

Sean

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 20, 2025 7:24 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image001.png]

Login to A0185-APP2750-S open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image002.png]

Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).

Currently:

 

[Inline image name : image003.png]

 

Task stats:

[Inline image name : image004.png]

 

Messages:

[Inline image name : image005.png]

 

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.

[Inline image name : image006.png]

 

[Inline image name : image007.png]

 

[Inline image name : image008.png]

 

DB:

[Inline image name : image009.png]

2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

 

A0185-APP2750-S: attached to portal.

 

3. Are both servers in the same physical location? Yes.

[Inline image name : image010.png]

 

[Inline image name : image011.png]

 

[Inline image name : image012.png]

 

Prod DB:

[Inline image name : image013.png]

 

Dev DB:

[Inline image name : image014.png]

4. Can you run ping command using command line: 

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hey all,

As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi all,

I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.

In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

 

[Inline image name : image015.png]

 

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image016.jpg]

 

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image017.jpg]

 

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Thank you, Damir.

Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

 

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

 

Damir, would you please advise:

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

It may be more advantageous to meet so please advise a time when we can meet to discuss.

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com; rkuqk@allstate.com; kaaah@allstate.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.  

 

Thank you,

Alison.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi,

 

Could please provide update for the below. The Support team needs some assistance.

 

Thanks,

Kaviya.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hello All,

 

What are we waiting on from SQL side please?

I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

 

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

 

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

 

Regards

Ravi Kumar

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

	 
	
	
	You don't often get email from techsupport@netwrix.com. Learn why this is important 
	
	
	 
	

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi all,

Please see attached the scan details:

[Inline image name : image018.png]

 

 

Task stats:
[Inline image name : image019.png]

 

Messages:

[Inline image name : image020.png]

 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 

[Inline image name : image021.png]

 

[Inline image name : image022.png]

 

Here is the last excerpt from the job log:

 

[Inline image name : image023.png]

 

Please reply all on your response.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:
[Inline image name : image024.png]

 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 

[Inline image name : image025.png]

 

The last piece of SQL that was executed was:

[Inline image name : image026.png]

Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 

[Inline image name : image027.png]

 

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 

[Inline image name : image028.png]

 

From the Job Status Export the Messages Table, CSV is preferred: 

[Inline image name : image029.png] 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:
[Inline image name : image030.png]

 

[Inline image name : image031.png]
 

Messages shows:

[Inline image name : image032.png]

 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 

[Inline image name : image033.png]

 

[Inline image name : image034.png]

 

[Inline image name : image035.png]

 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[Inline image name : image036.png]

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Yes we are still having issues with the SQL scans.

Please let us know when you are available to discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven’t heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you’re still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this emai","RE: [EXTERNAL] RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","kaaah@allstate.com","alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; rkuqk@allstate.com; smcmb@allstate.com","","true","2025-04-09T05:47:48.000Z","true"
"02sQk00000NXpheIAD","500Qk00000LUiPMIA1","2025-04-09T08:11:20.000Z","2025-04-09T13:00:15.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi Team,

Please put the request on hold I will test the q1 scan and reply back to you since we have tested only one database. Once the scan run as usual, we can resolve the request. Thanks for your patience .

From: Netwrix Support <techsupport@netwrix.com>
Sent: 09 April 2025 11:18 AM
To: ., Kaviya <kaaah@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>; McMahon, Sean <smcmb@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Kaviya, great news, thank you! Is it ok for us to close this ticket?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: ., Kaviya [kaaah@allstate.com]
Sent: 4/8/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; smcmb@allstate.com<mailto:smcmb@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Team,

The job Ran successfully with one warning as mentioned below , it almost took 1hr 23min:

[cid:image001.png@01DBA954.D7251400]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: 08 April 2025 05:14 PM
To: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; McMahon, Sean <smcmb@allstate.com<mailto:smcmb@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Kaviya, thank you for your time on meeting, I've took a backup of existing files and applied hotfix provided by our team, I've also queued the SQL Permissions scan to check if scan times are improved. Please let me know if the issue persists after job finishes.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: ., Kaviya [kaaah@allstate.com]
Sent: 4/7/2025 1:39 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Team,

We have updated the request to schedule the call for the queries regarding this HOTFIX , please send us the link to schedule a call.

Thanks,
Kaviya.

From: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Sent: 04 April 2025 02:49 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; McMahon, Sean <smcmb@allstate.com<mailto:smcmb@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,

We have followed the below steps , we will try scan again if issue persists , we will get back you , Thank you.



From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Friday, April 4, 2025 11:40 AM
To: McMahon, Sean <smcmb@allstate.com<mailto:smcmb@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, a hotfix to cover this issue is available for download:

https://releases.netwrix.com/products/auditor-enterprise/11.6/auditor-enterprise-hotfix-11.6.0.074.zip


Instructions:
1. Unblock the hotfix zip file in the windows property dialog, if an unblock button exists there.
2. Close all the instances of StealthAUDIT (Check task manager under process for all users)
3. Update all files in your %SAInstallDir% folder.

Please install it and let me know if issue persists.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/3/2025 1:59 PM
To: smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, my apologies for delay, the fix is still in development, I will follow up with status update on Friday, unless I will have news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/31/2025 3:07 PM
To: smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, the work on fix is still ongoing, I will keep monitoring and will provide next status update on Wednesday, unless I will get news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/27/2025 9:18 AM
To: smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, we have identified issues with effective membership calculation that are causing these slowdowns and we are currently working to address them. I will keep monitoring for feedback from development team and will follow up with you once fix is available. I will provide next status update on Monday, if I will not receive news earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: McMahon, Sean [smcmb@allstate.com]
Sent: 3/20/2025 11:54 AM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,

Please see screenshots below.

Thanks,
Sean

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 20, 2025 7:24 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run:

ping A0185-DBS0079-S

Take screenshot of output.
[cid:image002.png@01DBA954.D7251400]


Login to A0185-APP2750-S open command line and run:

ping A0185-DBS0079-S

Take screenshot of output.
[cid:image003.png@01DBA954.D7251400]


Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).
Currently:

[cid:image004.png@01DBA954.D7251400]

Task stats:
[cid:image005.png@01DBA954.D7251400]

Messages:
[cid:image006.png@01DBA954.D7251400]

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.
[cid:image007.png@01DBA954.D7251400]

[cid:image008.png@01DBA954.D7251400]

[cid:image009.png@01DBA954.D7251400]

DB:
[cid:image010.png@01DBA954.D7251400]


2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

A0185-APP2750-S: attached to portal.

3. Are both servers in the same physical location? Yes.
[cid:image011.png@01DBA954.D7251400]

[cid:image012.png@01DBA954.D7251400]

[cid:image013.png@01DBA954.D7251400]

Prod DB:
[cid:image014.png@01DBA954.D7251400]

Dev DB:
[cid:image015.png@01DBA954.D7251400]

4. Can you run ping command using command line:

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
Hey all,
As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi all,
I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.
In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

[cid:image016.png@01DBA954.D7251400]

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image017.jpg@01DBA954.D7251400]

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image018.jpg@01DBA954.D7251400]


Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Thank you, Damir.
Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

Damir, would you please advise:
1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?
It may be more advantageous to meet so please advise a time when we can meet to discuss.
Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.

Thank you,
Alison.

From: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi,

Could please provide update for the below. The Support team needs some assistance.

Thanks,
Kaviya.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd
Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNR5HL5Hf$>


--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hello All,

What are we waiting on from SQL side please?
I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

Regards
Ravi Kumar

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


You don't often get email from techsupport@netwrix.com<mailto:techsupport@netwrix.com>. Learn why this is important<https://urldefense.com/v3/__https://aka.ms/LearnAboutSenderIdentification__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNWCe4t6-$>

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
Just as an FYI please reply to all.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; Damir Akhmatshin <damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
Please see attached the scan details:
[cid:image019.png@01DBA954.D7251400]


Task stats:
[cid:image020.png@01DBA954.D7251400]

Messages:
[cid:image021.png@01DBA954.D7251400]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image022.png@01DBA954.D7251400]

[cid:image023.png@01DBA954.D7251400]

Here is the last excerpt from the job log:

[cid:image024.png@01DBA954.D7251400]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image025.png@01DBA954.D7251400]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image026.png@01DBA954.D7251400]

The last piece of SQL that was executed was:
[cid:image027.png@01DBA954.D7251400]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image028.png@01DBA954.D7251400]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image031.png@01DBA954.D7251400]

[cid:image032.png@01DBA954.D7251400]

Messages shows:
[cid:image033.png@01DBA954.D7251400]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image034.png@01DBA954.D7251400]

[cid:image035.png@01DBA954.D7251400]

[cid:image036.png@01DBA954.D7251400]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image037.png@01DBA954.D7251400]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/18/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Yes we are still having issues with the SQL scans.
Please let us know when you are available to discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, February 18, 2025 12:49 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hello Alison,

I wanted to check in regarding your support ticket 00434705 - SQL Permissions Performance is low.
We haven't heard from you in a while, and I just wanted to see if you still need assistance with this issue.

If you're still experiencing problems or have any updates to share, please let me know.
If the issue has been resolved, I can go ahead and close the ticket on my end.

Please feel free to reply to this emai
[https://nwxcorp.my.salesforce.com/servlet/servlet.ImageServer?oid=00D7000000091pB&esid=018Qk00000L22wF&from=ext]","RE: [EXTERNAL] RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","kaaah@allstate.com","., Kaviya","techsupport@netwrix.com","aemstealthauditadmins@allstate.com; alison.mills@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com; smcmb@allstate.com","","true","2025-04-09T08:10:45.000Z","true"
"02sQk00000NYB5WIAX","500Qk00000LUiPMIA1","2025-04-09T13:01:25.000Z","2025-04-09T13:01:25.000Z","Hi Kaviya, definitely! I will keep this ticket postponed until Friday and will follow up on closure.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: ., Kaviya [kaaah@allstate.com]
Sent: 4/9/2025 12:10 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; alison.mills@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com; smcmb@allstate.com
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Team,

 

Please put the request on hold I will test the q1 scan and reply back to you since we have tested only one database. Once the scan run as usual, we can resolve the request. Thanks for your patience .

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: 09 April 2025 11:18 AM
To: ., Kaviya <kaaah@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>; McMahon, Sean <smcmb@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Kaviya, great news, thank you! Is it ok for us to close this ticket?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: ., Kaviya [kaaah@allstate.com]
Sent: 4/8/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; alison.mills@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com; smcmb@allstate.com
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Team,

 

The job Ran successfully with one warning as mentioned below , it almost took 1hr 23min:

 

[Inline image name : image001.png]

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: 08 April 2025 05:14 PM
To: ., Kaviya <kaaah@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>; McMahon, Sean <smcmb@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Kaviya, thank you for your time on meeting, I've took a backup of existing files and applied hotfix provided by our team, I've also queued the SQL Permissions scan to check if scan times are improved. Please let me know if the issue persists after job finishes.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: ., Kaviya [kaaah@allstate.com]
Sent: 4/7/2025 1:39 PM
To: techsupport@netwrix.com; smcmb@allstate.com
Cc: aemstealthauditadmins@allstate.com; alison.mills@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Team,

 

We have updated the request to schedule the call for the queries regarding this HOTFIX , please send us the link to schedule a call.

 

Thanks,

Kaviya.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: 04 April 2025 02:49 PM
To: Netwrix Support <techsupport@netwrix.com>; McMahon, Sean <smcmb@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Team,

 

We have followed the below steps , we will try scan again if issue persists , we will get back you , Thank you.

 

 

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 4, 2025 11:40 AM
To: McMahon, Sean <smcmb@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi everyone, a hotfix to cover this issue is available for download:

https://releases.netwrix.com/products/auditor-enterprise/11.6/auditor-enterprise-hotfix-11.6.0.074.zip

Instructions:
1. Unblock the hotfix zip file in the windows property dialog, if an unblock button exists there.
2. Close all the instances of StealthAUDIT (Check task manager under process for all users)
3. Update all files in your %SAInstallDir% folder.

Please install it and let me know if issue persists.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/3/2025 1:59 PM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, my apologies for delay, the fix is still in development, I will follow up with status update on Friday, unless I will have news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/31/2025 3:07 PM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, the work on fix is still ongoing, I will keep monitoring and will provide next status update on Wednesday, unless I will get news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/27/2025 9:18 AM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, we have identified issues with effective membership calculation that are causing these slowdowns and we are currently working to address them. I will keep monitoring for feedback from development team and will follow up with you once fix is available. I will provide next status update on Monday, if I will not receive news earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: McMahon, Sean [smcmb@allstate.com]
Sent: 3/20/2025 11:54 AM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Damir,

 

Please see screenshots below.

 

Thanks,

Sean

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 20, 2025 7:24 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image002.png]

Login to A0185-APP2750-S open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image003.png]

Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).

Currently:

 

[Inline image name : image004.png]

 

Task stats:

[Inline image name : image005.png]

 

Messages:

[Inline image name : image006.png]

 

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.

[Inline image name : image007.png]

 

[Inline image name : image008.png]

 

[Inline image name : image009.png]

 

DB:

[Inline image name : image010.png]

2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

 

A0185-APP2750-S: attached to portal.

 

3. Are both servers in the same physical location? Yes.

[Inline image name : image011.png]

 

[Inline image name : image012.png]

 

[Inline image name : image013.png]

 

Prod DB:

[Inline image name : image014.png]

 

Dev DB:

[Inline image name : image015.png]

4. Can you run ping command using command line: 

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hey all,

As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi all,

I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.

In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

 

[Inline image name : image016.png]

 

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image017.jpg]

 

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image018.jpg]

 

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Thank you, Damir.

Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

 

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

 

Damir, would you please advise:

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

It may be more advantageous to meet so please advise a time when we can meet to discuss.

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com; rkuqk@allstate.com; kaaah@allstate.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.  

 

Thank you,

Alison.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi,

 

Could please provide update for the below. The Support team needs some assistance.

 

Thanks,

Kaviya.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hello All,

 

What are we waiting on from SQL side please?

I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

 

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

 

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

 

Regards

Ravi Kumar

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

	 
	
	
	You don't often get email from techsupport@netwrix.com. Learn why this is important 
	
	
	 
	

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi all,

Please see attached the scan details:

[Inline image name : image019.png]

 

 

Task stats:
[Inline image name : image020.png]

 

Messages:

[Inline image name : image021.png]

 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 

[Inline image name : image022.png]

 

[Inline image name : image023.png]

 

Here is the last excerpt from the job log:

 

[Inline image name : image024.png]

 

Please reply all on your response.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:
[Inline image name : image025.png]

 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 

[Inline image name : image026.png]

 

The last piece of SQL that was executed was:

[Inline image name : image027.png]

Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 

[Inline image name : image028.png]

 

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 

[Inline image name : image029.png]

 

From the Job Status Export the Messages Table, CSV is preferred: 

[Inline image name : image030.png] 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:
[Inline image name : image031.png]

 

[Inline image name : image032.png]
 

Messages shows:

[Inline image name : image033.png]

 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 

[Inline image name : image034.png]

 

[Inline image name : image035.png]

 

[Inline image name : image036.png]

 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[Inline image name : image037.png]

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034","RE: [EXTERNAL] RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","kaaah@allstate.com","alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; rkuqk@allstate.com; smcmb@allstate.com","","true","2025-04-09T13:01:24.000Z","true"
"02sQk00000NiCcxIAF","500Qk00000LUiPMIA1","2025-04-14T11:07:48.000Z","2025-04-14T11:07:48.000Z","Hi Kaviya, could you please provide an update? Are we ok to close this ticket?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: ., Kaviya [kaaah@allstate.com]
Sent: 4/9/2025 12:10 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; alison.mills@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com; smcmb@allstate.com
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Team,

 

Please put the request on hold I will test the q1 scan and reply back to you since we have tested only one database. Once the scan run as usual, we can resolve the request. Thanks for your patience .

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: 09 April 2025 11:18 AM
To: ., Kaviya <kaaah@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>; McMahon, Sean <smcmb@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Kaviya, great news, thank you! Is it ok for us to close this ticket?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: ., Kaviya [kaaah@allstate.com]
Sent: 4/8/2025 5:16 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; alison.mills@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com; smcmb@allstate.com
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Team,

 

The job Ran successfully with one warning as mentioned below , it almost took 1hr 23min:

 

[Inline image name : image001.png]

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: 08 April 2025 05:14 PM
To: ., Kaviya <kaaah@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>; McMahon, Sean <smcmb@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Kaviya, thank you for your time on meeting, I've took a backup of existing files and applied hotfix provided by our team, I've also queued the SQL Permissions scan to check if scan times are improved. Please let me know if the issue persists after job finishes.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: ., Kaviya [kaaah@allstate.com]
Sent: 4/7/2025 1:39 PM
To: techsupport@netwrix.com; smcmb@allstate.com
Cc: aemstealthauditadmins@allstate.com; alison.mills@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Team,

 

We have updated the request to schedule the call for the queries regarding this HOTFIX , please send us the link to schedule a call.

 

Thanks,

Kaviya.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: 04 April 2025 02:49 PM
To: Netwrix Support <techsupport@netwrix.com>; McMahon, Sean <smcmb@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Team,

 

We have followed the below steps , we will try scan again if issue persists , we will get back you , Thank you.

 

 

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Friday, April 4, 2025 11:40 AM
To: McMahon, Sean <smcmb@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi everyone, a hotfix to cover this issue is available for download:

https://releases.netwrix.com/products/auditor-enterprise/11.6/auditor-enterprise-hotfix-11.6.0.074.zip

Instructions:
1. Unblock the hotfix zip file in the windows property dialog, if an unblock button exists there.
2. Close all the instances of StealthAUDIT (Check task manager under process for all users)
3. Update all files in your %SAInstallDir% folder.

Please install it and let me know if issue persists.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/3/2025 1:59 PM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, my apologies for delay, the fix is still in development, I will follow up with status update on Friday, unless I will have news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/31/2025 3:07 PM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, the work on fix is still ongoing, I will keep monitoring and will provide next status update on Wednesday, unless I will get news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/27/2025 9:18 AM
To: smcmb@allstate.com
Cc: alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; kaaah@allstate.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, we have identified issues with effective membership calculation that are causing these slowdowns and we are currently working to address them. I will keep monitoring for feedback from development team and will follow up with you once fix is available. I will provide next status update on Monday, if I will not receive news earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: McMahon, Sean [smcmb@allstate.com]
Sent: 3/20/2025 11:54 AM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Damir,

 

Please see screenshots below.

 

Thanks,

Sean

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 20, 2025 7:24 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image002.png]

Login to A0185-APP2750-S open command line and run: 

ping A0185-DBS0079-S

Take screenshot of output.

[Inline image name : image003.png]

Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).

Currently:

 

[Inline image name : image004.png]

 

Task stats:

[Inline image name : image005.png]

 

Messages:

[Inline image name : image006.png]

 

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.

[Inline image name : image007.png]

 

[Inline image name : image008.png]

 

[Inline image name : image009.png]

 

DB:

[Inline image name : image010.png]

2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

 

A0185-APP2750-S: attached to portal.

 

3. Are both servers in the same physical location? Yes.

[Inline image name : image011.png]

 

[Inline image name : image012.png]

 

[Inline image name : image013.png]

 

Prod DB:

[Inline image name : image014.png]

 

Dev DB:

[Inline image name : image015.png]

4. Can you run ping command using command line: 

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hey all,

As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi all,

I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.

In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

 

[Inline image name : image016.png]

 

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image017.jpg]

 

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:

[Inline image name : image018.jpg]

 

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; kaaah@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Thank you, Damir.

Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

 

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

 

Damir, would you please advise:

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

It may be more advantageous to meet so please advise a time when we can meet to discuss.

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; ., Kaviya <kaaah@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com; rkuqk@allstate.com; kaaah@allstate.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.  

 

Thank you,

Alison.

 

From: ., Kaviya <kaaah@allstate.com>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi,

 

Could please provide update for the below. The Support team needs some assistance.

 

Thanks,

Kaviya.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com; techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hello All,

 

What are we waiting on from SQL side please?

I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

 

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

 

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.

2>Target Table names to which data is committed on the target DB

3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

 

Regards

Ravi Kumar

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

	 
	
	
	You don't often get email from techsupport@netwrix.com. Learn why this is important 
	
	
	 
	

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com; rkuqk@allstate.com; damir.akhmatshin@netwrix.com
Cc: aemstealthauditadmins@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi Damir,

Just as an FYI please reply to all.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>; Damir Akhmatshin <damir.akhmatshin@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

 

@Damir Akhmatshin, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi all,

Please see attached the scan details:

[Inline image name : image019.png]

 

 

Task stats:
[Inline image name : image020.png]

 

Messages:

[Inline image name : image021.png]

 

As the job has completed I have exported the job log and attached it to the ticket via customer portal. 

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com>; Kumar, Ravi <rkuqk@allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Damir,

Here is the latest status of the SQL perm. Scan query (attached).

You can also see the SQL query appears to be ‘sleeping’:

 

[Inline image name : image022.png]

 

[Inline image name : image023.png]

 

Here is the last excerpt from the job log:

 

[Inline image name : image024.png]

 

Please reply all on your response.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; rkuqk@allstate.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]
 

Hello Alison, 

Thank you for keeping me posted. 

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB 

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment. 
The whole query as well as its status are attached to the ticket. 

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal. 
Looking forward to your reply. 

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com; rkuqk@allstate.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Artem,

Just to keep you in the picture, at present the permissions scan is on the following section of code:
[Inline image name : image025.png]

 

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

 

[Inline image name : image026.png]

 

The last piece of SQL that was executed was:

[Inline image name : image027.png]

Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?

Ravi is continuing to monitor the process.

 

Thank you,

Alison.

 

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Query:

;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]

 

 

 

Status:

Attached

 

 

 

 

[Inline image name : image028.png]

 

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem, 

Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send. 

Please see zip log and message log attached to the portal. 

Again, the SQL scan is looking for ADI values: No Azure ADI effective members found. 

The scan on the DUDDBA DB completed after 7hrs. 

 

Thank you, 

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the

ZjQcmQRYFpfptBannerStart

	
	
	This Message Is From an External Sender! 
	
	This message came from outside your organization. If you don’t trust this email, report it using the Report Phish button. 
	
	
	

ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today. 
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. 

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running. 

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export. 

[Inline image name : image029.png]

 

From the Job Status Export the Messages Table, CSV is preferred: 

[Inline image name : image030.png] 

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished. 
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
 

Hi Artem,

Please let me know when you are available to meet and discuss.

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

Thank you for the detailed reply. 

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com
Cc: aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com; jared.harris@netwrix.com
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

 

Hi all,

Just to follow up on this, the SQL scan completed with the following:

 

It took 13hrs to scan 2 servers:
[Inline image name : image031.png]

 

[Inline image name : image032.png]
 

Messages shows:

[Inline image name : image033.png]

 

We have not set up Azure SQL scanning on this server.

 

Thank you,

Alison.

From: Mills, Alison <Alison.Mills@Allstate.com>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hi Artem,

Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

 

[Inline image name : image034.png]

 

[Inline image name : image035.png]

 

[Inline image name : image036.png]

 

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

 

In the job log we can see the ‘ClearOldData’ takes 1hr 20 mins and the ‘InsertEffectiveRoleMembership(): Sql Server’ takes 40 mins.

Currently the ‘InsertEffectiveRoleMembership(): ADI’ is being performed. When I checked the ‘SA_AzureADInventory_Effective*’ tables and views, there are none beginning with ‘SA_AzureADInventory_Effective’. Do these need to be populated prior to running a scan?

 

The current server time is 18:10 and so the ‘InsertEffectiveRoleMembership(): ADI’ has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[Inline image name : image037.png]

 

Thank you,

Alison.

 

From: Netwrix Support <techsupport@netwrix.com>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com>
Cc: jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

 

Hello Alison, 

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket. 

Did you review my previous email? If you have any additional questions - please, let me know. 
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com

--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com
Cc: jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; aem-stealthaudit-vm@allstate.com
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, 

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning. 
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034","RE: [EXTERNAL] RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","techsupport@netwrix.com","Netwrix Support","kaaah@allstate.com","alison.mills@allstate.com; jared.harris@netwrix.com; aemstealthauditadmins@allstate.com; rkuqk@allstate.com; smcmb@allstate.com","","true","2025-04-14T11:07:47.000Z","true"
"02sQk00000NktU8IAJ","500Qk00000LUiPMIA1","2025-04-15T10:34:36.000Z","2025-04-15T13:55:32.000Z","ref:_00D7091pB._500Q000LUiPM:ref

Hi Team,

Please resolve the request at the Min since the scan ran successful within 6 hrs but we have issue with the permission , hence we will check that and revert back to you.

From: Netwrix Support <techsupport@netwrix.com>
Sent: 14 April 2025 04:38 PM
To: ., Kaviya <kaaah@allstate.com>
Cc: Mills, Alison <Alison.Mills@Allstate.com>; jared.harris@netwrix.com; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com>; Kumar, Ravi <rkuqk@allstate.com>; McMahon, Sean <smcmb@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Kaviya, could you please provide an update? Are we ok to close this ticket?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: ., Kaviya [kaaah@allstate.com]
Sent: 4/9/2025 12:10 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; smcmb@allstate.com<mailto:smcmb@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Team,

Please put the request on hold I will test the q1 scan and reply back to you since we have tested only one database. Once the scan run as usual, we can resolve the request. Thanks for your patience .

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: 09 April 2025 11:18 AM
To: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; McMahon, Sean <smcmb@allstate.com<mailto:smcmb@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Kaviya, great news, thank you! Is it ok for us to close this ticket?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: ., Kaviya [kaaah@allstate.com]
Sent: 4/8/2025 5:16 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; smcmb@allstate.com<mailto:smcmb@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Team,

The job Ran successfully with one warning as mentioned below , it almost took 1hr 23min:

[cid:image001.png@01DBAE1F.EC399EE0]

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: 08 April 2025 05:14 PM
To: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; McMahon, Sean <smcmb@allstate.com<mailto:smcmb@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Kaviya, thank you for your time on meeting, I've took a backup of existing files and applied hotfix provided by our team, I've also queued the SQL Permissions scan to check if scan times are improved. Please let me know if the issue persists after job finishes.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: ., Kaviya [kaaah@allstate.com]
Sent: 4/7/2025 1:39 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Team,

We have updated the request to schedule the call for the queries regarding this HOTFIX , please send us the link to schedule a call.

Thanks,
Kaviya.

From: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Sent: 04 April 2025 02:49 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; McMahon, Sean <smcmb@allstate.com<mailto:smcmb@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Team,

We have followed the below steps , we will try scan again if issue persists , we will get back you , Thank you.



From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Friday, April 4, 2025 11:40 AM
To: McMahon, Sean <smcmb@allstate.com<mailto:smcmb@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, a hotfix to cover this issue is available for download:

https://releases.netwrix.com/products/auditor-enterprise/11.6/auditor-enterprise-hotfix-11.6.0.074.zip


Instructions:
1. Unblock the hotfix zip file in the windows property dialog, if an unblock button exists there.
2. Close all the instances of StealthAUDIT (Check task manager under process for all users)
3. Update all files in your %SAInstallDir% folder.

Please install it and let me know if issue persists.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 4/3/2025 1:59 PM
To: smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, my apologies for delay, the fix is still in development, I will follow up with status update on Friday, unless I will have news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/31/2025 3:07 PM
To: smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, the work on fix is still ongoing, I will keep monitoring and will provide next status update on Wednesday, unless I will get news for you earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/27/2025 9:18 AM
To: smcmb@allstate.com<mailto:smcmb@allstate.com>
Cc: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi everyone, following up on this issue, we have identified issues with effective membership calculation that are causing these slowdowns and we are currently working to address them. I will keep monitoring for feedback from development team and will follow up with you once fix is available. I will provide next status update on Monday, if I will not receive news earlier.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: McMahon, Sean [smcmb@allstate.com]
Sent: 3/20/2025 11:54 AM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Damir,

Please see screenshots below.

Thanks,
Sean

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 20, 2025 7:24 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, thank you for detailed and prompt response!

I've followed up with R&D team and we're checking files you've sent.

Ping tests are not clear for me, could you please do following:

Login to Y0185-APP0443-S and open command line and run:

ping A0185-DBS0079-S

Take screenshot of output.
[cid:image002.png@01DBAE1F.EC399EE0]


Login to A0185-APP2750-S open command line and run:

ping A0185-DBS0079-S

Take screenshot of output.
[cid:image003.png@01DBAE1F.EC399EE0]


Share screenshots with me.

Purpose of this test is to see if there's a difference in delay in ms from both applications servers to target server.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/19/2025 6:45 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
The scan on A0775-APP2357-S has completed and I have attached the exported job log to the ticket portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 19, 2025 1:16 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Please see comments below: We are also running a scan from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S (Hudson) and to A0775-DBS0123-S (Rouchelle) both on tempDB with data committal to A0775-DBS0136-S (Rouchelle).
Currently:

[cid:image004.png@01DBAE1F.EC399EE0]

Task stats:
[cid:image005.png@01DBAE1F.EC399EE0]

Messages:
[cid:image006.png@01DBAE1F.EC399EE0]

So, from A0775-APP2357-S (Rouchelle) to A0185-DBS0079-S with data committal to A0775-DBS0136-S (Rouchelle) has taken 46mins.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 19, 2025 10:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, to summarize current state after reviewing logs:

SQL Permissions scan from Y0185-APP0443-S to A0185-DBS0079-S takes around 40 minutes.
SQL Permissions scan from A0185-APP2750-S to A0185-DBS0079-S takes around 7 hours.

1. Can you please remind me which one is from DEV environment and which one from Test? Y0185-APP0443-S is dev (non-prod) and A0185-APP2750-S is prod. A0185-DBS0079-S is prod. All servers are in the .AD.Allstate domain.
[cid:image007.png@01DBAE1F.EC399EE0]

[cid:image008.png@01DBAE1F.EC399EE0]

[cid:image009.png@01DBAE1F.EC399EE0]

DB:
[cid:image010.png@01DBAE1F.EC399EE0]


2. Do they have the same hardware specs? If not sure, please use this command on both servers to generate .nfo files, make sure output folder exists: hardware specs attached to ticket for Y server.

msinfo32 /nfo C:TEMPMSINFO.NFO

And upload both MSINFO.NFO files to ticket attachments

A0185-APP2750-S: attached to portal.

3. Are both servers in the same physical location? Yes.
[cid:image011.png@01DBAE1F.EC399EE0]

[cid:image012.png@01DBAE1F.EC399EE0]

[cid:image013.png@01DBAE1F.EC399EE0]

Prod DB:
[cid:image014.png@01DBAE1F.EC399EE0]

Dev DB:
[cid:image015.png@01DBAE1F.EC399EE0]

4. Can you run ping command using command line:

ping A0185-DBS0079-S see above

from both Y0185-APP0443-S and A0185-APP2750-S, please send me screenshots of output for both. see above

5. Can you check if other scans are slower on A0185-APP2750-S? Can we run a small job on both machines to see if the difference is present with a reduced data set? See first comment above.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 8:01 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: FW: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref
Hey all,
As an FYI, I have also ran a scan on A0185-DBS0079-S on all its DB (DUDDBA, DUDREPO, etc) and the scan completed in 41 mins with no errors.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Monday, March 17, 2025 2:59 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi all,
I have scheduled a meeting for tomorrow morning 10am UK time. I hope you all can make it.
In the interim, I have ran the same scan (of tempDB of A0185-DBS0079-S). The scan took 41 mins and completed successfully. Please find log attached to the ticket portal (1-SQL_PermissionsScan.5.zip).

[cid:image016.png@01DBAE1F.EC399EE0]

The tempDB scan of A0185-DBS0079-S to J4SSP204 (our prod DB) shows 1458594 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image017.jpg@01DBAE1F.EC399EE0]

The tempDB scan of A0185-DBS0079-S to J4SST201 (our dev DB) shows 1063834 rows in SA_SQLServer_EffectiveRoleMembership:
[cid:image018.jpg@01DBAE1F.EC399EE0]


Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 10:26 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, regarding meeting I agree and will be happy to meet, please book a meeting with me so I can answer your questions after I will review current configuration.

https://nwxcorp.my.salesforce-sites.com/cts?Id=SrRCwL_9lsA5cF.EB2wS9hyk2xJLUX0BZbMNCmM_vsY-Z&MeetingID=qhnA2bTPwfvAcj2NhZH3XvmTq13zKoW3G7QcXVy1lso-Z

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 2:06 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Thank you, Damir.
Damir, I have attached the query excerpt which Ravi sent me (which incidentally at that time showed all processes on SQL side to be sleeping). Is it possible the query execution plan needs optimized?

Ravi, if you have the DB excerpts from March 11 would you please send them on the Damir.

Damir, would you please advise:
1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there. I have explained this is the console from which the SQL query scan is executed. Can you provide anything additional please?
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?
It may be more advantageous to meet so please advise a time when we can meet to discuss.
Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 17, 2025 5:28 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Thank you Alison, I've escalated this issue with high priority to development team, I will check with development team today once again and will get back to you.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<http://www.netwrix.com/>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/17/2025 1:11 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; kaaah@allstate.com<mailto:kaaah@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
We have tested scans at different times of the day (when no backup/maintenance jobs are running) and on different DBs and they are all taking 7+hrs. The last scan we ran was on tempDB, this DB alone took 7+ hrs.

Thank you,
Alison.

From: ., Kaviya <kaaah@allstate.com<mailto:kaaah@allstate.com>>
Sent: Friday, March 14, 2025 9:56 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi,

Could please provide update for the below. The Support team needs some assistance.

Thanks,
Kaviya.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 1:53 PM
To: Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: [External] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations. Best Regards, Damir
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd
Hi Ravi, we just need a confirmation from SQL team that no backup or maintenance procedures are running in the timeframe of SQL Permissions scan, having it running the same time could prevent update and insert operations.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNR5HL5Hf$>


--------------- Original Message ---------------
From: Kumar, Ravi [rkuqk@allstate.com]
Sent: 3/13/2025 12:09 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>; techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hello All,

What are we waiting on from SQL side please?
I had a session with Alison yesterday and worked together to put all the question together in her previous email which is required for understanding the issue and isolate it first.

The whole job which you are running is not evidently giving any clue from your logs since the scan ran on TempDB should have ideally smallest of the data set and hence 7 -8 Hrs of execution time cannot be gauged. Hence please answer the questions which has been put on email by Alison.

1>I have to understand what is the role of the APP server A0185-APP2750-S in whole process and what executes over there.
2>Target Table names to which data is committed on the target DB
3>What all is being scanned and in format and data type is being cached /stored. Is it also being transformed?

Regards
Ravi Kumar

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Thursday, March 13, 2025 2:58 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


You don't often get email from techsupport@netwrix.com<mailto:techsupport@netwrix.com>. Learn why this is important<https://urldefense.com/v3/__https://aka.ms/LearnAboutSenderIdentification__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNWCe4t6-$>

Hi Alison, thank you for clarification, I will escalate this ticket while we wait for feedback from your SQL team regarding maintenance or backup procedures, to get our development team's feedback as well.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 8:24 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>; damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi Damir,
Just as an FYI please reply to all.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Wednesday, March 12, 2025 2:44 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>; Damir Akhmatshin <damir.akhmatshin@netwrix.com<mailto:damir.akhmatshin@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>
Subject: RE: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
I have reached out to Ravi to advise if there were any issues which may have caused any blocking on insert or update statements. @Kumar, Ravi<mailto:rkuqk@allstate.com> please advise when you check J4SSP204 (J4D_STEALTHAUDIT_AEM_WIN) on server A0775-DBS0136-S  for any blocking between the times of 06:29 and 13:34 server time.

@Damir Akhmatshin<mailto:damir.akhmatshin@netwrix.com>, this job can run as a scheduled task and ad-hoc. Either run takes ~7+hrs. We have ran the scan at several times of the day and via a scheduled and non-scheduled job. Neither makes a difference to the scan duration.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, March 12, 2025 1:29 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, the nature of the issue and the fact that it waits there sleeping is suggesting that something might be blocking insert or update statements.

From the timeframe I assume this job is running as a scheduled task, is that correct?

If it does run as scheduled task, can you please check with SQL team if there're any maintenance or backup procedures in same time window?

If there're no maintenance or backup procedures in same time window, would it be possible to run one SQL Permissions scan manually, just to confirm that this is not scheduled vs manual task issue?

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/12/2025 2:21 AM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi all,
Please see attached the scan details:
[cid:image019.png@01DBAE1F.EC399EE0]


Task stats:
[cid:image020.png@01DBAE1F.EC399EE0]

Messages:
[cid:image021.png@01DBAE1F.EC399EE0]

As the job has completed I have exported the job log and attached it to the ticket via customer portal.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 3:50 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>; Kumar, Ravi <rkuqk@allstate.com<mailto:rkuqk@allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Damir,
Here is the latest status of the SQL perm. Scan query (attached).
You can also see the SQL query appears to be 'sleeping':

[cid:image022.png@01DBAE1F.EC399EE0]

[cid:image023.png@01DBAE1F.EC399EE0]

Here is the last excerpt from the job log:

[cid:image024.png@01DBAE1F.EC399EE0]

Please reply all on your response.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Tuesday, March 11, 2025 1:57 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: [EXTERNAL] Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, I've taken ownership of this ticket and currently going through collected logs, I will keep you posted.

Best Regards,
Damir Akhmatshin
Support Engineer EMEA
____________________ _________
Powerful Data Security Made Easy
300 Spectrum Ctr Dr #200, Irvine, CA 92618
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 3/11/2025 5:30 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for keeping me posted.

Allow me to recap today's meeting first:

We configured SQL permission scan job to run against this server/db:

SQL:
a0185-dbs0079-s

DB:
TempDB

We noticed job stalling on this step as per application log files:
""Begin CollectEffectiveRoleMembership(): SA_SQLServer_EEffectieRoleMembership""

This was investigated from the NEA db side itself. We found that a SELECT query was been executed at that moment.
The whole query as well as its status are attached to the ticket.

To take it a step further I need a complete log of this job run. Once this job run finishes, please, export job log and attach it to the ticket via customer portal.
Looking forward to your reply.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!JtNv5F2hSO-CQ6kk8oznkQdx7h91Tg0P-KPlECb_jcFrnj1xidmrcM_dwQV99DLQaPbA4598D0iKL3wruqiX9tXQNfKxl7X7$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 3/11/2025 4:25 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>; rkuqk@allstate.com<mailto:rkuqk@allstate.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Artem,
Just to keep you in the picture, at present the permissions scan is on the following section of code:
[cid:image025.png@01DBAE1F.EC399EE0]

However, after checking with Ravi, he has noted all the SQL statements are sleeping: see attached.

[cid:image026.png@01DBAE1F.EC399EE0]

The last piece of SQL that was executed was:
[cid:image027.png@01DBAE1F.EC399EE0]
Maybe this is OK, just wanted to let you know where the SQL stopped executing as far as we can see. Is there an Insert executing somewhere else?
Ravi is continuing to monitor the process.

Thank you,
Alison.

From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, March 11, 2025 11:43 AM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Query:
;WITH [expand_group]([instance_name], [instance_id], [database_name], [database_id], [role_name]   , [role_id], [role_sid], [role_member_name], [role_member_id], [role_member_sid], [role_member_type]   , [member_path], [nested_level], [membership_source],[database_type])  AS  (  SELECT             rmv.[instance_name]            ,rmv.[instance_id]            ,rmv.[database_name]            ,ISNULL(rmv.[database_id],-1) [database_id]            ,rmv.[role_name]            ,rmv.[role] [role_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[role_sid]) [role_sid]            ,rmv.[member_name] [role_member_name]            ,rmv.[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] (rmv.[member_sid]) [role_member_sid]            ,rmv.[member_type] [role_member_type]      ,CAST([rmv].[role_name] AS NVARCHAR(2048)) as [member_path]            ,0 AS [nested_level]     , case      when i.database_type = 1 then 1 -- sql server     when i.database_type = 2 then 4 -- AzureSqlServer     when i.database_type = 6 then 5 -- AzureSqlServerManaged     else 0 -- Unset    End member_source_name    ,i.database_type  FROM       [dbo].[SA_SQLServer_RoleMembersView] rmv  INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = rmv.instance_id  INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id  LEFT JOIN  [SA_SQLServer_ServerPrincipals] sp ON rmv.[member] = sp.[id] AND rmv.[instance_id] = sp.[instance_id]  LEFT JOIN  [SA_SQLServer_DatabasePrincipalsView] dp ON rmv.[member] = dp.[id] AND rmv.[instance_id] = dp.[instance_id]  AND        rmv.[database_id] = dp.[database_id]       UNION  ALL   -- Recursive      SELECT     [e].[instance_name]            ,[e].[instance_id]      ,[e].[database_name]            ,[e].[database_id]            ,[e].[role_name]            ,[e].[role_id]            ,[e].[role_sid]            ,[g].[member_name] [role_member_name]            ,[g].[member] [role_member_id]            ,[dbo].[SA_SQLServer_BinarySIDToString] ([g].[member_sid]) [role_membersid]      ,[g].[member_type] [role_member_type]            ,CAST([e].[member_path] + N' > ' + [g].[role_name] AS NVARCHAR(2048)) AS [MemberPath]            ,[e].[nested_level]+1 AS [nested_level]      ,1 [membership_source]      ,1 database_type      FROM   [dbo].[SA_SQLServer_RoleMembersView] AS [g]   INNER JOIN [dbo].SA_SQLServer_Instances si on si.id = [g].instance_id   INNER JOIN [dbo].SA_SQL_Instances i on i.instance_id = si.sql_instance_id   JOIN   [expand_group] AS [e] ON [g].[role_name] = [e].[role_member_name]      AND    [g].[instance_id] = [e].[instance_id]      AND    ISNULL([g].[database_id],-1) =ISNULL( [e].[database_id],-1)      WHERE  [g].[member_name]  <> [e].[role_member_name]      AND    CHARINDEX(' > ' + CAST([g].[member_name] as nvarchar(max)) + ' > ', [e].[member_path]) = 0  )  SELECT [instance_name]  ,[instance_id]  ,[database_name]  ,[database_id]  ,[role_name], [role_id]      ,[role_sid]      ,[role_member_name]      ,[role_member_id]      ,[role_member_sid]      ,[role_member_type]      ,[member_path]+' > '+[role_member_name] [member_path]      ,[nested_level]+1 [nested_level]  ,[membership_source]  ,[database_type]  FROM [expand_group]



Status:
Attached




[cid:image028.png@01DBAE1F.EC399EE0]

From: Mills, Alison
Sent: Wednesday, March 5, 2025 5:14 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for my late reply, I am not sure what is happening with my Outlook - I have sent a message to you several times but it appears to not send.
Please see zip log and message log attached to the portal.
Again, the SQL scan is looking for ADI values: No Azure ADI effective members found.
The scan on the DUDDBA DB completed after 7hrs.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, March 3, 2025 3:05 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [External] RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison, Thank you for your time on a meeting today. Please, accept my apologies for a delayed reply - I had to finish another call after our meeting. Here is a recap of the meeting we had today: Currently it is not clear what is causing the
ZjQcmQRYFpfptBannerStart
This Message Is From an External Sender!
This message came from outside your organization. If you don't trust this email, report it using the Report Phish button.
ZjQcmQRYFpfptBannerEnd

Hi Alison,

Thank you for your time on a meeting today.
Please, accept my apologies for a delayed reply - I had to finish another call after our meeting.

Here is a recap of the meeting we had today:

Currently it is not clear what is causing the SQL Permission scan to take 10-13 hours to scan 2 SQL servers.

To isolate the issue and find the bottleneck I suggested selecting a single SQL server, and within that server select only a single SQL DB to scan:

SQL:
a0185-dbs0079-s

DB:
DUDDBA

As such, we performed SQL instance discovery on the a0185-dbs0079-s server, then added it to the SQL permission scan ""hosts"".
Currently the job is running.

Once the job has finished - please, export logs and messages (in TSV format) for the SQL Permission Scan as described in these steps:

Right click on the SQL Permission Scan Job we configured to run against a0185-dbs0079-s sql server and select Export.

[image]



From the Job Status Export the Messages Table, CSV is preferred:

[image]

Please, upload resulting artifacts to the ticket using customer portal in ""My Tickets"" section and notify me once the upload has finished.
I will analyze the logs, and then we will schedule next meeting to set up filter for the next SQLserver/Database.

Looking forward to hearing back from you. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/27/2025 2:15 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Here is a link to schedule meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=KowfePpaDpoWVl3QDqvO5clni84S4pguMtQYmVrE6lE-Z&MeetingID=P6XCq_u9VUL4pjbfQH6TMcSq5sP5E8PJnJU2zm9QQn0-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrdZeIB3w$>

Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjrumC4jhw$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 7:52 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref

Hi Artem,
Please let me know when you are available to meet and discuss.

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Wednesday, February 26, 2025 2:59 PM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

Thank you for the detailed reply.

According to the information you provided - it looks like right now you are scanning only 2 SQL servers instead of the entire SQL server list. Is that correct? Yes.
Last time when we were on meeting, I remember there was a list of SQL servers to process, not just 2. Correct, we have approx. 860 servers to scan.

To continue, have you noticed improvements in the scan time after increasing number of threads to 15? Please note, that increase Threads will only help when there are many SQL servers scanned at the same time because each thread will process single SQL server. No, I have not seen any improvement.

Also, have you reviewed the list of SQL servers and databases that need to be scanned? Are there any SQL servers and/or databases that can be excluded from processing? We have the concise list.

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Mills, Alison [alison.mills@allstate.com]
Sent: 2/26/2025 1:55 PM
To: techsupport@netwrix.com<mailto:techsupport@netwrix.com>
Cc: aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>; jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>
Subject: RE: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

ref:_00D7091pB._500Q000LUiPM:ref


Hi all,
Just to follow up on this, the SQL scan completed with the following:

It took 13hrs to scan 2 servers:
[cid:image031.png@01DBAE1F.EC399EE0]

[cid:image032.png@01DBAE1F.EC399EE0]

Messages shows:
[cid:image033.png@01DBAE1F.EC399EE0]

We have not set up Azure SQL scanning on this server.

Thank you,
Alison.
From: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Sent: Tuesday, February 25, 2025 11:24 PM
To: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: RE: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Artem,
Apologies for the late reply, I was unexpectedly OOO yesterday. At the moment I have kicked off 2 scans on StealthAudit. Here is the last entries in the job log:

[cid:image034.png@01DBAE1F.EC399EE0]

[cid:image035.png@01DBAE1F.EC399EE0]

[cid:image036.png@01DBAE1F.EC399EE0]

I assume the SQL timeout of 599940 is in seconds which equates to 9999 minutes i.e. never ending.

In the job log we can see the 'ClearOldData' takes 1hr 20 mins and the 'InsertEffectiveRoleMembership(): Sql Server' takes 40 mins.
Currently the 'InsertEffectiveRoleMembership(): ADI' is being performed. When I checked the 'SA_AzureADInventory_Effective*' tables and views, there are none beginning with 'SA_AzureADInventory_Effective'. Do these need to be populated prior to running a scan?

The current server time is 18:10 and so the 'InsertEffectiveRoleMembership(): ADI' has been executing for ~4hrs and the whole scan has been executing for ~6hrs. The scan properties are:
[cid:image037.png@01DBAE1F.EC399EE0]

Thank you,
Alison.

From: Netwrix Support <techsupport@netwrix.com<mailto:techsupport@netwrix.com>>
Sent: Monday, February 24, 2025 11:08 AM
To: Mills, Alison <Alison.Mills@Allstate.com<mailto:Alison.Mills@Allstate.com>>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; AEM-StealthAudit_Admins <AEMStealthAuditAdmins@allstate.com<mailto:AEMStealthAuditAdmins@allstate.com>>; AEM-StealthAudit-VM <AEM-StealthAudit-VM@allstate.com<mailto:AEM-StealthAudit-VM@allstate.com>>
Subject: [EXTERNAL] RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]


Hello Alison,

I have not heard back from you after my last mail. As such, I am sending this follow up to check the status of our ticket.

Did you review my previous email? If you have any additional questions - please, let me know.
Looking forward to your reply. Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
www.netwrix.com<https://urldefense.com/v3/__http://www.netwrix.com/__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjqJNnywvg$>


--------------- Original Message ---------------
From: Netwrix Support [techsupport@netwrix.com]
Sent: 2/18/2025 7:57 PM
To: alison.mills@allstate.com<mailto:alison.mills@allstate.com>
Cc: jared.harris@netwrix.com<mailto:jared.harris@netwrix.com>; aemstealthauditadmins@allstate.com<mailto:aemstealthauditadmins@allstate.com>; aem-stealthaudit-vm@allstate.com<mailto:aem-stealthaudit-vm@allstate.com>
Subject: RE: RE: RE: Netwrix Support Ticket #434705 - - RE: SQL Permissions Performance is low [ ref:!00D70091pB.!500Qk0LUiPM:ref ]

Hi Alison,

Yes, please, refer to this link to schedule a meeting with me:
https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z<https://urldefense.com/v3/__https://nwxcorp.my.salesforce-sites.com/cts?Id=XvG80IIkBHVNv6WV__3f.4BB1AKJcwdnHL2Bo_BFTFw-Z&MeetingID=i9MmBOL_V8PSz4X9nLt95FZQ1L6ckpfBvqgqEv.4S8U-Z__;!!IIU9BLNPZ2ob!P19R-8goKO9idK6-zQcDDi0XTamOB01sl_DmjNveKzL5Qag4pXne43QKAd4RZ1KU8gdx97CanRQlL4OcgxTPNMP4xjoJgdaFdA$>

Please, let me know if you had an update from SQL DBA team as per my previous email. It would benefit our troubleshooting if we could have an input from them regarding the number of SQL servers to scan and list of required databases for scanning.
Thank you!

Best regards,
Artem Naskal
Technical Support Engineer EMEA
____________________ _________
Cybersecurity That Works for You

6160 Warren Parkway, Suite 100, Frisco, TX 75034
[https://nwxcorp.my.salesforce.com/servlet/servlet.ImageServer?oid=00D7000000091pB&esid=018Qk00000LBMsN&from=ext]","RE: [EXTERNAL] RE:  RE:  Netwrix Support Ticket #434705 -  - RE: SQL Permissions Performance is low    [ ref:!00D70091pB.!500Qk0LUiPM:ref ]","kaaah@allstate.com","., Kaviya","techsupport@netwrix.com","aemstealthauditadmins@allstate.com; alison.mills@allstate.com; jared.harris@netwrix.com; rkuqk@allstate.com; smcmb@allstate.com","","true","2025-04-15T10:34:05.000Z","true"
