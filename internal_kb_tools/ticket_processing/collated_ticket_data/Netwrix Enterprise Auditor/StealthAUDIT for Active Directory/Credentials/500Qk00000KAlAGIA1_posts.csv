"Id","ParentId","Type","CreatedById","CreatedDate","Body","Title","LinkUrl","RelatedRecordId","InsertedById","LastModifiedDate"
"0D5Qk00000UAtOtKAL","500Qk00000KAlAGIA1","TextPost","0054u000008ARZjAAO","2025-01-03T13:17:41.000Z","Description: The job is failing with error message ""System.UnauthorizedAccessException: Replication access was denied ---> System.ComponentModel.Win32Exception: Replication access was denied
   --- End of inner exception stack trace ---
   at DSInternals.Common.Validator.AssertSuccess(Win32ErrorCode code)
   at DSInternals.Replication.Interop.DrsConnection.GetNCChanges(unique_ptr* , unique_ptr* request)
   at DSInternals.Replication.Interop.DrsConnection.ReplicateAllObjects(ReplicationCookie cookie, UInt32[] partialAttributeSet, UInt32 maxBytes, UInt32 maxObjects)
   at DSInternals.Replication.DirectoryReplicationClient.d__11.MoveNext()
   at Stealthbits.StealthAUDIT.DataCollectors.PasswordSecurity.Tasks.WeakPasswordsScanTask.InternalProcessRecord()""
   at <a href='https://Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task' target='_blank'>Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task</a>.StartExecute()","","","","0054u000008ARZjAAO","2025-01-03T13:17:41.000Z"
"0D5Qk00000UBiCaKAL","500Qk00000KAlAGIA1","TextPost","0054u000007ow49AAA","2025-01-03T13:38:39.000Z","What We've Learned Updated: High-risk USA timezone
Probably permissions issue, since replication can not be run","","","","0054u000007ow49AAA","2025-01-03T13:38:39.000Z"
"0D5Qk00000UNDCAKA5","500Qk00000KAlAGIA1","TextPost","005Qk000002AJWTIA4","2025-01-07T15:20:03.000Z","What We've Learned Updated: High-risk USA timezone
Probably permissions issue, since replication can not be run

--------
01/07/2025
--------

Logs indicate permissions issue accessing replication in domain.

06/01/2025 20:57:24	ERROR	PASSWORDSECURITY	Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task.StartExecute	""System.UnauthorizedAccessException: Replication access was denied ---> System.ComponentModel.Win32Exception: Replication access was denied     --- End of inner exception stack trace ---     at DSInternals.Common.Validator.AssertSuccess(Win32ErrorCode code)     at DSInternals.Replication.Interop.DrsConnection.GetNCChanges(unique_ptr<__MIDL_drsuapi_0042,midl_delete<__MIDL_drsuapi_0042> >* , unique_ptr<__MIDL_drsuapi_0046,midl_delete<__MIDL_drsuapi_0046> >* request)     at DSInternals.Replication.Interop.DrsConnection.ReplicateAllObjects(ReplicationCookie cookie, UInt32[] partialAttributeSet, UInt32 maxBytes, UInt32 maxObjects)     at DSInternals.Replication.DirectoryReplicationClient.<GetAccounts>d__11.MoveNext()     at Stealthbits.StealthAUDIT.DataCollectors.PasswordSecurity.Tasks.WeakPasswordsScanTask.InternalProcessRecord()     at Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task.StartExecute()""	BMGDCP2690LBM	DCExtract	3120	5104	3648

Provided documentation showing required permissions and Microsoft article detailing how to assign permissions.","","","","005Qk000002AJWTIA4","2025-01-07T15:20:03.000Z"
"0D5Qk00000UNDCBKA5","500Qk00000KAlAGIA1","TextPost","005Qk000002AJWTIA4","2025-01-07T15:20:03.000Z","Next Steps Updated: Awaiting customer to apply permissions and re run job.","","","","005Qk000002AJWTIA4","2025-01-07T15:20:03.000Z"
"0D5Qk00000V3pKHKAZ","500Qk00000KAlAGIA1","TextPost","005Qk000002AJWTIA4","2025-01-17T22:04:19.000Z","What We've Learned Updated: High-risk USA timezone
Probably permissions issue, since replication can not be run

--------
01/07/2025
--------

Logs indicate permissions issue accessing replication in domain.

06/01/2025 20:57:24	ERROR	PASSWORDSECURITY	Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task.StartExecute	""System.UnauthorizedAccessException: Replication access was denied ---> System.ComponentModel.Win32Exception: Replication access was denied     --- End of inner exception stack trace ---     at DSInternals.Common.Validator.AssertSuccess(Win32ErrorCode code)     at DSInternals.Replication.Interop.DrsConnection.GetNCChanges(unique_ptr<__MIDL_drsuapi_0042,midl_delete<__MIDL_drsuapi_0042> >* , unique_ptr<__MIDL_drsuapi_0046,midl_delete<__MIDL_drsuapi_0046> >* request)     at DSInternals.Replication.Interop.DrsConnection.ReplicateAllObjects(ReplicationCookie cookie, UInt32[] partialAttributeSet, UInt32 maxBytes, UInt32 maxObjects)     at DSInternals.Replication.DirectoryReplicationClient.<GetAccounts>d__11.MoveNext()     at Stealthbits.StealthAUDIT.DataCollectors.PasswordSecurity.Tasks.WeakPasswordsScanTask.InternalProcessRecord()     at Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task.StartExecute()""	BMGDCP2690LBM	DCExtract	3120	5104	3648

Provided documentation showing required permissions and Microsoft article detailing how to assign permissions.

--------
17/01/2025
--------
The customer is using a service account which cannot be directly added to the domain with proper permissions. I have suggested trying to use a group instead and add the service account user to that group to get the permissions needed.","","","","005Qk000002AJWTIA4","2025-01-17T22:04:19.000Z"
"0D5Qk00000VCrS8KAL","500Qk00000KAlAGIA1","TextPost","005Qk000002AJWTIA4","2025-01-21T14:52:44.000Z","Invitation updated. Attendees: No attendees listed","","","","005Qk000002AJWTIA4","2025-01-21T14:52:44.000Z"
"0D5Qk00000VCrS9KAL","500Qk00000KAlAGIA1","TextPost","005Qk000002AJWTIA4","2025-01-21T14:52:44.000Z","Invitation updated. Attendees: Ian Ranstrom","","","","005Qk000002AJWTIA4","2025-01-21T14:52:44.000Z"
"0D5Qk00000VCrSAKA1","500Qk00000KAlAGIA1","TextPost","005Qk000002AJWTIA4","2025-01-21T14:52:44.000Z","Invitation updated. Attendees: Ian Ranstrom, Don Boncodin","","","","005Qk000002AJWTIA4","2025-01-21T14:52:44.000Z"
"0D5Qk00000VNvoYKAT","500Qk00000KAlAGIA1","TextPost","005Qk000002AJWTIA4","2025-01-23T12:56:12.000Z","What We've Learned Updated: High-risk USA timezone
Probably permissions issue, since replication can not be run

--------
01/07/2025
--------

Logs indicate permissions issue accessing replication in domain.

06/01/2025 20:57:24	ERROR	PASSWORDSECURITY	Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task.StartExecute	""System.UnauthorizedAccessException: Replication access was denied ---> System.ComponentModel.Win32Exception: Replication access was denied     --- End of inner exception stack trace ---     at DSInternals.Common.Validator.AssertSuccess(Win32ErrorCode code)     at DSInternals.Replication.Interop.DrsConnection.GetNCChanges(unique_ptr<__MIDL_drsuapi_0042,midl_delete<__MIDL_drsuapi_0042> >* , unique_ptr<__MIDL_drsuapi_0046,midl_delete<__MIDL_drsuapi_0046> >* request)     at DSInternals.Replication.Interop.DrsConnection.ReplicateAllObjects(ReplicationCookie cookie, UInt32[] partialAttributeSet, UInt32 maxBytes, UInt32 maxObjects)     at DSInternals.Replication.DirectoryReplicationClient.<GetAccounts>d__11.MoveNext()     at Stealthbits.StealthAUDIT.DataCollectors.PasswordSecurity.Tasks.WeakPasswordsScanTask.InternalProcessRecord()     at Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task.StartExecute()""	BMGDCP2690LBM	DCExtract	3120	5104	3648

Provided documentation showing required permissions and Microsoft article detailing how to assign permissions.

--------
17/01/2025
--------
The customer is using a service account which cannot be directly added to the domain with proper permissions. I have suggested trying to use a group instead and add the service account user to that group to get the permissions needed.

--------
23/01/2025
--------
Customer would like a call scheduled between the hours of 3PM and 6PM Manila time.","","","","005Qk000002AJWTIA4","2025-01-23T12:56:12.000Z"
"0D5Qk00000VN7VUKA1","500Qk00000KAlAGIA1","TextPost","005Qk000002AJWTIA4","2025-01-23T12:56:19.000Z","Next Steps Updated: Awaiting customer meeting.","","","","005Qk000002AJWTIA4","2025-01-23T12:56:19.000Z"
"0D5Qk00000VNvtPKAT","500Qk00000KAlAGIA1","TextPost","005Qk000002AJWTIA4","2025-01-23T12:56:35.000Z","What We've Learned Updated: High-risk USA timezone
Probably permissions issue, since replication can not be run

--------
01/07/2025
--------

Logs indicate permissions issue accessing replication in domain.

06/01/2025 20:57:24	ERROR	PASSWORDSECURITY	Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task.StartExecute	""System.UnauthorizedAccessException: Replication access was denied ---> System.ComponentModel.Win32Exception: Replication access was denied     --- End of inner exception stack trace ---     at DSInternals.Common.Validator.AssertSuccess(Win32ErrorCode code)     at DSInternals.Replication.Interop.DrsConnection.GetNCChanges(unique_ptr<__MIDL_drsuapi_0042,midl_delete<__MIDL_drsuapi_0042> >* , unique_ptr<__MIDL_drsuapi_0046,midl_delete<__MIDL_drsuapi_0046> >* request)     at DSInternals.Replication.Interop.DrsConnection.ReplicateAllObjects(ReplicationCookie cookie, UInt32[] partialAttributeSet, UInt32 maxBytes, UInt32 maxObjects)     at DSInternals.Replication.DirectoryReplicationClient.<GetAccounts>d__11.MoveNext()     at Stealthbits.StealthAUDIT.DataCollectors.PasswordSecurity.Tasks.WeakPasswordsScanTask.InternalProcessRecord()     at Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task.StartExecute()""	BMGDCP2690LBM	DCExtract	3120	5104	3648

Provided documentation showing required permissions and Microsoft article detailing how to assign permissions.

--------
17/01/2025
--------
The customer is using a service account which cannot be directly added to the domain with proper permissions. I have suggested trying to use a group instead and add the service account user to that group to get the permissions needed.

--------
23/01/2025
--------
Customer would like a call scheduled between the hours of 3PM and 6PM Manila time to help apply the correct permissions.","","","","005Qk000002AJWTIA4","2025-01-23T12:56:35.000Z"
"0D5Qk00000VNk2FKAT","500Qk00000KAlAGIA1","TextPost","005Qk000002AJWTIA4","2025-01-23T12:58:19.000Z","<p>Customer is requesting a meeting to help apply replication permissions needed between the hours of 3pm and 6pm Manila time. Moving to support queue to get an agent that can assist during those hours.</p>","","","","005Qk000002AJWTIA4","2025-01-23T12:58:19.000Z"
"0D5Qk00000VNty3KAD","500Qk00000KAlAGIA1","TextPost","005Qk000002AJWTIA4","2025-01-23T13:09:58.000Z","Invitation updated. Attendees:","","","","005Qk000002AJWTIA4","2025-01-23T13:09:58.000Z"
"0D5Qk00000VNty4KAD","500Qk00000KAlAGIA1","TextPost","005Qk000002AJWTIA4","2025-01-23T13:09:59.000Z","Invitation updated. Attendees: , Don Boncodin","","","","005Qk000002AJWTIA4","2025-01-23T13:09:59.000Z"
"0D5Qk00000VO9oqKAD","500Qk00000KAlAGIA1","TextPost","005Qk000002b4gDIAQ","2025-01-23T15:36:23.000Z","<p>According to what we know so far, customer`s Domain Account in connection profile lacks needed permissions to the Domain Replication. </p><p> </p><p>This NEA HelpCenter article has a list of permissions for the least privileged access to Domain Replication:</p><p><a href=""https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/PasswordSecurity/Overview.htm"" alt=""https://helpcenter.netwrix.com/bundle/EnterpriseAuditor_11.6/page/Content/EnterpriseAuditor/Admin/DataCollector/PasswordSecurity/Overview.htm"" target=""_blank"">PasswordSecurity Data Collector</a></p><p> </p><p>This Microsoft Article has instructions how to assign some of these permissions:</p><p><a href=""https://learn.microsoft.com/en-us/troubleshoot/windows-server/windows-security/grant-replicating-directory-changes-permission-adma-service"" alt=""https://learn.microsoft.com/en-us/troubleshoot/windows-server/windows-security/grant-replicating-directory-changes-permission-adma-service"" target=""_blank"">Replicating Directory Changes permission - Windows Server | Microsoft Learn</a></p>","","","","005Qk000002b4gDIAQ","2025-01-23T15:36:23.000Z"
"0D5Qk00000VS4OdKAL","500Qk00000KAlAGIA1","TextPost","005Qk000002b4gDIAQ","2025-01-24T09:40:51.000Z","What We've Learned Updated: High-risk USA timezone
Probably permissions issue, since replication can not be run

--------
01/07/2025
--------

Logs indicate permissions issue accessing replication in domain.

06/01/2025 20:57:24	ERROR	PASSWORDSECURITY	Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task.StartExecute	""System.UnauthorizedAccessException: Replication access was denied ---> System.ComponentModel.Win32Exception: Replication access was denied     --- End of inner exception stack trace ---     at DSInternals.Common.Validator.AssertSuccess(Win32ErrorCode code)     at DSInternals.Replication.Interop.DrsConnection.GetNCChanges(unique_ptr<__MIDL_drsuapi_0042,midl_delete<__MIDL_drsuapi_0042> >* , unique_ptr<__MIDL_drsuapi_0046,midl_delete<__MIDL_drsuapi_0046> >* request)     at DSInternals.Replication.Interop.DrsConnection.ReplicateAllObjects(ReplicationCookie cookie, UInt32[] partialAttributeSet, UInt32 maxBytes, UInt32 maxObjects)     at DSInternals.Replication.DirectoryReplicationClient.<GetAccounts>d__11.MoveNext()     at Stealthbits.StealthAUDIT.DataCollectors.PasswordSecurity.Tasks.WeakPasswordsScanTask.InternalProcessRecord()     at Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task.StartExecute()""	BMGDCP2690LBM	DCExtract	3120	5104	3648

Provided documentation showing required permissions and Microsoft article detailing how to assign permissions.

--------
17/01/2025
--------
The customer is using a service account which cannot be directly added to the domain with proper permissions. I have suggested trying to use a group instead and add the service account user to that group to get the permissions needed.

--------
23/01/2025
--------
Customer would like a call scheduled between the hours of 3PM and 6PM Manila time to help apply the correct permissions.

-------- 
Customer is on 11.6.0.72 NEA. 

Customer wants to use GMSA account:
https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/group-managed-service-accounts/group-managed-service-accounts/group-managed-service-accounts-overview
as a service account for all Enterprise Auditor tasks. 

Customer was able to successfully use this account for all other tasks except for the AD_WeakPasswords Job

I have confirmed that GMSA account is a member of built-in Domain Administrators group. 
All other accounts added to Domain Admins group do not have permissions issue when they are used for AD_WeakPasswords Job. 
Only GMSA account, while being a member of Domain Admins, produces the ""access denied"" errors above. 

Agreed with customer that I will test this out from my side and check with RnD if needed to confirm if NEA has any limitations regarding GMSA account.","","","","005Qk000002b4gDIAQ","2025-01-24T09:40:51.000Z"
"0D5Qk00000VaPhBKAV","500Qk00000KAlAGIA1","TextPost","005Qk000002b4gDIAQ","2025-01-27T12:58:59.000Z","What We've Learned Updated: High-risk USA timezone
Probably permissions issue, since replication can not be run

--------
01/07/2025
--------

Logs indicate permissions issue accessing replication in domain.

06/01/2025 20:57:24	ERROR	PASSWORDSECURITY	Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task.StartExecute	""System.UnauthorizedAccessException: Replication access was denied ---> System.ComponentModel.Win32Exception: Replication access was denied     --- End of inner exception stack trace ---     at DSInternals.Common.Validator.AssertSuccess(Win32ErrorCode code)     at DSInternals.Replication.Interop.DrsConnection.GetNCChanges(unique_ptr<__MIDL_drsuapi_0042,midl_delete<__MIDL_drsuapi_0042> >* , unique_ptr<__MIDL_drsuapi_0046,midl_delete<__MIDL_drsuapi_0046> >* request)     at DSInternals.Replication.Interop.DrsConnection.ReplicateAllObjects(ReplicationCookie cookie, UInt32[] partialAttributeSet, UInt32 maxBytes, UInt32 maxObjects)     at DSInternals.Replication.DirectoryReplicationClient.<GetAccounts>d__11.MoveNext()     at Stealthbits.StealthAUDIT.DataCollectors.PasswordSecurity.Tasks.WeakPasswordsScanTask.InternalProcessRecord()     at Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task.StartExecute()""	BMGDCP2690LBM	DCExtract	3120	5104	3648

Provided documentation showing required permissions and Microsoft article detailing how to assign permissions.

--------
17/01/2025
--------
The customer is using a service account which cannot be directly added to the domain with proper permissions. I have suggested trying to use a group instead and add the service account user to that group to get the permissions needed.

--------
23/01/2025
--------
Customer would like a call scheduled between the hours of 3PM and 6PM Manila time to help apply the correct permissions.

-------- 
Customer is on 11.6.0.72 NEA. 

Customer wants to use gMSA account:
https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/group-managed-service-accounts/group-managed-service-accounts/group-managed-service-accounts-overview
as a service account for all Enterprise Auditor tasks. 

Customer was able to successfully use this account for all other tasks except for the AD_WeakPasswords Job

I have confirmed that gMSA account is a member of built-in Domain Administrators group. 
All other accounts added to Domain Admins group do not have permissions issue when they are used for AD_WeakPasswords Job. 
Only GMSA account, while being a member of Domain Admins, produces the ""access denied"" errors above. 

Agreed with customer that I will test this out from my side and check with RnD if needed to confirm if NEA has any limitations regarding GMSA account.

----------- 
Asked for assistance in SWAT channel with setting up gMSA account for AD_WeakPasswords job:
https://teams.microsoft.com/l/message/19:2f33cf4c06364f4c8644adce095eb161@thread.tacv2/1737982698734?tenantId=097499ff-179d-4959-ab02-86d364125bfc&groupId=72f83b71-3180-482b-b588-9595342c5a50&parentMessageId=1737982698734&teamName=SWAT%20Teams%3A%20Product%20Discussions%2C%20PM%20Q%26A%2C%20Feedback&channelName=NEA%20Core&createdTime=1737982698734","","","","005Qk000002b4gDIAQ","2025-01-27T12:58:59.000Z"
"0D5Qk00000VZvWrKAL","500Qk00000KAlAGIA1","TextPost","005Qk000002b4gDIAQ","2025-01-27T12:59:55.000Z","Next Steps Updated: I am waiting for additional information from Customer. 
I am also waiting for an update from this SWAT channel thread with information on how to set up gMSA account for NEA correctly:
https://teams.microsoft.com/l/message/19:2f33cf4c06364f4c8644adce095eb161@thread.tacv2/1737982698734?tenantId=097499ff-179d-4959-ab02-86d364125bfc&groupId=72f83b71-3180-482b-b588-9595342c5a50&parentMessageId=1737982698734&teamName=SWAT%20Teams%3A%20Product%20Discussions%2C%20PM%20Q%26A%2C%20Feedback&channelName=NEA%20Core&createdTime=1737982698734","","","","005Qk000002b4gDIAQ","2025-01-27T12:59:55.000Z"
"0D5Qk00000VdtEHKAZ","500Qk00000KAlAGIA1","TextPost","005Qk000002b4gDIAQ","2025-01-28T10:22:31.000Z","Steps to Reproduce Updated: Have 11.6.0.72 NEA installed 
Configure gMSA domain account 
Adding gMSA account using ""Managed Service Account"" password storage to connection profile produces error ""Access Denied"".
If gMSA account is added via ""Application"" password storage - then access denied error appears during ""AD_WeakPassword"" job execution.","","","","005Qk000002b4gDIAQ","2025-01-28T10:22:31.000Z"
"0D5Qk00000Ve7QrKAJ","500Qk00000KAlAGIA1","TextPost","005Qk000002b4gDIAQ","2025-01-28T11:44:56.000Z","Next Steps Updated: I am currently waiting for an update from this swat thread: 
https://teams.microsoft.com/l/message/19:2f33cf4c06364f4c8644adce095eb161@thread.tacv2/1737982698734?tenantId=097499ff-179d-4959-ab02-86d364125bfc&groupId=72f83b71-3180-482b-b588-9595342c5a50&parentMessageId=1737982698734&teamName=SWAT%20Teams%3A%20Product%20Discussions%2C%20PM%20Q%26A%2C%20Feedback&channelName=NEA%20Core&createdTime=1737982698734

Both me and customer are unable to add gMSA account to NEA connection profile using ""Managed Service Account"" password storage. We need some clarification from RnD/PM team if it is unexpected behavior.","","","","005Qk000002b4gDIAQ","2025-01-28T11:44:56.000Z"
"0D5Qk00000Vn3vtKAB","500Qk00000KAlAGIA1","TextPost","005Qk000002b4gDIAQ","2025-01-30T10:41:54.000Z","What We've Learned Updated: High-risk USA timezone
Probably permissions issue, since replication can not be run

--------
01/07/2025
--------

Logs indicate permissions issue accessing replication in domain.

06/01/2025 20:57:24	ERROR	PASSWORDSECURITY	Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task.StartExecute	""System.UnauthorizedAccessException: Replication access was denied ---> System.ComponentModel.Win32Exception: Replication access was denied     --- End of inner exception stack trace ---     at DSInternals.Common.Validator.AssertSuccess(Win32ErrorCode code)     at DSInternals.Replication.Interop.DrsConnection.GetNCChanges(unique_ptr<__MIDL_drsuapi_0042,midl_delete<__MIDL_drsuapi_0042> >* , unique_ptr<__MIDL_drsuapi_0046,midl_delete<__MIDL_drsuapi_0046> >* request)     at DSInternals.Replication.Interop.DrsConnection.ReplicateAllObjects(ReplicationCookie cookie, UInt32[] partialAttributeSet, UInt32 maxBytes, UInt32 maxObjects)     at DSInternals.Replication.DirectoryReplicationClient.<GetAccounts>d__11.MoveNext()     at Stealthbits.StealthAUDIT.DataCollectors.PasswordSecurity.Tasks.WeakPasswordsScanTask.InternalProcessRecord()     at Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task.StartExecute()""	BMGDCP2690LBM	DCExtract	3120	5104	3648

Provided documentation showing required permissions and Microsoft article detailing how to assign permissions.

--------
17/01/2025
--------
The customer is using a service account which cannot be directly added to the domain with proper permissions. I have suggested trying to use a group instead and add the service account user to that group to get the permissions needed.

--------
23/01/2025
--------
Customer would like a call scheduled between the hours of 3PM and 6PM Manila time to help apply the correct permissions.

-------- 
Customer is on 11.6.0.72 NEA. 

Customer wants to use gMSA account:
https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/group-managed-service-accounts/group-managed-service-accounts/group-managed-service-accounts-overview
as a service account for all Enterprise Auditor tasks. 

Customer was able to successfully use this account for all other tasks except for the AD_WeakPasswords Job

I have confirmed that gMSA account is a member of built-in Domain Administrators group. 
All other accounts added to Domain Admins group do not have permissions issue when they are used for AD_WeakPasswords Job. 
Only GMSA account, while being a member of Domain Admins, produces the ""access denied"" errors above. 

Agreed with customer that I will test this out from my side and check with RnD if needed to confirm if NEA has any limitations regarding GMSA account.

----------- 
After testing gMSA in my lab I was also getting ""GMSA error: access is denied"" exception while trying to add gMSA account to connection profile using ""Managed Service Account"" password storage. 

In my lab the ""Access Denied"" error was a result of incorrectly configured PrincipalsAllowedToRetrieveManagedPassword property of a gMSA account.

It was found out that this PowerShell command that is used to configure this property for gMSA account expects a variable of an array type:
          Set-ADServiceAccount gMSA_acc -PrincipalsAllowedToRetrieveManagedPassword $x

While I was specifying the Distinguished Name of my NEA server as a string:
          Set-ADServiceAccount gMSA_acc -PrincipalsAllowedToRetrieveManagedPassword ""My_NEA_host_DN""

As such, I would recommend resetting the ""gMSA-LBMNADCA$"" account PrincipalsAllowedToRetrieveManagedPassword property using these steps:

#Get current list of allowed principals and assign it to an variable
$x = (Get-ADServiceAccount your_gMSA_Account -Properties  principalsallowedtoretrievemanagedpassword).principalsallowedtoretrievemanagedpassword

#get NEA/StealthAudit host Distinguished Name and append it to $x
$x +=(get-adcomputer NEA_host).distinguishedname

#get service account configured to run Jobs on schedule and append it to $x
$x +=(get-aduser NEA_scheduling_SVC_acc).distinguishedname

#if needed, get service account that NEA user is logging in to Enterprise Auditor server to run Jobs interactively. 
#$x +=(get-aduser NEA_interactive_jobStart_acc).distinguishedname
 
#And finally, configure list of Principals Allowed to retrieve managed password using $x array 
Set-ADServiceAccount gMSA_acc -PrincipalsAllowedToRetrieveManagedPassword $x

As a result, I was able to add my test gMSA account to connection profile and run ""AD_WeakPasswords"" solution successfully.","","","","005Qk000002b4gDIAQ","2025-01-30T10:41:54.000Z"
"0D5Qk00000Vn6QpKAJ","500Qk00000KAlAGIA1","TextPost","005Qk000002b4gDIAQ","2025-01-30T10:47:24.000Z","Next Steps Updated: I asked customer to reset this property for their gMSA account:
principalsallowedtoretrievemanagedpassword

But customer refused to perform these steps and customer does not want to believe that issue is with gMSA account configuration. 

Customer provided screenshots where we can see that the ""principalsallowedtoretrievemanagedpassword"" property has NEA server DN in it. 

On the screenshots customer shared I noticed that DN of their NEA server has ""likebakermckenzie"" in its LDAP path.  While they are trying to add gMSA account in connection profile window using ""LIKEBM"" as a domain name. 

As such I asked customer to try specifying full domain name using ""likebakermckenzie"" in the ""Domain"" field while adding gMSA account to connecetion profile instead of ""LIKEBM"". 
Waiting for customers reply.","","","","005Qk000002b4gDIAQ","2025-01-30T10:47:24.000Z"
"0D5Qk00000W0l4YKAR","500Qk00000KAlAGIA1","TextPost","005Qk000002b4gDIAQ","2025-02-03T15:06:34.000Z","Invitation updated. Attendees: Artem Naskal, Don Boncodin","","","","005Qk000002b4gDIAQ","2025-02-03T15:06:34.000Z"
"0D5Qk00000W0l4XKAR","500Qk00000KAlAGIA1","TextPost","005Qk000002b4gDIAQ","2025-02-03T15:06:34.000Z","Invitation updated. Attendees: Artem Naskal","","","","005Qk000002b4gDIAQ","2025-02-03T15:06:34.000Z"
"0D5Qk00000W4kTVKAZ","500Qk00000KAlAGIA1","TextPost","005Qk000002b4gDIAQ","2025-02-04T09:50:21.000Z","Description Updated: The job is failing with error message ""System.UnauthorizedAccessException: Replication access was denied ---> System.ComponentModel.Win32Exception: Replication access was denied
   --- End of inner exception stack trace ---
   at DSInternals.Common.Validator.AssertSuccess(Win32ErrorCode code)
   at DSInternals.Replication.Interop.DrsConnection.GetNCChanges(unique_ptr* , unique_ptr* request)
   at DSInternals.Replication.Interop.DrsConnection.ReplicateAllObjects(ReplicationCookie cookie, UInt32[] partialAttributeSet, UInt32 maxBytes, UInt32 maxObjects)
   at DSInternals.Replication.DirectoryReplicationClient.d__11.MoveNext()
   at Stealthbits.StealthAUDIT.DataCollectors.PasswordSecurity.Tasks.WeakPasswordsScanTask.InternalProcessRecord()""
   at <a href='https://Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task' target='_blank'>Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task</a>.StartExecute()


------ 
Further testing in my lab proved that additional DNs must be added to the ""PrincipalsAllowedToRetrieveManagedPassword"" property:
dn of NEA host
dn of account that was used to open NEA console 
dn of account that is configured to run scheduled tasks

during my last remote session with customer I only tried adding dn of NEA host to the list of principals allowed to retrieve managed password. 
Need to try adding dn of the user account that is used to start NEA console + dn of the account used for scheduled tasks","","","","005Qk000002b4gDIAQ","2025-02-04T09:50:21.000Z"
"0D5Qk00000W4DhJKAV","500Qk00000KAlAGIA1","TextPost","005Qk000002b4gDIAQ","2025-02-04T10:11:58.000Z","Description Updated: The job is failing with error message ""System.UnauthorizedAccessException: Replication access was denied ---> System.ComponentModel.Win32Exception: Replication access was denied
   --- End of inner exception stack trace ---
   at DSInternals.Common.Validator.AssertSuccess(Win32ErrorCode code)
   at DSInternals.Replication.Interop.DrsConnection.GetNCChanges(unique_ptr* , unique_ptr* request)
   at DSInternals.Replication.Interop.DrsConnection.ReplicateAllObjects(ReplicationCookie cookie, UInt32[] partialAttributeSet, UInt32 maxBytes, UInt32 maxObjects)
   at DSInternals.Replication.DirectoryReplicationClient.d__11.MoveNext()
   at Stealthbits.StealthAUDIT.DataCollectors.PasswordSecurity.Tasks.WeakPasswordsScanTask.InternalProcessRecord()""
   at <a href='https://Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task' target='_blank'>Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task</a>.StartExecute()","","","","005Qk000002b4gDIAQ","2025-02-04T10:11:58.000Z"
"0D5Qk00000W4on6KAB","500Qk00000KAlAGIA1","TextPost","005Qk000002b4gDIAQ","2025-02-04T10:12:17.000Z","What We've Learned Updated: High-risk USA timezone
Probably permissions issue, since replication can not be run

--------
01/07/2025
--------

Logs indicate permissions issue accessing replication in domain.

06/01/2025 20:57:24	ERROR	PASSWORDSECURITY	Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task.StartExecute	""System.UnauthorizedAccessException: Replication access was denied ---> System.ComponentModel.Win32Exception: Replication access was denied     --- End of inner exception stack trace ---     at DSInternals.Common.Validator.AssertSuccess(Win32ErrorCode code)     at DSInternals.Replication.Interop.DrsConnection.GetNCChanges(unique_ptr<__MIDL_drsuapi_0042,midl_delete<__MIDL_drsuapi_0042> >* , unique_ptr<__MIDL_drsuapi_0046,midl_delete<__MIDL_drsuapi_0046> >* request)     at DSInternals.Replication.Interop.DrsConnection.ReplicateAllObjects(ReplicationCookie cookie, UInt32[] partialAttributeSet, UInt32 maxBytes, UInt32 maxObjects)     at DSInternals.Replication.DirectoryReplicationClient.<GetAccounts>d__11.MoveNext()     at Stealthbits.StealthAUDIT.DataCollectors.PasswordSecurity.Tasks.WeakPasswordsScanTask.InternalProcessRecord()     at Stealthbits.StealthAUDIT.DataCollectors.Tasks.Task.StartExecute()""	BMGDCP2690LBM	DCExtract	3120	5104	3648

Provided documentation showing required permissions and Microsoft article detailing how to assign permissions.

--------
17/01/2025
--------
The customer is using a service account which cannot be directly added to the domain with proper permissions. I have suggested trying to use a group instead and add the service account user to that group to get the permissions needed.

--------
23/01/2025
--------
Customer would like a call scheduled between the hours of 3PM and 6PM Manila time to help apply the correct permissions.

-------- 
Customer is on 11.6.0.72 NEA. 

Customer wants to use gMSA account:
https://learn.microsoft.com/en-us/windows-server/identity/ad-ds/manage/group-managed-service-accounts/group-managed-service-accounts/group-managed-service-accounts-overview
as a service account for all Enterprise Auditor tasks. 

Customer was able to successfully use this account for all other tasks except for the AD_WeakPasswords Job

I have confirmed that gMSA account is a member of built-in Domain Administrators group. 
All other accounts added to Domain Admins group do not have permissions issue when they are used for AD_WeakPasswords Job. 
Only GMSA account, while being a member of Domain Admins, produces the ""access denied"" errors above. 

Agreed with customer that I will test this out from my side and check with RnD if needed to confirm if NEA has any limitations regarding GMSA account.

----------- 
After testing gMSA in my lab I was also getting ""GMSA error: access is denied"" exception while trying to add gMSA account to connection profile using ""Managed Service Account"" password storage. 

In my lab the ""Access Denied"" error was a result of incorrectly configured PrincipalsAllowedToRetrieveManagedPassword property of a gMSA account.

It was found out that this PowerShell command that is used to configure this property for gMSA account expects a variable of an array type:
          Set-ADServiceAccount gMSA_acc -PrincipalsAllowedToRetrieveManagedPassword $x

While I was specifying the Distinguished Name of my NEA server as a string:
          Set-ADServiceAccount gMSA_acc -PrincipalsAllowedToRetrieveManagedPassword ""My_NEA_host_DN""

As such, I would recommend resetting the ""gMSA-LBMNADCA$"" account PrincipalsAllowedToRetrieveManagedPassword property using these steps:

#Get current list of allowed principals and assign it to an variable
$x = (Get-ADServiceAccount your_gMSA_Account -Properties  principalsallowedtoretrievemanagedpassword).principalsallowedtoretrievemanagedpassword

#get NEA/StealthAudit host Distinguished Name and append it to $x
$x +=(get-adcomputer NEA_host).distinguishedname

#get service account configured to run Jobs on schedule and append it to $x
$x +=(get-aduser NEA_scheduling_SVC_acc).distinguishedname

#if needed, get service account that NEA user is logging in to Enterprise Auditor server to run Jobs interactively. 
#$x +=(get-aduser NEA_interactive_jobStart_acc).distinguishedname
 
#And finally, configure list of Principals Allowed to retrieve managed password using $x array 
Set-ADServiceAccount gMSA_acc -PrincipalsAllowedToRetrieveManagedPassword $x

As a result, I was able to add my test gMSA account to connection profile and run ""AD_WeakPasswords"" solution successfully.

------ 
Further testing in my lab proved that additional DNs must be added to the ""PrincipalsAllowedToRetrieveManagedPassword"" property:
dn of NEA host
dn of account that was used to open NEA console 
dn of account that is configured to run scheduled tasks

during my last remote session with customer I only tried adding dn of NEA host to the list of principals allowed to retrieve managed password. 
Need to try adding dn of the user account that is used to start NEA console + dn of the account used for scheduled tasks","","","","005Qk000002b4gDIAQ","2025-02-04T10:12:17.000Z"
"0D5Qk00000W4qVUKAZ","500Qk00000KAlAGIA1","TextPost","005Qk000002b4gDIAQ","2025-02-04T10:13:36.000Z","Next Steps Updated: during my last remote session with customer I only tried adding dn of NEA host to the list of principals allowed to retrieve managed password.
Need to try adding dn of the user account that is used to start NEA console + dn of the account used for scheduled tasks

Support will schedule meeting with customer to continue troubleshooting gMSA account configuration (by adding user accounts DNs to the list of allowed principals)","","","","005Qk000002b4gDIAQ","2025-02-04T10:13:36.000Z"
"0D5Qk00000W9VITKA3","500Qk00000KAlAGIA1","TextPost","005Qk000002b4gDIAQ","2025-02-05T09:48:23.000Z","What We've Learned Updated: On last meeting with customer (02.05.2025) - we added user account that started NEA console to the list of principals allowed to retrieve managed password. 
We used these commands to add this user:
#Get current list of allowed principals and assign it to a variable. Replace gMSA_acc with your gMSA account name.
$x = (Get-ADServiceAccount gMSA_acc -Properties  principalsallowedtoretrievemanagedpassword).principalsallowedtoretrievemanagedpassword

#Get account that user is logging in to Enterprise Auditor. Replace ""ADuser"" with the needed user. 
$x +=(get-aduser ADuser).distinguishedname

#Configure list of Principals Allowed to retrieve managed password using $x value. Replace gMSA_acc with your gMSA account name.
Set-ADServiceAccount gMSA_acc -PrincipalsAllowedToRetrieveManagedPassword $x

After this the gMSA account was successfully added to connection profile using ""Managed Service Account"" password storage. 
""AD_WeakPasswords"" job completed successfully (we started it interactively). 


Suggested customer to use security group for the ""principalsallowedtoretrievemanagedpassword"" property of gMSA account and append needed users to that security group for easier management. 

Users that must be added to security group as per our requirements:
All users that will be logging in to Enterprise Auditor console to run Jobs manually as well as all user/service accounts that will be used to run scheduled tasks. This includes computer account for NEA server if ""Local System"" is selected as a user account for running scheduled tasks. (can be added by adding computer object to the security group or by adding computer`s Distinguished Name to the ""principalsallowedtoretrievemanagedpassword"").","","","","005Qk000002b4gDIAQ","2025-02-05T09:48:23.000Z"
"0D5Qk00000W9T69KAF","500Qk00000KAlAGIA1","TextPost","005Qk000002b4gDIAQ","2025-02-05T09:49:19.000Z","Next Steps Updated: AD_WeakPasswords job is now running successfully. Waiting for customers reply.","","","","005Qk000002b4gDIAQ","2025-02-05T09:49:19.000Z"
