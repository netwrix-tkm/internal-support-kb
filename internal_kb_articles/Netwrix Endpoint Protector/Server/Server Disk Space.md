# Netwrix Endpoint Protector Knowledge Base: Server Disk Space Management

## Overview

Server disk space management is a critical aspect of maintaining the performance, functionality, and reliability of the Netwrix Endpoint Protector (EPP) platform. Disk space issues can arise due to log accumulation, shadow file retention, misconfigured storage settings, or insufficient disk allocation. These issues can lead to server downtime, performance degradation, and data loss if not addressed promptly.

This guide provides a comprehensive approach to diagnosing, resolving, and preventing server disk space issues. It includes technical background, diagnostic methodologies, common scenarios, and best practices to ensure consistent and efficient handling by support engineers.

---

## Technical Background

### Key Concepts
- **Disk Space Utilization**: The percentage of storage capacity used on a server. High utilization (e.g., >80%) can lead to performance degradation and system errors.
- **Shadow Files**: Temporary files created for file tracing and shadowing purposes. These can consume significant disk space if not managed properly.
- **Audit Logs**: Logs generated by the EPP server to track system and user activities. Without proper retention policies, these logs can grow rapidly.
- **Retention Policies**: Configurations that determine how long logs, backups, or shadow files are retained on the server.
- **Log Rotation**: The process of archiving and deleting older logs to free up disk space.
- **Snapshots**: Point-in-time copies of the server's state, stored on the hypervisor, which can consume large amounts of disk space.
- **Dynamic vs. Static Disks**: Dynamic disks expand as needed, while static disks have fixed sizes. Mismanagement of dynamic disks can lead to unexpected capacity issues.

### Terminology
- **Inodes**: Data structures used to store information about files on a disk.
- **Filesystem Check (fsck)**: A utility to repair filesystem corruption.
- **Journalctl**: A command-line tool for managing system logs.
- **Disk Expansion**: Increasing the size of a disk partition to accommodate growing storage needs.

### System Context
Netwrix Endpoint Protector servers are deployed in various environments, including on-premises, cloud-hosted (e.g., AWS, Azure, Google Cloud), and virtualized platforms (e.g., VMware, Hyper-V). Disk space issues often arise due to:
- Misconfigured retention policies.
- Lack of automated cleanup processes.
- Excessive logging or shadow file generation.
- Insufficient initial disk allocation.

---

## Issue Recognition & Triage

### Symptoms
- **Low Disk Space Alerts**: Notifications in the EPP console, such as "Low Disk Space" or "Critical Low Disk Space."
- **Performance Degradation**: Slow server response times or inability to access the EPP console.
- **Error Messages**: Specific errors such as "500 Internal Server Error" or "Disk Full."
- **Login Issues**: Inability to log into the server due to insufficient disk space.
- **Backup Failures**: Inability to complete backups or log exports.

### Priority Assessment
- **Critical**: Disk space below 5â€“10%, server inaccessible, or performance severely impacted.
- **High**: Disk space below 20%, with warnings affecting functionality.
- **Medium**: Disk space below 50%, with potential for future issues.
- **Low**: Disk space above 50%, with proactive cleanup recommended.

---

## Diagnostic Methodology

### Systematic Approach
1. **Verify Disk Space**:
   - Use the EPP console or command-line tools like `df -h` to check disk utilization.
   - Identify directories consuming the most space using commands like `du -sh /var/*` or `du -sh /usr/local/logs/*`.

2. **Identify Culprits**:
   - Check for excessive log files, shadow files, or old backups.
   - Use `du -sh` to locate large files or directories.

3. **Review Retention Policies**:
   - Verify configurations for Audit Log Backup and shadow file retention settings.
   - Ensure policies are optimized to prevent unnecessary accumulation.

4. **Check for Snapshots**:
   - Identify and delete unnecessary snapshots stored on the hypervisor.

5. **Analyze Storage Configuration**:
   - Verify external storage settings and ensure disk expansions are recognized by the server.
   - Check for duplicated data or misconfigured dynamic disks.

6. **Perform Cleanup**:
   - Delete unnecessary files, logs, or backups.
   - Monitor the impact of cleanup actions on disk space.

7. **Engage DevOps (if needed)**:
   - For persistent issues, involve DevOps to check system-level configurations, such as partition settings or filesystem integrity.

---

## Information Collection

### Questions to Ask Customers
- What symptoms are you experiencing (e.g., warnings, performance issues)?
- Have any recent changes been made to storage configurations or retention policies?
- Are there specific files or logs that need to be retained?
- Is the server hosted on a virtual machine or cloud platform?
- Have backups or log exports been performed recently?

### Logs and Data to Collect
- Disk usage statistics (`df -h`, `du -sh`).
- List of large files (`du -sh /var/* | grep G`).
- Audit log configurations and retention policies.
- Shadow file retention settings.
- Snapshot details from the hypervisor.
- System logs (e.g., `/usr/local/logs/php-fpm.log`).

---

## Common Scenarios & Solutions

### Scenario 1: Excessive Log Accumulation
- **Symptoms**: Disk space warnings, slow server performance.
- **Solution**:
  1. Identify large log files (`du -sh /usr/local/logs/*`).
  2. Delete unnecessary logs or archive them using Audit Log Backup.
  3. Configure log rotation to prevent future accumulation.

### Scenario 2: Shadow File Overload
- **Symptoms**: Disk space warnings, high `/var` usage.
- **Solution**:
  1. Delete shadow files older than 30 days.
  2. Adjust shadowing policies to limit the number of monitored devices.

### Scenario 3: Misconfigured Storage
- **Symptoms**: Disk expansion not recognized, duplicated data on system disk.
- **Solution**:
  1. Verify and correct storage configurations.
  2. Expand disk partitions and ensure changes are reflected in the server.
  3. Remove duplicated files from the system disk.

### Scenario 4: Snapshot Overuse
- **Symptoms**: Disk space warnings, hypervisor storage full.
- **Solution**:
  1. Identify and delete old snapshots.
  2. Advise the customer to limit snapshot retention.

---

## Detailed Case Studies

### Case Study 1: Excessive Shadow Files
- **Ticket**: [500Qk00000N5YwfIAF](https://nwxcorp.lightning.force.com/lightning/r/Case/500Qk00000N5YwfIAF/view)
- **Symptoms**: Storage drive full due to shadow files.
- **Diagnostic Steps**:
  - Identified shadow files older than 30 days.
  - Deleted unnecessary files via the backend.
- **Resolution**: Freed up 67% of disk space.
- **Key Takeaways**: Regular monitoring and automated cleanup of shadow files are essential.

### Case Study 2: Log Partition Full
- **Ticket**: [500Qk00000NSY3BIAX](https://nwxcorp.lightning.force.com/lightning/r/Case/500Qk00000NSY3BIAX/view)
- **Symptoms**: Log partition at 100%, server inaccessible.
- **Diagnostic Steps**:
  - Cleared logs and reduced file tracing scope.
  - Configured Audit Log Backup.
- **Resolution**: Restored server access and reduced log partition usage.
- **Key Takeaways**: Proactive log management prevents critical failures.

### Case Study 3: Disk Expansion on Azure
- **Ticket**: [500Qk00000O4Mx1IAF](https://nwxcorp.lightning.force.com/lightning/r/Case/500Qk00000O4Mx1IAF/view)
- **Symptoms**: Additional storage not reflected after SSD upgrade.
- **Diagnostic Steps**:
  - Extended the root partition via SSH.
- **Resolution**: Successfully allocated additional storage.
- **Key Takeaways**: Disk expansion requires backend adjustments post-upgrade.

---

## Best Practices & Tips

1. **Proactive Monitoring**:
   - Set up alerts for disk usage thresholds (e.g., 80%, 90%).
   - Regularly review log and shadow file retention policies.

2. **Automated Cleanup**:
   - Implement scripts to delete old logs and shadow files.
   - Schedule Audit Log Backups to external storage.

3. **Disk Space Optimization**:
   - Use log rotation to manage log file sizes.
   - Limit file tracing and shadowing to essential devices.

4. **Customer Communication**:
   - Clearly explain the impact of disk space issues.
   - Provide step-by-step guidance for preventive measures.

---

## Escalation Guidelines

### When to Escalate
- Disk space issues persist despite cleanup efforts.
- Critical server functionality is impacted.
- Disk expansion or partition resizing requires advanced expertise.

### How to Escalate
1. Document all troubleshooting steps and findings.
2. Provide logs and screenshots of disk usage.
3. Escalate to the appropriate team (e.g., DevOps, Infrastructure).

---

By following this guide, support engineers can effectively diagnose, resolve, and prevent server disk space issues in Netwrix Endpoint Protector, ensuring optimal server performance and customer satisfaction.